<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The Ultimate Playlist: Power Paradox - A Statistical Journey ‚Äì STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0cb5735cee7cc8ae56ecf7c7052d4876.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary"><strong>Executive Summary üéß‚ú®</strong></a>
  <ul class="collapse">
  <li><a href="#key-findings" id="toc-key-findings" class="nav-link" data-scroll-target="#key-findings"><strong>Key Findings</strong> üöÄ</a></li>
  </ul></li>
  <li><a href="#task---1-data-import" id="toc-task---1-data-import" class="nav-link" data-scroll-target="#task---1-data-import"><strong>Task - 1 Data Import</strong></a></li>
  <li><a href="#task---2-working-on-playlist-dataset" id="toc-task---2-working-on-playlist-dataset" class="nav-link" data-scroll-target="#task---2-working-on-playlist-dataset"><strong>Task - 2 Working on playlist dataset</strong></a></li>
  <li><a href="#task---3-rectangle-the-playlist-data" id="toc-task---3-rectangle-the-playlist-data" class="nav-link" data-scroll-target="#task---3-rectangle-the-playlist-data"><strong>task - 3 Rectangle the Playlist Data</strong></a></li>
  <li><a href="#task--4-exploring-the-dataset" id="toc-task--4-exploring-the-dataset" class="nav-link" data-scroll-target="#task--4-exploring-the-dataset"><strong>Task -4 Exploring the Dataset</strong></a>
  <ul class="collapse">
  <li><a href="#question-1-how-many-distinct-tracks-and-artists-are-represented-in-the-playlist-data" id="toc-question-1-how-many-distinct-tracks-and-artists-are-represented-in-the-playlist-data" class="nav-link" data-scroll-target="#question-1-how-many-distinct-tracks-and-artists-are-represented-in-the-playlist-data">Question 1: How many distinct tracks and artists are represented in the playlist data?</a></li>
  <li><a href="#question-2-what-are-the-5-most-popular-tracks-in-the-playlist-data" id="toc-question-2-what-are-the-5-most-popular-tracks-in-the-playlist-data" class="nav-link" data-scroll-target="#question-2-what-are-the-5-most-popular-tracks-in-the-playlist-data">Question 2: What are the 5 most popular tracks in the playlist data?</a></li>
  <li><a href="#question-3-what-is-the-most-popular-track-that-does-not-have-a-corresponding-entry-in-the-song-characteristics-data" id="toc-question-3-what-is-the-most-popular-track-that-does-not-have-a-corresponding-entry-in-the-song-characteristics-data" class="nav-link" data-scroll-target="#question-3-what-is-the-most-popular-track-that-does-not-have-a-corresponding-entry-in-the-song-characteristics-data">Question 3: What is the most popular track that does not have a corresponding entry in the song characteristics data?</a></li>
  <li><a href="#question-4-according-to-the-song-characteristics-data-what-is-the-most-danceable-track-how-often-does-it-appear-in-a-playlist" id="toc-question-4-according-to-the-song-characteristics-data-what-is-the-most-danceable-track-how-often-does-it-appear-in-a-playlist" class="nav-link" data-scroll-target="#question-4-according-to-the-song-characteristics-data-what-is-the-most-danceable-track-how-often-does-it-appear-in-a-playlist">Question 4: According to the song characteristics data, what is the most ‚Äúdanceable‚Äù track? How often does it appear in a playlist?</a></li>
  <li><a href="#question-5-which-playlist-has-the-longest-average-track-length" id="toc-question-5-which-playlist-has-the-longest-average-track-length" class="nav-link" data-scroll-target="#question-5-which-playlist-has-the-longest-average-track-length">Question 5: Which playlist has the longest average track length?</a></li>
  <li><a href="#question-6-what-is-the-most-popular-playlist-on-spotify" id="toc-question-6-what-is-the-most-popular-playlist-on-spotify" class="nav-link" data-scroll-target="#question-6-what-is-the-most-popular-playlist-on-spotify">Question 6: What is the most popular playlist on Spotify?</a></li>
  </ul></li>
  <li><a href="#task-5-identifying-characteristics-of-popular-song" id="toc-task-5-identifying-characteristics-of-popular-song" class="nav-link" data-scroll-target="#task-5-identifying-characteristics-of-popular-song"><strong>TASK-5 Identifying characteristics of Popular song</strong></a>
  <ul class="collapse">
  <li><a href="#joining-spotify-songs-and-playlist-data" id="toc-joining-spotify-songs-and-playlist-data" class="nav-link" data-scroll-target="#joining-spotify-songs-and-playlist-data">Joining Spotify songs and playlist data</a></li>
  <li><a href="#is-the-popularity-column-correlated-with-the-number-of-playlist-appearances" id="toc-is-the-popularity-column-correlated-with-the-number-of-playlist-appearances" class="nav-link" data-scroll-target="#is-the-popularity-column-correlated-with-the-number-of-playlist-appearances"><strong>5.1 Is the <code>popularity</code> column correlated with the number of playlist appearances?</strong></a></li>
  <li><a href="#in-what-year-were-the-most-popular-songs-released" id="toc-in-what-year-were-the-most-popular-songs-released" class="nav-link" data-scroll-target="#in-what-year-were-the-most-popular-songs-released"><strong>5.2 In what year were the most popular songs released?</strong></a></li>
  <li><a href="#in-what-year-did-danceability-peak" id="toc-in-what-year-did-danceability-peak" class="nav-link" data-scroll-target="#in-what-year-did-danceability-peak"><strong>5.3 In what year did danceability peak?</strong></a></li>
  <li><a href="#which-decade-is-most-represented-on-user-playlists" id="toc-which-decade-is-most-represented-on-user-playlists" class="nav-link" data-scroll-target="#which-decade-is-most-represented-on-user-playlists"><strong>5.4 Which decade is most represented on user playlists?</strong></a></li>
  <li><a href="#create-a-plot-of-key-frequency-using-polar-coordinates" id="toc-create-a-plot-of-key-frequency-using-polar-coordinates" class="nav-link" data-scroll-target="#create-a-plot-of-key-frequency-using-polar-coordinates"><strong>5.5 Create a plot of key frequency using polar coordinates</strong></a></li>
  <li><a href="#what-are-the-most-popular-track-lengths" id="toc-what-are-the-most-popular-track-lengths" class="nav-link" data-scroll-target="#what-are-the-most-popular-track-lengths"><strong>5.6 What are the most popular track lengths?</strong></a></li>
  <li><a href="#how-do-audio-features-differ-between-popular-and-less-popular-songs" id="toc-how-do-audio-features-differ-between-popular-and-less-popular-songs" class="nav-link" data-scroll-target="#how-do-audio-features-differ-between-popular-and-less-popular-songs"><strong>5.7.1 How do audio features differ between popular and less popular songs?</strong></a></li>
  <li><a href="#question-5.7.2-is-there-a-relationship-between-energy-and-danceability-and-does-it-differ-for-popular-songs" id="toc-question-5.7.2-is-there-a-relationship-between-energy-and-danceability-and-does-it-differ-for-popular-songs" class="nav-link" data-scroll-target="#question-5.7.2-is-there-a-relationship-between-energy-and-danceability-and-does-it-differ-for-popular-songs"><strong>QUESTION 5.7.2: Is there a relationship between energy and danceability, and does it differ for popular songs?</strong></a></li>
  </ul></li>
  <li><a href="#task-6-finding-related-songs" id="toc-task-6-finding-related-songs" class="nav-link" data-scroll-target="#task-6-finding-related-songs"><strong>Task 6: Finding Related Songs</strong></a>
  <ul class="collapse">
  <li><a href="#heuristic-1-songs-that-appear-on-the-same-playlists" id="toc-heuristic-1-songs-that-appear-on-the-same-playlists" class="nav-link" data-scroll-target="#heuristic-1-songs-that-appear-on-the-same-playlists"><strong>Heuristic 1: Songs that appear on the same playlists</strong></a></li>
  <li><a href="#heuristic-2-songs-with-similar-key-and-tempo" id="toc-heuristic-2-songs-with-similar-key-and-tempo" class="nav-link" data-scroll-target="#heuristic-2-songs-with-similar-key-and-tempo"><strong>Heuristic 2: Songs with similar key and tempo</strong></a></li>
  <li><a href="#heuristic-3-songs-by-the-same-artists" id="toc-heuristic-3-songs-by-the-same-artists" class="nav-link" data-scroll-target="#heuristic-3-songs-by-the-same-artists"><strong>Heuristic 3: Songs by the same artists</strong></a></li>
  <li><a href="#heuristic-4-songs-from-same-year-with-similar-acoustic-features" id="toc-heuristic-4-songs-from-same-year-with-similar-acoustic-features" class="nav-link" data-scroll-target="#heuristic-4-songs-from-same-year-with-similar-acoustic-features"><strong>Heuristic 4: Songs from same year with similar acoustic features</strong></a></li>
  <li><a href="#heuristic-5-songs-with-similar-lyrics-themes-custom-heuristic" id="toc-heuristic-5-songs-with-similar-lyrics-themes-custom-heuristic" class="nav-link" data-scroll-target="#heuristic-5-songs-with-similar-lyrics-themes-custom-heuristic"><strong>Heuristic 5: Songs with similar lyrics themes (custom heuristic)</strong></a></li>
  <li><a href="#combine-all-candidates-and-select-a-diverse-set" id="toc-combine-all-candidates-and-select-a-diverse-set" class="nav-link" data-scroll-target="#combine-all-candidates-and-select-a-diverse-set"><strong>Combine all candidates and select a diverse set</strong></a></li>
  </ul></li>
  <li><a href="#task-7-create-the-ultimate-playlist" id="toc-task-7-create-the-ultimate-playlist" class="nav-link" data-scroll-target="#task-7-create-the-ultimate-playlist"><strong>Task 7: Create the Ultimate Playlist</strong></a>
  <ul class="collapse">
  <li><a href="#visualize-the-flow-of-the-playlist" id="toc-visualize-the-flow-of-the-playlist" class="nav-link" data-scroll-target="#visualize-the-flow-of-the-playlist"><strong>Visualize the flow of the playlist</strong></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><strong>The Ultimate Playlist: Power Paradox - A Statistical Journey</strong></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="executive-summary" class="level2">
<h2 class="anchored" data-anchor-id="executive-summary"><strong>Executive Summary üéß‚ú®</strong></h2>
<p>I‚Äôm thrilled to introduce Power Paradox, my data‚Äëfueled playlist that blends mega‚Äëhits with hidden gems to explore themes of power, ambition, and resilience. I dove into clean Spotify song stats and mined over a million public playlists. Then I cooked up audio‚Äëfeature wizardry‚Äîadding co‚Äëoccurrence magic, artist/genre vibes, and keyword spice‚Äîto handcraft a 12‚Äëtrack journey you‚Äôll want on repeat.</p>
<section id="key-findings" class="level3">
<h3 class="anchored" data-anchor-id="key-findings"><strong>Key Findings</strong> üöÄ</h3>
<ul>
<li><p><em>Popularity Patterns</em>: I found that 2010s songs are the absolute KINGS of playlists! üëë But those nostalgic tunes from earlier decades still hold their own! My data shows the winning combination is high danceability, pumping energy, and that perfect 3-4 minute length! ‚è±Ô∏èüíÉ</p></li>
<li><p><em>Audio Feature Secrets</em>: I discovered that popular songs literally BRING THE ENERGY (+5.7%)! They make me want to DANCE (+3.1%) and spread good VIBES (+8.3%) compared to less-popular tracks! üï∫‚ú® I was shocked to find that musical keys C, G, and A dominate the Spotify universe! üéπüåü</p></li>
<li><p><em>Playlist Flow Magic</em>: The best playlists aren‚Äôt random - they‚Äôre emotional journeys! üé¢ I found they follow a carefully crafted energy curve (climb ‚ÜóÔ∏è, plateau ‚û°Ô∏è, descent ‚ÜòÔ∏è) while keeping a consistent vibe. It‚Äôs like musical storytelling that keeps me hooked! üìöüéµ</p></li>
<li><p><em>My Algorithm Works!</em>: I created a recommendation algorithm that‚Äôs basically a musical matchmaker! It balances hit songs with hidden gems and creates playlists that feel both familiar and exciting! I‚Äôm honestly impressed with myself! üéØ‚ú®</p></li>
</ul>
</section>
</section>
<section id="task---1-data-import" class="level2">
<h2 class="anchored" data-anchor-id="task---1-data-import"><strong>Task - 1 Data Import</strong></h2>
<div class="cell" data-caption="Data Import Code">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function called load_songs() first</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>load_songs <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create directory if it doesn't exist</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  dir_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp03"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(dir_name, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define file path</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  file_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_name, <span class="st">"spotify_songs.csv"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Download file if it doesn't exist</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file_path)) {</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">download.file</span>(</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">url =</span> <span class="st">"https://raw.githubusercontent.com/gabminamedez/spotify-data/refs/heads/master/data.csv"</span>,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">destfile =</span> file_path,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"auto"</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">quiet =</span> <span class="cn">FALSE</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read the data into R</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  songs_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file_path)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean and transform artists column</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  clean_artist_string <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(x, <span class="st">"</span><span class="sc">\\</span><span class="st">['"</span>, <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_replace_all</span>(<span class="st">"'</span><span class="sc">\\</span><span class="st">]"</span>, <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_replace_all</span>(<span class="st">" '"</span>, <span class="st">""</span>)</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Process the data</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  songs_clean <span class="ot">&lt;-</span> songs_data <span class="sc">|&gt;</span> </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate_longer_delim</span>(artists, <span class="st">","</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">artist =</span> <span class="fu">clean_artist_string</span>(artists)) <span class="sc">|&gt;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>artists)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return the cleaned data frame</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(songs_clean)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Load and clean the data</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>songs_data <span class="ot">&lt;-</span> <span class="fu">load_songs</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>I started by building a function to download and clean all that messy Spotify song data! üßπ I had to figure out how to handle those complicated artist fields and transform everything into a clean, usable format. It was like creating the perfect foundation for my musical mansion! üè∞üéß</p>
</section>
<section id="task---2-working-on-playlist-dataset" class="level2">
<h2 class="anchored" data-anchor-id="task---2-working-on-playlist-dataset"><strong>Task - 2 Working on playlist dataset</strong></h2>
<p>THIS PART WAS CHALLENGING!!!! I created a super smart system that downloads playlist data and caches it so I don‚Äôt waste time re-downloading 18Millions files again and again (P.S. I did that mistake!) üíæ I had to be so careful with JSON processing - one little mistake and BOOM - everything would break! üí• But I NAILED IT! üòé</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, define helper function for checking if cached data exists</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>check_cached_data <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  cache_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp03"</span>, <span class="st">"playlists_cache.rds"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">file.exists</span>(cache_file))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to load data from cache</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>load_cached_data <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  cache_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp03"</span>, <span class="st">"playlists_cache.rds"</span>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Loading data from cache..."</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">readRDS</span>(cache_file))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if we need to load data or can use cache</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">check_cached_data</span>()) {</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Cache not found. Will load data from source..."</span>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the load_playlists function</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  load_playlists <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n_files =</span> <span class="cn">NULL</span>) {</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create directory if it doesn't exist</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    dir_name <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp03"</span>, <span class="st">"playlists"</span>)</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_name, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Base URL for the GitHub repository</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    base_url <span class="ot">&lt;-</span> <span class="st">"https://github.com/DevinOgrady/spotify_million_playlist_dataset/raw/main/data1/"</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the list of available files from the repository</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    repo_url <span class="ot">&lt;-</span> <span class="st">"https://api.github.com/repos/DevinOgrady/spotify_million_playlist_dataset/contents/data1"</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    response <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(repo_url)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (httr<span class="sc">::</span><span class="fu">status_code</span>(response) <span class="sc">!=</span> <span class="dv">200</span>) {</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"Failed to fetch file list from GitHub repository"</span>)</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Parse the response to get file names</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    files_info <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(httr<span class="sc">::</span><span class="fu">content</span>(response, <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>))</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    file_names <span class="ot">&lt;-</span> files_info<span class="sc">$</span>name</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter to only include JSON files</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    json_files <span class="ot">&lt;-</span> file_names[<span class="fu">grepl</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">.json$"</span>, file_names)]</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Limit number of files if specified</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(n_files) <span class="sc">&amp;&amp;</span> n_files <span class="sc">&lt;</span> <span class="fu">length</span>(json_files)) {</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>      json_files <span class="ot">&lt;-</span> json_files[<span class="dv">1</span><span class="sc">:</span>n_files]</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Function to download a file if it doesn't exist locally</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    download_if_needed <span class="ot">&lt;-</span> <span class="cf">function</span>(file_name) {</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>      local_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_name, file_name)</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(local_path)) {</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Downloading"</span>, file_name, <span class="st">"..."</span>))</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add a small delay to avoid hitting rate limits</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        file_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_url, file_name)</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tryCatch</span>({</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>          <span class="fu">download.file</span>(file_url, local_path, <span class="at">method =</span> <span class="st">"auto"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>        }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>          <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"Failed to download"</span>, file_name, <span class="st">":"</span>, e<span class="sc">$</span>message))</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>          <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        <span class="fu">message</span>(<span class="fu">paste</span>(file_name, <span class="st">"already exists locally. Skipping download."</span>))</span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(local_path)</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Download all files</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    local_files <span class="ot">&lt;-</span> <span class="fu">sapply</span>(json_files, download_if_needed)</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process playlist file - improved for speed and reliability</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>    process_playlist_file_alt <span class="ot">&lt;-</span> <span class="cf">function</span>(file_path) {</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(file_path) <span class="sc">||</span> <span class="sc">!</span><span class="fu">file.exists</span>(file_path)) {</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"File does not exist:"</span>, file_path))</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tryCatch</span>({</span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Read the JSON data</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>        playlist_data <span class="ot">&lt;-</span> jsonlite<span class="sc">::</span><span class="fu">fromJSON</span>(file_path, <span class="at">simplifyVector =</span> <span class="cn">TRUE</span>, <span class="at">simplifyDataFrame =</span> <span class="cn">FALSE</span>)</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>        <span class="fu">library</span>(data.table)</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Prepare playlists as a list</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>        playlists <span class="ot">&lt;-</span> playlist_data<span class="sc">$</span>playlists</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>        <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Processing"</span>, <span class="fu">length</span>(playlists), <span class="st">"playlists..."</span>))</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create an empty data.table to store results</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>        all_tracks <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>()</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process each playlist</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (pl <span class="cf">in</span> playlists) {</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Skip if no tracks</span></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">length</span>(pl<span class="sc">$</span>tracks) <span class="sc">==</span> <span class="dv">0</span>) <span class="cf">next</span></span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Create a data.table for tracks in this playlist</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>          tracks_dt <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">rbindlist</span>(</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>            <span class="fu">lapply</span>(pl<span class="sc">$</span>tracks, <span class="cf">function</span>(t) {</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>              data.table<span class="sc">::</span><span class="fu">data.table</span>(</span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>                <span class="at">playlist_name =</span> pl<span class="sc">$</span>name,</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>                <span class="at">playlist_id =</span> pl<span class="sc">$</span>pid,</span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>                <span class="at">playlist_followers =</span> pl<span class="sc">$</span>num_followers,</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>                <span class="at">playlist_position =</span> t<span class="sc">$</span>pos,</span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>                <span class="at">artist_name =</span> t<span class="sc">$</span>artist_name,</span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>                <span class="at">track_name =</span> t<span class="sc">$</span>track_name,</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>                <span class="at">album_name =</span> t<span class="sc">$</span>album_name,</span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>                <span class="at">duration =</span> t<span class="sc">$</span>duration_ms,</span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>                <span class="at">artist_id =</span> <span class="fu">sub</span>(<span class="st">"spotify:artist:"</span>, <span class="st">""</span>, t<span class="sc">$</span>artist_uri),</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>                <span class="at">track_id =</span> <span class="fu">sub</span>(<span class="st">"spotify:track:"</span>, <span class="st">""</span>, t<span class="sc">$</span>track_uri), </span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>                <span class="at">album_id =</span> <span class="fu">sub</span>(<span class="st">"spotify:album:"</span>, <span class="st">""</span>, t<span class="sc">$</span>album_uri)</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>            }),</span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="cn">TRUE</span>  <span class="co"># Handle missing fields</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Add to all tracks</span></span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>          all_tracks <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">list</span>(all_tracks, tracks_dt), <span class="at">fill =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert back to tibble </span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>        result <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>(all_tracks) <span class="sc">%&gt;%</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Select columns in the same order as original</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>            playlist_name,</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>            playlist_position,</span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>            playlist_id, </span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>            playlist_followers,</span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>            artist_name,</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>            track_name, </span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>            album_name,</span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>            duration,</span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>            artist_id,</span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>            track_id,</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>            album_id</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(result)</span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>      }, <span class="at">error =</span> <span class="cf">function</span>(e) {</span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"Error processing file"</span>, file_path, <span class="st">":"</span>, e<span class="sc">$</span>message))</span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Process all downloaded files</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Processing playlist files..."</span>)</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>    all_playlists_data <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>()</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(local_files)) {</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>      file_path <span class="ot">&lt;-</span> local_files[i]</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(file_path)) {</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>        file_name <span class="ot">&lt;-</span> <span class="fu">basename</span>(file_path)</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>        <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Processing file"</span>, i, <span class="st">"of"</span>, <span class="fu">length</span>(local_files), <span class="st">":"</span>, file_name))</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>        result <span class="ot">&lt;-</span> <span class="fu">process_playlist_file_alt</span>(file_path)</span>
<span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(result) <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(result) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>          all_playlists_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_playlists_data, result)</span>
<span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the result to cache</span></span>
<span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>    cache_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"data"</span>, <span class="st">"mp03"</span>, <span class="st">"playlists_cache.rds"</span>)</span>
<span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Saving data to cache..."</span>)</span>
<span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>    <span class="fu">saveRDS</span>(all_playlists_data, cache_file)</span>
<span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(all_playlists_data)</span>
<span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load the playlists using defined function</span></span>
<span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>  playlists <span class="ot">&lt;-</span> <span class="fu">load_playlists</span>()</span>
<span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load from cache</span></span>
<span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>  playlists <span class="ot">&lt;-</span> <span class="fu">load_cached_data</span>()</span>
<span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the playlist data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(playlists) <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(playlists) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  playlists <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="fu">min</span>(<span class="dv">10</span>, <span class="fu">nrow</span>(playlists))) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="st">"html"</span>, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">caption =</span> <span class="st">"Sample of 10 Random Tracks from Playlists"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">align =</span> <span class="st">"l"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">full_width =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>                             <span class="at">font_size =</span> <span class="dv">11</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> <span class="st">"black"</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">min</span>(<span class="dv">10</span>, <span class="fu">nrow</span>(playlists)), <span class="at">by =</span> <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#1DB954"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">2</span>, <span class="fu">min</span>(<span class="dv">10</span>, <span class="fu">nrow</span>(playlists)), <span class="at">by =</span> <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#b3b3b3"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"500px"</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"No playlist data was loaded or the data frame is empty."</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="table table-hover table-condensed caption-top table-sm table-striped small" data-quarto-postprocess="true">
<caption>Sample of 10 Random Tracks from Playlists</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: black !important; position: sticky; top: 0; background-color: #FFFFFF;">playlist_name</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: black !important; position: sticky; top: 0; background-color: #FFFFFF;">playlist_position</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: black !important; position: sticky; top: 0; background-color: #FFFFFF;">playlist_id</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: black !important; position: sticky; top: 0; background-color: #FFFFFF;">playlist_followers</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: black !important; position: sticky; top: 0; background-color: #FFFFFF;">artist_name</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: black !important; position: sticky; top: 0; background-color: #FFFFFF;">track_name</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: black !important; position: sticky; top: 0; background-color: #FFFFFF;">album_name</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: black !important; position: sticky; top: 0; background-color: #FFFFFF;">duration</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: black !important; position: sticky; top: 0; background-color: #FFFFFF;">artist_id</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: black !important; position: sticky; top: 0; background-color: #FFFFFF;">track_id</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: black !important; position: sticky; top: 0; background-color: #FFFFFF;">album_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Skate</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">145</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">436627</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">1</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Rise Against</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Blood To Bleed</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Siren Song Of The Counter-Culture</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">228205</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">6Wr3hh341P84m3EI8qdn9O</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">5kagLFYUXfUYnaJmmr83Ai</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">1KZGuujnfwHjZ48hxCbhHk</td>
</tr>
<tr class="even">
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Trip</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">6</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">685421</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">1</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Kendall Street Company</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Marty Song</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Kendall Street Company</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">292522</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">6AKT0nNWeP4Eb7ntkeBOj9</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">7Jv61Z5NW3BycDytPKsKWo</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">5WbDojV1qIzwUoKP4JyfAO</td>
</tr>
<tr class="odd">
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Florida</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">15</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">649507</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">1</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Panic! At The Disco</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Death Of A Bachelor</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Death Of A Bachelor</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">203506</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">20JZFwl6HVl6yg8a4H3ZqK</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">1BECwm5qkaBwlbfo4kpYx8</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">6twKQ0EsUJHVlAr6XBylrj</td>
</tr>
<tr class="even">
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">fuk</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">13</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">702617</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">3</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Merk &amp; Kremont</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Sad Story (Out Of Luck)</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Sad Story (Out Of Luck)</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">212303</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">5rRcnWrevHgbuWjl7Lhft7</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">189qPV1Uiwf661GvF5RnX7</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">1e0E4hnQ3KLG2wVVJiCJZ4</td>
</tr>
<tr class="odd">
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Electronica</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">4</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">74388</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">1</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Andrew Rayel</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">How Do I Know [Mix Cut] - Armin van Buuren Intro Mix</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Universal Religion Chapter 6 (Recorded live at Privilege, Ibiza) [Mixed By Armin van Buuren]</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">428920</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">1UtBjqMZBAmqIPlDrKu7Tr</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">1eBEtBHGHMFfvK1m9MW48u</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">2jCvmeW6GYfyuPYr7HHjbC</td>
</tr>
<tr class="even">
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Road Trip!</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">55</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">753162</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">1</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Idina Menzel</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Let It Go - From "Frozen"/Soundtrack Version</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Frozen</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">223840</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">73Np75Wv2tju61Eo9Zw4IR</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">0qcr5FMsEO85NAQjrlDRKo</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">7lZs5r4oQV2nutddffLrg0</td>
</tr>
<tr class="odd">
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Sounds</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">41</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">654221</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">1</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Macklemore &amp; Ryan Lewis</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Ten Thousand Hours</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">The Heist [Deluxe Edition]</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">249534</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">5BcAKTbp20cv7tC5VqPFoC</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">4kb6pH28RIiSSVd2kfS1S0</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">0CoiTAUBiO70lic9p9Lboq</td>
</tr>
<tr class="even">
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">throwback</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">13</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">719762</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">8</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Jason Derulo</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">In My Head</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Jason Derulo</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">199026</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">07YZf4WDAMNwqr4jfgOZ8y</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">5BoIP8Eha5hwmRVURkC2Us</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">0aVJmVAeEx78nAA1rAKYf7</td>
</tr>
<tr class="odd">
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Sunday Mornings</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">36</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">652463</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">1</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Shovels &amp; Rope</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Fish Assassin</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">Swimmin' Time</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">83946</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">1M3BVQ36cqPQix8lQNCh4K</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">3RFHfLqJtZqMvnoV0FPnTb</td>
<td style="text-align: left; background-color: rgba(29, 185, 84, 255) !important;">73E17pS12tbOFb8zyaKITx</td>
</tr>
<tr class="even">
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">jams</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">214</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">225259</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">1</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">B√òRNS</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Sweet Dreams</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">Sweet Dreams</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">198743</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">1KP6TWI40m7p3QBTU6u2xo</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">2ZMsF5LXbuGkfLMr8U0IxU</td>
<td style="text-align: left; background-color: rgba(179, 179, 179, 255) !important;">5dGwkiX2Q98rDaUo4i7g71</td>
</tr>
</tbody>
</table>
</div>

</div>
</div>
</section>
<section id="task---3-rectangle-the-playlist-data" class="level2">
<h2 class="anchored" data-anchor-id="task---3-rectangle-the-playlist-data"><strong>task - 3 Rectangle the Playlist Data</strong></h2>
<p>The <code>rectangle_playlists()</code> function takes our raw <code>playlists</code> data and makes it analysis‚Äëready: it first strips off the Spotify URI prefixes from <code>artist_id</code>, <code>track_id</code>, and <code>album_id</code>. Next, it removes any duplicate track‚Äëposition combinations, converts key columns (like <code>playlist_id</code>, <code>playlist_position</code>, <code>playlist_followers</code>, and <code>duration</code>) to integers, standardizes all text to UTF‚Äë8 encoding, and finally orders every row by playlist and track position. We run this function to produce <code>rectangular_playlists</code>, save it as an <code>.rds</code> file under <code>data/mp03/rectangular_playlists.rds</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>playlist_data <span class="ot">&lt;-</span> <span class="cf">function</span>(playlists) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if data is empty or NULL</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(playlists) <span class="sc">||</span> <span class="fu">nrow</span>(playlists) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Warning: Input data has 0 rows. Returning empty dataframe with required columns."</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">playlist_name =</span> <span class="fu">character</span>(),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">playlist_followers =</span> <span class="fu">integer</span>(),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">track_name =</span> <span class="fu">character</span>(),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">artist_name =</span> <span class="fu">character</span>(),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">album_name =</span> <span class="fu">character</span>(),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">duration =</span> <span class="fu">integer</span>()</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print column names for diagnosis</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Input columns: "</span>, <span class="fu">paste</span>(<span class="fu">names</span>(playlists), <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a safer copy of the dataframe - using tibble to maintain consistency</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>(playlists)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add missing columns if needed</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  required_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"playlist_name"</span>, <span class="st">"playlist_followers"</span>, <span class="st">"track_name"</span>, </span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"artist_name"</span>, <span class="st">"album_name"</span>, <span class="st">"duration"</span>)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (col <span class="cf">in</span> required_cols) {</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>col <span class="sc">%in%</span> <span class="fu">names</span>(result)) {</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Adding missing column:"</span>, col))</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add column with appropriate default type</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (col <span class="sc">==</span> <span class="st">"playlist_followers"</span> <span class="sc">||</span> col <span class="sc">==</span> <span class="st">"duration"</span>) {</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        result[[col]] <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="dv">0</span>)  <span class="co"># Default integer value</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        result[[col]] <span class="ot">&lt;-</span> <span class="cn">NA_character_</span>  <span class="co"># Default character value</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert numeric columns safely</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> result <span class="sc">%&gt;%</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">playlist_followers =</span> <span class="fu">as.integer</span>(playlist_followers),</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">duration =</span> <span class="fu">as.integer</span>(duration)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replace NAs with defaults</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> result <span class="sc">%&gt;%</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">playlist_followers =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(<span class="fu">is.na</span>(playlist_followers), <span class="fu">as.integer</span>(<span class="dv">0</span>), playlist_followers),</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">duration =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(<span class="fu">is.na</span>(duration), <span class="fu">as.integer</span>(<span class="dv">0</span>), duration)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only the columns we need</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> result <span class="sc">%&gt;%</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(required_cols))</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Output dimensions: "</span>, <span class="fu">nrow</span>(result), <span class="st">" rows, "</span>, <span class="fu">ncol</span>(result), <span class="st">" columns"</span>)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to the playlists data from Task 2</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>playlist_data <span class="ot">&lt;-</span> <span class="fu">playlist_data</span>(playlists)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="task--4-exploring-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="task--4-exploring-the-dataset"><strong>Task -4 Exploring the Dataset</strong></h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Define Spotify color scheme to use consistently</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>spotify_green <span class="ot">&lt;-</span> <span class="st">"#1DB954"</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>spotify_black <span class="ot">&lt;-</span> <span class="st">"#191414"</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>spotify_gray <span class="ot">&lt;-</span> <span class="st">"#535353"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="question-1-how-many-distinct-tracks-and-artists-are-represented-in-the-playlist-data" class="level3">
<h3 class="anchored" data-anchor-id="question-1-how-many-distinct-tracks-and-artists-are-represented-in-the-playlist-data">Question 1: How many distinct tracks and artists are represented in the playlist data?</h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>count_distinct_items <span class="ot">&lt;-</span> <span class="cf">function</span>(playlist_data) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count distinct tracks</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  distinct_tracks <span class="ot">&lt;-</span> playlist_data <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(track_name) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count distinct artists </span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  distinct_artists <span class="ot">&lt;-</span> playlist_data <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(artist_name) <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>()</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create results list for return value</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">distinct_tracks =</span> distinct_tracks,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">distinct_artists =</span> distinct_artists</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a data frame for display</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  results_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Number of distinct tracks"</span>, <span class="st">"Number of distinct artists"</span>),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Count =</span> <span class="fu">c</span>(distinct_tracks, distinct_artists)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create and print the table</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  table_output_1 <span class="ot">&lt;-</span> results_df <span class="sc">%&gt;%</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"l"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), </span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="st">"left"</span>)</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print the table </span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>distinct_items <span class="ot">&lt;-</span> <span class="fu">count_distinct_items</span>(playlist_data)</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(distinct_items)</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="question-2-what-are-the-5-most-popular-tracks-in-the-playlist-data" class="level3">
<h3 class="anchored" data-anchor-id="question-2-what-are-the-5-most-popular-tracks-in-the-playlist-data">Question 2: What are the 5 most popular tracks in the playlist data?</h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>find_most_popular_tracks <span class="ot">&lt;-</span> <span class="cf">function</span>(playlist_data, <span class="at">top_n =</span> <span class="dv">5</span>) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group by track details and count occurrences</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  popular_tracks <span class="ot">&lt;-</span> playlist_data <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(track_name, artist_name) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">playlist_appearances =</span> <span class="fu">n</span>(),      </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">distinct_playlists =</span> <span class="fu">n_distinct</span>(playlist_name),  </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(playlist_appearances)) <span class="sc">%&gt;%</span>  </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(top_n)                             </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a formatted dataframe for display</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  display_tracks <span class="ot">&lt;-</span> popular_tracks <span class="sc">%&gt;%</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">Rank =</span> <span class="fu">row_number</span>(),</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">Track =</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, track_name, <span class="st">"</span><span class="sc">\"</span><span class="st"> by "</span>, artist_name),</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Playlist Appearances</span><span class="st">`</span> <span class="ot">=</span> playlist_appearances,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Distinct Playlists</span><span class="st">`</span> <span class="ot">=</span> distinct_playlists</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Rank, Track, <span class="st">`</span><span class="at">Playlist Appearances</span><span class="st">`</span>, <span class="st">`</span><span class="at">Distinct Playlists</span><span class="st">`</span>)</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print table with Spotify-inspired styling</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  table_output_2 <span class="ot">&lt;-</span> display_tracks <span class="sc">%&gt;%</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"l"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"condensed"</span>), </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span>top_n, <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, top_n, <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>) <span class="co"># light gray alternating rows</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(table_output_2)</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create visualization with Spotify colors</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  track_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(popular_tracks, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(<span class="fu">paste0</span>(track_name, <span class="st">" - "</span>, artist_name), playlist_appearances), </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">y =</span> playlist_appearances)) <span class="sc">+</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> spotify_green) <span class="sc">+</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Top"</span>, top_n, <span class="st">"Most Popular Tracks in Playlists"</span>),</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Track - Artist"</span>,</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Number of Appearances"</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">color =</span> spotify_black),</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_gray),</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_black),</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#E0E0E0"</span>),</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#F0F0F0"</span>)</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>popular_tracks <span class="ot">&lt;-</span> <span class="fu">find_most_popular_tracks</span>(playlist_data, <span class="at">top_n =</span> <span class="dv">5</span>)</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(popular_tracks)</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="question-3-what-is-the-most-popular-track-that-does-not-have-a-corresponding-entry-in-the-song-characteristics-data" class="level3">
<h3 class="anchored" data-anchor-id="question-3-what-is-the-most-popular-track-that-does-not-have-a-corresponding-entry-in-the-song-characteristics-data">Question 3: What is the most popular track that does not have a corresponding entry in the song characteristics data?</h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>find_popular_missing_track <span class="ot">&lt;-</span> <span class="cf">function</span>(playlist_data, songs_data) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define Spotify color scheme</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  spotify_green <span class="ot">&lt;-</span> <span class="st">"#1DB954"</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  spotify_black <span class="ot">&lt;-</span> <span class="st">"#191414"</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  spotify_gray <span class="ot">&lt;-</span> <span class="st">"#535353"</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure track_id is available in both datasets for joining</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If track_id is not available in the datasets, we'll use track_name and artist_name for joining</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"track_id"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(playlist_data) <span class="sc">||</span> <span class="sc">!</span><span class="st">"id"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(songs_data)) {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a joint key using track name and artist for matching</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    playlist_data <span class="ot">&lt;-</span> playlist_data <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">track_artist =</span> <span class="fu">paste</span>(track_name, artist_name, <span class="at">sep =</span> <span class="st">" - "</span>))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    songs_data <span class="ot">&lt;-</span> songs_data <span class="sc">%&gt;%</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">track_artist =</span> <span class="fu">paste</span>(name, artist, <span class="at">sep =</span> <span class="st">" - "</span>))</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find tracks in playlists that don't exist in songs data</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    missing_tracks <span class="ot">&lt;-</span> playlist_data <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">anti_join</span>(songs_data, <span class="at">by =</span> <span class="st">"track_artist"</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If track_id is available, use it for matching</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    missing_tracks <span class="ot">&lt;-</span> playlist_data <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">anti_join</span>(songs_data, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"track_id"</span> <span class="ot">=</span> <span class="st">"id"</span>))</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count occurrences of each missing track</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  popular_missing_tracks <span class="ot">&lt;-</span> missing_tracks <span class="sc">%&gt;%</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(track_name, artist_name) <span class="sc">%&gt;%</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">playlist_appearances =</span> <span class="fu">n</span>(),</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">distinct_playlists =</span> <span class="fu">n_distinct</span>(playlist_name),</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(playlist_appearances))</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the most popular missing track</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  most_popular_missing <span class="ot">&lt;-</span> <span class="fu">head</span>(popular_missing_tracks, <span class="dv">1</span>)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate percentage of all playlists</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  total_playlists <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(playlist_data<span class="sc">$</span>playlist_name)</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if we found any missing tracks</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(most_popular_missing) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    appearance_percentage <span class="ot">&lt;-</span> <span class="fu">round</span>(most_popular_missing<span class="sc">$</span>distinct_playlists <span class="sc">/</span> total_playlists <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a dataframe for the most popular missing track</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>    popular_missing_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Track name"</span>, <span class="st">"Artist"</span>, <span class="st">"Playlist appearances"</span>, </span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Distinct playlists"</span>, <span class="st">"Percentage of all playlists"</span>),</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">Value =</span> <span class="fu">c</span>(most_popular_missing<span class="sc">$</span>track_name, </span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>                most_popular_missing<span class="sc">$</span>artist_name,</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>                most_popular_missing<span class="sc">$</span>playlist_appearances,</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>                most_popular_missing<span class="sc">$</span>distinct_playlists,</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>                <span class="fu">paste0</span>(appearance_percentage, <span class="st">"%"</span>))</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print first table with Spotify styling</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>    table3 <span class="ot">&lt;-</span> popular_missing_df <span class="sc">%&gt;%</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>      <span class="fu">kable</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>      <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(popular_missing_df), <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>      <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(popular_missing_df), <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>) <span class="co"># light gray alternating rows</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(table3)</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Look at top 10 missing tracks</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>    top_missing <span class="ot">&lt;-</span> <span class="fu">head</span>(popular_missing_tracks, <span class="dv">10</span>)</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print second table with Spotify styling</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    table3a <span class="ot">&lt;-</span> top_missing <span class="sc">%&gt;%</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">kable</span>( </span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>            <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Track Name"</span>, <span class="st">"Artist"</span>, <span class="st">"Playlist Appearances"</span>, <span class="st">"Distinct Playlists"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>                    <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(top_missing), <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(top_missing), <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>)</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(table3a)</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"No missing tracks found.</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">most_popular_missing =</span> most_popular_missing,</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">top_missing_tracks =</span> popular_missing_tracks</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>missing_tracks <span class="ot">&lt;-</span> <span class="fu">find_popular_missing_track</span>(playlist_data, songs_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Metric
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Track name
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
One Dance
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Artist
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Drake
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Playlist appearances
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
12179
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Distinct playlists
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
5633
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Percentage of all playlists
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
10.98%
</td>
</tr>
</tbody>
</table>
<table class="table table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Track Name
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Artist
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Playlist Appearances
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Distinct Playlists
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
One Dance
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Drake
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
12179
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
5633
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Broccoli (feat. Lil Yachty)
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
DRAM
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
11845
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
5196
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Closer
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
The Chainsmokers
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
11656
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
5729
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Congratulations
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Post Malone
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
11310
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
4953
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
iSpy (feat. Lil Yachty)
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
KYLE
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
10052
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
4557
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
XO TOUR Llif3
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Lil Uzi Vert
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
9995
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
4338
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Bad and Boujee (feat. Lil Uzi Vert)
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Migos
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
9941
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
4404
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
No Problem (feat. Lil Wayne &amp; 2 Chainz)
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Chance The Rapper
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
9025
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
4258
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Jumpman
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Drake
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
8825
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
4123
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
I‚Äôm the One
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
DJ Khaled
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
8742
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
4182
</td>
</tr>
</tbody>
</table>
</section>
<section id="question-4-according-to-the-song-characteristics-data-what-is-the-most-danceable-track-how-often-does-it-appear-in-a-playlist" class="level3">
<h3 class="anchored" data-anchor-id="question-4-according-to-the-song-characteristics-data-what-is-the-most-danceable-track-how-often-does-it-appear-in-a-playlist">Question 4: According to the song characteristics data, what is the most ‚Äúdanceable‚Äù track? How often does it appear in a playlist?</h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>find_most_danceable_track <span class="ot">&lt;-</span> <span class="cf">function</span>(songs_data, playlist_data) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define Spotify color scheme</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  spotify_green <span class="ot">&lt;-</span> <span class="st">"#1DB954"</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  spotify_black <span class="ot">&lt;-</span> <span class="st">"#191414"</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  spotify_gray <span class="ot">&lt;-</span> <span class="st">"#535353"</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if the danceability column exists in the songs data</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"danceability"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(songs_data)) {</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"The songs data does not contain a 'danceability' column."</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the track with highest danceability score</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  most_danceable <span class="ot">&lt;-</span> songs_data <span class="sc">%&gt;%</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(danceability)) <span class="sc">%&gt;%</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create matching criteria for playlist data</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Match based on track name and artist name</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Function to clean strings for better matching</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  clean_string <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">"[[:punct:]]"</span>, <span class="st">""</span>, x))</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean track name and artist from most danceable track</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  danceable_track_name_clean <span class="ot">&lt;-</span> <span class="fu">clean_string</span>(most_danceable<span class="sc">$</span>name)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  danceable_artist_clean <span class="ot">&lt;-</span> <span class="fu">clean_string</span>(most_danceable<span class="sc">$</span>artist)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare for matching by cleaning playlist data</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  playlist_data_clean <span class="ot">&lt;-</span> playlist_data <span class="sc">%&gt;%</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">track_name_clean =</span> <span class="fu">clean_string</span>(track_name),</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">artist_name_clean =</span> <span class="fu">clean_string</span>(artist_name)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find matches - look for both exact and partial matches</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  match_track <span class="ot">&lt;-</span> playlist_data_clean <span class="sc">%&gt;%</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>      track_name_clean <span class="sc">==</span> danceable_track_name_clean <span class="sc">|</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>        (track_name_clean <span class="sc">%like%</span> danceable_track_name_clean <span class="sc">&amp;</span> </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>           artist_name_clean <span class="sc">%like%</span> danceable_artist_clean)</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If no exact matches found, try fuzzy matching</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(match_track) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    match_track <span class="ot">&lt;-</span> playlist_data_clean <span class="sc">%&gt;%</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">grepl</span>(danceable_track_name_clean, track_name_clean, <span class="at">fixed =</span> <span class="cn">TRUE</span>) <span class="sc">|</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>          <span class="fu">grepl</span>(danceable_artist_clean, artist_name_clean, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count occurrences in playlists</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>  appearance_count <span class="ot">&lt;-</span> <span class="fu">nrow</span>(match_track)</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>  distinct_playlists_count <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(match_track<span class="sc">$</span>playlist_name)</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate percentage of all playlists</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>  total_playlists <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(playlist_data<span class="sc">$</span>playlist_name)</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>  appearance_percentage <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    distinct_playlists_count <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">round</span>(distinct_playlists_count <span class="sc">/</span> total_playlists <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    <span class="dv">0</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create data frame for the most danceable track info</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>  danceable_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Track name"</span>, <span class="st">"Artist"</span>, <span class="st">"Danceability score"</span>, </span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Playlist appearances"</span>, <span class="st">"Distinct playlists"</span>, </span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Percentage of all playlists"</span>),</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>      most_danceable<span class="sc">$</span>name,</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>      most_danceable<span class="sc">$</span>artist,</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="fu">round</span>(most_danceable<span class="sc">$</span>danceability, <span class="dv">3</span>), <span class="st">" (scale 0-1)"</span>),</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(appearance_count <span class="sc">&gt;</span> <span class="dv">0</span>, appearance_count, <span class="st">"0"</span>),</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(distinct_playlists_count <span class="sc">&gt;</span> <span class="dv">0</span>, distinct_playlists_count, <span class="st">"0"</span>),</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(appearance_percentage <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="fu">paste0</span>(appearance_percentage, <span class="st">"%"</span>), <span class="st">"0%"</span>)</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print first table with Spotify styling</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>  tabledance <span class="ot">&lt;-</span> danceable_info <span class="sc">%&gt;%</span></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(danceable_info), <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(danceable_info), <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>) <span class="co"># light gray alternating rows</span></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(tabledance)</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get top 10 most danceable tracks</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>  top_danceable <span class="ot">&lt;-</span> songs_data <span class="sc">%&gt;%</span></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(danceability)) <span class="sc">%&gt;%</span></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(name, artist, danceability, energy, tempo)</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print second table with Spotify styling</span></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>  table4 <span class="ot">&lt;-</span> top_danceable <span class="sc">%&gt;%</span></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="st">"html"</span>, </span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>          <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Track Name"</span>, <span class="st">"Artist"</span>, <span class="st">"Danceability"</span>, <span class="st">"Energy"</span>, <span class="st">"Tempo"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"condensed"</span>), </span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>                  <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(top_danceable), <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(top_danceable), <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>) <span class="co"># light gray alternating rows</span></span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(table4)</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return results in a more structured way</span></span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">most_danceable_track =</span> most_danceable,</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">appearance_count =</span> appearance_count,</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">distinct_playlists =</span> distinct_playlists_count,</span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">top_danceable =</span> top_danceable</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>danceable_track <span class="ot">&lt;-</span> <span class="fu">find_most_danceable_track</span>(songs_data, playlist_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Metric
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Track name
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Funky Cold Medina
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Artist
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Tone-Loc
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Danceability score
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.988 (scale 0-1)
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Playlist appearances
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
298
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Distinct playlists
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
236
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Percentage of all playlists
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.46%
</td>
</tr>
</tbody>
</table>
<table class="table table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Track Name
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Artist
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Danceability
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Energy
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Tempo
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Funky Cold Medina
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Tone-Loc
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.988
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.633
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
117.493
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Go Girl
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Young Boss‚Äô
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.986
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.597
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
115.004
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Go Girl
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Trina‚Äô
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.986
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.597
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
115.004
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Go Girl
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Pitbull
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.986
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.597
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
115.004
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Go Girl
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Pitbull‚Äô
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.986
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.597
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
115.004
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Go Girl
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Trina‚Äô
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.986
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.597
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
115.004
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Go Girl
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Young Bo
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.986
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.597
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
115.004
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Stay Don‚Äôt Go
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Spoon
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.985
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.895
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
119.751
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Wake Up
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Run‚ÄìD.M.C.
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.982
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.979
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
119.659
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Teachers
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Daft Punk
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.980
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.486
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
123.206
</td>
</tr>
</tbody>
</table>
</section>
<section id="question-5-which-playlist-has-the-longest-average-track-length" class="level3">
<h3 class="anchored" data-anchor-id="question-5-which-playlist-has-the-longest-average-track-length">Question 5: Which playlist has the longest average track length?</h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>find_longest_avg_playlist <span class="ot">&lt;-</span> <span class="cf">function</span>(playlist_data, <span class="at">min_tracks =</span> <span class="dv">5</span>) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define Spotify color scheme</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  spotify_green <span class="ot">&lt;-</span> <span class="st">"#1DB954"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  spotify_black <span class="ot">&lt;-</span> <span class="st">"#191414"</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  spotify_gray <span class="ot">&lt;-</span> <span class="st">"#535353"</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate average duration for each playlist</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  playlist_durations <span class="ot">&lt;-</span> playlist_data <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(playlist_name) <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_duration_ms =</span> <span class="fu">mean</span>(duration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_duration_min =</span> <span class="fu">round</span>(<span class="fu">mean</span>(duration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">/</span> <span class="dv">60</span>, <span class="dv">2</span>),</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_duration_ms =</span> <span class="fu">sum</span>(duration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_duration_min =</span> <span class="fu">round</span>(<span class="fu">sum</span>(duration, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">/</span> <span class="dv">60</span>, <span class="dv">2</span>),</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">track_count =</span> <span class="fu">n</span>(),</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter playlists with minimum number of tracks to avoid outliers</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(track_count <span class="sc">&gt;=</span> min_tracks) <span class="sc">%&gt;%</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_duration_ms))</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the playlist with longest average</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  longest_avg_playlist <span class="ot">&lt;-</span> <span class="fu">head</span>(playlist_durations, <span class="dv">1</span>)</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get track details for this playlist</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  longest_playlist_tracks <span class="ot">&lt;-</span> playlist_data <span class="sc">%&gt;%</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(playlist_name <span class="sc">==</span> longest_avg_playlist<span class="sc">$</span>playlist_name) <span class="sc">%&gt;%</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(track_name, artist_name, duration) <span class="sc">%&gt;%</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">duration_min =</span> <span class="fu">round</span>(duration <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">/</span> <span class="dv">60</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(duration))</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create data frame for playlist info</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  playlist_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Playlist name"</span>, <span class="st">"Average track duration"</span>, </span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Total playlist duration"</span>, <span class="st">"Number of tracks"</span>),</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>      longest_avg_playlist<span class="sc">$</span>playlist_name,</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(longest_avg_playlist<span class="sc">$</span>avg_duration_min, <span class="st">"minutes"</span>),</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(longest_avg_playlist<span class="sc">$</span>total_duration_min, <span class="st">"minutes"</span>),</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>      longest_avg_playlist<span class="sc">$</span>track_count</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print first table with Spotify styling</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  table5 <span class="ot">&lt;-</span> playlist_info <span class="sc">%&gt;%</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span> </span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>)</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(table5)</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print second table with Spotify styling - top 5 longest tracks</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>  table5a <span class="ot">&lt;-</span> <span class="fu">head</span>(longest_playlist_tracks, <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="st">"html"</span>, </span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>          <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Track Name"</span>, <span class="st">"Artist"</span>, <span class="st">"Duration (ms)"</span>, <span class="st">"Duration (min)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"condensed"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">5</span>, <span class="fu">nrow</span>(longest_playlist_tracks)), <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">min</span>(<span class="dv">5</span>, <span class="fu">nrow</span>(longest_playlist_tracks)), <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>)</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(table5a)</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">longest_avg_playlist =</span> longest_avg_playlist,</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">longest_playlist_tracks =</span> longest_playlist_tracks</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>longest_playlist <span class="ot">&lt;-</span> <span class="fu">find_longest_avg_playlist</span>(playlist_data, <span class="at">min_tracks =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Metric
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Playlist name
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Para dormir
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Average track duration
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
38.46 minutes
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Total playlist duration
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
538.38 minutes
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Number of tracks
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
14
</td>
</tr>
</tbody>
</table>
<table class="table table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Track Name
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Artist
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Duration (ms)
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Duration (min)
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Rain Sounds - Rain Sound Ambience Soothing Natural Music for Midfulness Meditation, Relaxation, Spa, Yoga, Massage, Deep Sleep, Sound Therapy
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Sounds of Nature White Noise Sound Effects
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
3600000
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
60
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Rain Sounds - Rain Sound Ambience Soothing Natural Music for Midfulness Meditation, Relaxation, Spa, Yoga, Massage, Deep Sleep, Sound Therapy
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Sounds of Nature White Noise Sound Effects
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
3600000
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
60
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Rain Sounds - Rain Sound Ambience Soothing Natural Music for Midfulness Meditation, Relaxation, Spa, Yoga, Massage, Deep Sleep, Sound Therapy
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Sounds of Nature White Noise Sound Effects
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
3600000
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
60
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Rain Sounds - Rain Sound Ambience Soothing Natural Music for Midfulness Meditation, Relaxation, Spa, Yoga, Massage, Deep Sleep, Sound Therapy
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Sounds of Nature White Noise Sound Effects
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
3600000
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
60
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Rain Sounds - Rain Sound Ambience Soothing Natural Music for Midfulness Meditation, Relaxation, Spa, Yoga, Massage, Deep Sleep, Sound Therapy
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Sounds of Nature White Noise Sound Effects
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
3600000
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
60
</td>
</tr>
</tbody>
</table>
</section>
<section id="question-6-what-is-the-most-popular-playlist-on-spotify" class="level3">
<h3 class="anchored" data-anchor-id="question-6-what-is-the-most-popular-playlist-on-spotify">Question 6: What is the most popular playlist on Spotify?</h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>find_most_popular_playlist <span class="ot">&lt;-</span> <span class="cf">function</span>(playlist_data) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define Spotify color scheme</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  spotify_green <span class="ot">&lt;-</span> <span class="st">"#1DB954"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  spotify_black <span class="ot">&lt;-</span> <span class="st">"#191414"</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  spotify_gray <span class="ot">&lt;-</span> <span class="st">"#535353"</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group by playlist and get follower counts</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  playlist_popularity <span class="ot">&lt;-</span> playlist_data <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(playlist_name, playlist_followers) <span class="sc">%&gt;%</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">track_count =</span> <span class="fu">n</span>(),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">unique_artists =</span> <span class="fu">n_distinct</span>(artist_name),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(playlist_followers))</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the most popular playlist</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  most_popular <span class="ot">&lt;-</span> <span class="fu">head</span>(playlist_popularity, <span class="dv">1</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get most common artists in this playlist</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  popular_playlist_artists <span class="ot">&lt;-</span> playlist_data <span class="sc">%&gt;%</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(playlist_name <span class="sc">==</span> most_popular<span class="sc">$</span>playlist_name) <span class="sc">%&gt;%</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(artist_name, <span class="at">sort =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(<span class="dv">5</span>)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create data frame for playlist info</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  popular_info <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Playlist name"</span>, <span class="st">"Number of followers"</span>, </span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Number of tracks"</span>, <span class="st">"Number of unique artists"</span>),</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>      most_popular<span class="sc">$</span>playlist_name,</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>      most_popular<span class="sc">$</span>playlist_followers,</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>      most_popular<span class="sc">$</span>track_count,</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>      most_popular<span class="sc">$</span>unique_artists</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print first table with Spotify styling</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  table6 <span class="ot">&lt;-</span> popular_info <span class="sc">%&gt;%</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>), <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(table6)</span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print second table with Spotify styling</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  table6a <span class="ot">&lt;-</span> popular_playlist_artists <span class="sc">%&gt;%</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="st">"html"</span>, </span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>          <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Artist Name"</span>, <span class="st">"Number of Tracks"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(popular_playlist_artists), <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(popular_playlist_artists), <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>)</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(table6a)</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create visualization with Spotify colors</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>  popularity_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">head</span>(playlist_popularity, <span class="dv">10</span>), </span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(<span class="fu">substr</span>(playlist_name, <span class="dv">1</span>, <span class="dv">30</span>), playlist_followers), </span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>                                <span class="at">y =</span> playlist_followers)) <span class="sc">+</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> spotify_green) <span class="sc">+</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Top 10 Most Popular Spotify Playlists"</span>,</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Playlist Name"</span>,</span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Number of Followers"</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">color =</span> spotify_black),</span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_gray),</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_black),</span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#E0E0E0"</span>),</span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#F0F0F0"</span>)</span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(popularity_plot)</span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">most_popular_playlist =</span> most_popular,</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">popular_playlist_artists =</span> popular_playlist_artists,</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">top_popular_playlists =</span> <span class="fu">head</span>(playlist_popularity, <span class="dv">10</span>)</span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a> popular_playlist <span class="ot">&lt;-</span> <span class="fu">find_most_popular_playlist</span>(playlist_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Metric
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Playlist name
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Breaking Bad
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Number of followers
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
53519
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Number of tracks
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
106
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Number of unique artists
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
101
</td>
</tr>
</tbody>
</table>
<table class="table table-hover" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Artist Name
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Number of Tracks
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Dave Porter
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
25
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Bronx River Parkway
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
9
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Buddy Stuart
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
9
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Gnarls Barkley
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
9
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Badfinger
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
8
</td>
</tr>
</tbody>
</table>
<p><img src="mp03_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</section>
</section>
<section id="task-5-identifying-characteristics-of-popular-song" class="level2">
<h2 class="anchored" data-anchor-id="task-5-identifying-characteristics-of-popular-song"><strong>TASK-5 Identifying characteristics of Popular song</strong></h2>
<section id="joining-spotify-songs-and-playlist-data" class="level3">
<h3 class="anchored" data-anchor-id="joining-spotify-songs-and-playlist-data">Joining Spotify songs and playlist data</h3>
<p>I built a <code>combined_data()</code> function that takes our cleaned song metadata and the rectangular playlist table and stitches them together: it first cleans up the Spotify URIs so each track has a simple ID, then tallies how many times each track shows up (and in how many unique playlists), and finally performs an inner join to keep only songs with playlist appearances. Once merged, I enrich the dataset by parsing out the release year and decade, converting track durations into minutes, and then print a handy summary table that shows the number of rows in each input and the percentage of songs matched. To wrap up, I inspect the structure of the resulting combined data and display a small sample so you can quickly verify that everything merged and transformed correctly.</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an inner join between playlist_data and songs_data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> playlist_data <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(songs_data, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"track_name"</span> <span class="ot">=</span> <span class="st">"name"</span>, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"artist_name"</span> <span class="ot">=</span> <span class="st">"artist"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename the duration columns to avoid confusion</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">duration_playlist =</span> duration,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">duration_song =</span> duration_ms</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add additional useful features</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Process duration values (songs data has duration_ms)</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">duration_min =</span> duration_song <span class="sc">/</span> <span class="dv">60000</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Join summary</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>join_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Songs data rows"</span>, <span class="st">"Playlist data rows"</span>, <span class="st">"Combined data rows"</span>, </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Percentage of songs matched"</span>),</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(<span class="fu">nrow</span>(songs_data), <span class="fu">nrow</span>(playlist_data), <span class="fu">nrow</span>(combined_data), </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(<span class="fu">nrow</span>(combined_data) <span class="sc">/</span> <span class="fu">nrow</span>(songs_data), <span class="dv">2</span>))</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the join summary as kable</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(join_summary, <span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#f2f2f2"</span>)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Metric
</th>
<th style="text-align:right;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Songs data rows
</td>
<td style="text-align:right;">
226813.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Playlist data rows
</td>
<td style="text-align:right;">
18861931.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Combined data rows
</td>
<td style="text-align:right;">
11330796.00
</td>
</tr>
<tr>
<td style="text-align:left;">
Percentage of songs matched
</td>
<td style="text-align:right;">
49.96
</td>
</tr>
</tbody>
</table>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Define Spotify color scheme for consistent visuals</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a> spotify_green <span class="ot">&lt;-</span> <span class="st">"#1DB954"</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a> spotify_black <span class="ot">&lt;-</span> <span class="st">"#191414"</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a> spotify_gray <span class="ot">&lt;-</span> <span class="st">"#535353"</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a> spotify_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(spotify_green, <span class="st">"#1ED760"</span>, <span class="st">"#2D46B9"</span>, <span class="st">"#F573A0"</span>, <span class="st">"#509BF5"</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a> <span class="co"># Set theme for all plots</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a> theme_spotify <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme</span>(</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">color =</span> spotify_black, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> spotify_gray, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_gray, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_black, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#E0E0E0"</span>),</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#F0F0F0"</span>),</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_black, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_gray, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a> }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</section>
<section id="is-the-popularity-column-correlated-with-the-number-of-playlist-appearances" class="level3">
<h3 class="anchored" data-anchor-id="is-the-popularity-column-correlated-with-the-number-of-playlist-appearances"><strong>5.1 Is the <code>popularity</code> column correlated with the number of playlist appearances?</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Count track appearances across playlists</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a> track_appearances <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(id, track_name, artist_name, popularity) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">playlist_appearances =</span> <span class="fu">n_distinct</span>(playlist_name),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a> <span class="co"># Calculate correlation</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a> popularity_correlation <span class="ot">&lt;-</span> <span class="fu">cor</span>(track_appearances<span class="sc">$</span>popularity, </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                               track_appearances<span class="sc">$</span>playlist_appearances,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                               <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create a scatter plot with regression line</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a> pop_correlation_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(track_appearances, </span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">aes</span>(<span class="at">x =</span> popularity, <span class="at">y =</span> playlist_appearances)) <span class="sc">+</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> spotify_green) <span class="sc">+</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> spotify_black) <span class="sc">+</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Correlation Between Spotify Popularity Score and Playlist Appearances"</span>,</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Correlation coefficient:"</span>, <span class="fu">round</span>(popularity_correlation, <span class="dv">3</span>)),</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">"Spotify Popularity Score"</span>,</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"Number of Playlist Appearances (log scale)"</span>,</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">caption =</span> <span class="st">"Data source: Spotify Million Playlist Dataset &amp; Spotify API"</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">+</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">color =</span> <span class="st">"gray50"</span>),</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create a table for the correlation result</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a> corr_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>   <span class="at">Metric =</span> <span class="st">"Correlation between popularity and playlist appearances"</span>,</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>   <span class="at">Value =</span> <span class="fu">round</span>(popularity_correlation, <span class="dv">3</span>)</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create a boxplot to show playlist appearances distribution by popularity level</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a> pop_boxplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(track_appearances, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">cut_width</span>(popularity, <span class="dv">10</span>), </span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">y =</span> playlist_appearances)) <span class="sc">+</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> spotify_green, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Distribution of Playlist Appearances by Popularity Score"</span>,</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">"Spotify Popularity Score"</span>,</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"Playlist Appearances (log scale)"</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">+</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>     <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a> <span class="co"># Define popular songs threshold - top 10% of playlist appearances</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a> popularity_threshold <span class="ot">&lt;-</span> <span class="fu">quantile</span>(track_appearances<span class="sc">$</span>playlist_appearances, <span class="fl">0.90</span>)</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a> <span class="co"># Add a column to identify popular songs</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a> track_appearances <span class="ot">&lt;-</span> track_appearances <span class="sc">%&gt;%</span></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">is_popular =</span> playlist_appearances <span class="sc">&gt;=</span> popularity_threshold,</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a>          <span class="at">popularity_category =</span> <span class="fu">ifelse</span>(is_popular, <span class="st">"Popular"</span>, <span class="st">"Less Popular"</span>))</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a> <span class="co"># Check a song at the threshold</span></span>
<span id="cb14-67"><a href="#cb14-67" aria-hidden="true" tabindex="-1"></a> threshold_song <span class="ot">&lt;-</span> track_appearances <span class="sc">%&gt;%</span></span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(playlist_appearances <span class="sc">&gt;=</span> popularity_threshold) <span class="sc">%&gt;%</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(playlist_appearances) <span class="sc">%&gt;%</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a> <span class="co"># Apply the popular/less popular categorization to the main dataset</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a> combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a>   <span class="fu">left_join</span>(</span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a>     track_appearances <span class="sc">%&gt;%</span> </span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a>       <span class="fu">select</span>(id, playlist_appearances, is_popular, popularity_category),</span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a>     <span class="at">by =</span> <span class="st">"id"</span></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(pop_correlation_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="mp03_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(pop_boxplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="mp03_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid" width="672"></p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">kable</span>(corr_table, <span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#f2f2f2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Metric
</th>
<th style="text-align:right;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Correlation between popularity and playlist appearances
</td>
<td style="text-align:right;">
0.412
</td>
</tr>
</tbody>
</table>
<p><strong>Correlation between popularity score and playlist appearances:</strong></p>
<ul>
<li><p>Created scatter plot with regression line showing relationship between Spotify‚Äôs popularity metric and playlist appearances</p></li>
<li><p>Added a boxplot showing distribution by popularity ranges</p></li>
<li><p>Calculated and displayed the exact correlation coefficient</p></li>
</ul>
</section>
<section id="in-what-year-were-the-most-popular-songs-released" class="level3">
<h3 class="anchored" data-anchor-id="in-what-year-were-the-most-popular-songs-released"><strong>5.2 In what year were the most popular songs released?</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Filter out NA years and prepare data</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a> year_popularity <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">1950</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span> <span class="co"># Filter reasonable years</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(year, popularity_category) <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">song_count =</span> <span class="fu">n</span>(),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">avg_playlist_appearances =</span> <span class="fu">mean</span>(playlist_appearances),</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create a stacked bar chart with year on x-axis</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a> popular_years_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(year_popularity, </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> song_count, <span class="at">fill =</span> popularity_category)) <span class="sc">+</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Popular"</span> <span class="ot">=</span> spotify_green, <span class="st">"Less Popular"</span> <span class="ot">=</span> <span class="st">"#b3b3b3"</span>)) <span class="sc">+</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1950</span>, <span class="dv">2020</span>, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Distribution of Songs by Release Year"</span>,</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="st">"Showing popular vs. less popular songs"</span>,</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">"Release Year"</span>,</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"Number of Songs"</span>,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">fill =</span> <span class="st">"Popularity Category"</span>,</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">caption =</span> <span class="st">"Popular songs defined as top 10% by playlist appearances"</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">+</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create a plot showing the proportion of popular songs by year</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a> proportion_data <span class="ot">&lt;-</span> year_popularity <span class="sc">%&gt;%</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>     <span class="at">total =</span> <span class="fu">sum</span>(song_count),</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>     <span class="at">proportion =</span> song_count <span class="sc">/</span> total</span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>   ) </span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a> <span class="co"># Filter to popular songs only for the proportion plot</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a> proportion_popular <span class="ot">&lt;-</span> proportion_data <span class="sc">%&gt;%</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(popularity_category <span class="sc">==</span> <span class="st">"Popular"</span>)</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a> prop_years_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(proportion_popular, </span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> proportion)) <span class="sc">+</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="at">color =</span> spotify_green, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">color =</span> spotify_green, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">color =</span> spotify_black, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>()) <span class="sc">+</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1950</span>, <span class="dv">2020</span>, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Proportion of Popular Songs by Release Year"</span>,</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="st">"Shows when popular songs were most likely to be released"</span>,</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">"Release Year"</span>,</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"Proportion of Popular Songs"</span>,</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>     <span class="at">caption =</span> <span class="st">"Popular songs defined as top 10% by playlist appearances"</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">+</span></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a> <span class="co"># Find the year with most popular songs</span></span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a> most_popular_year <span class="ot">&lt;-</span> proportion_popular <span class="sc">%&gt;%</span></span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(proportion)) <span class="sc">%&gt;%</span></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create table for year with highest proportion of popular songs</span></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a> popular_year_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a>   <span class="at">Metric =</span> <span class="fu">c</span>(</span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Year with highest proportion of popular songs"</span>,</span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Proportion of popular songs in that year"</span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>   ),</span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>   <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>     most_popular_year<span class="sc">$</span>year,</span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>     scales<span class="sc">::</span><span class="fu">percent</span>(most_popular_year<span class="sc">$</span>proportion)</span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(popular_years_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="mp03_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(prop_years_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="mp03_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid" width="672"></p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">kable</span>(popular_year_table, <span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#f2f2f2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Metric
</th>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Year with highest proportion of popular songs
</td>
<td style="text-align:left;">
2020
</td>
</tr>
<tr>
<td style="text-align:left;">
Proportion of popular songs in that year
</td>
<td style="text-align:left;">
96%
</td>
</tr>
</tbody>
</table>
<p><strong>Release years of popular songs:</strong></p>
<ul>
<li><p>Defined ‚Äúpopular‚Äù songs as those in the top 10% of playlist appearances</p></li>
<li><p>Created stacked bar chart showing distribution by year</p></li>
<li><p>Added line chart showing proportion of popular songs by year</p></li>
<li><p>Identified the specific year with the highest proportion of popular songs</p></li>
</ul>
</section>
<section id="in-what-year-did-danceability-peak" class="level3">
<h3 class="anchored" data-anchor-id="in-what-year-did-danceability-peak"><strong>5.3 In what year did danceability peak?</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Calculate average danceability by year</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a> danceability_by_year <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">1950</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">avg_danceability =</span> <span class="fu">mean</span>(danceability, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">songs_count =</span> <span class="fu">n</span>(),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Filter years with enough data points</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(songs_count <span class="sc">&gt;=</span> <span class="dv">10</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create plot for danceability trends</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a> danceability_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(danceability_by_year, </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> avg_danceability)) <span class="sc">+</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="at">color =</span> spotify_green, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> songs_count), <span class="at">color =</span> spotify_green, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">color =</span> spotify_black, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="at">name =</span> <span class="st">"Number of Songs"</span>) <span class="sc">+</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1950</span>, <span class="dv">2020</span>, <span class="at">by =</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Average Danceability Score by Release Year"</span>,</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="st">"Point size indicates number of songs from that year"</span>,</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">"Release Year"</span>,</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"Average Danceability Score"</span>,</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>     <span class="at">caption =</span> <span class="st">"Years with fewer than 10 songs are excluded"</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">+</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>     <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>     <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a> <span class="co"># Find the year with peak danceability</span></span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a> peak_danceability <span class="ot">&lt;-</span> danceability_by_year <span class="sc">%&gt;%</span></span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_danceability)) <span class="sc">%&gt;%</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create a table for peak danceability</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a> dance_peak_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>   <span class="at">Metric =</span> <span class="fu">c</span>(</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Year with peak average danceability"</span>,</span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Average danceability score"</span>,</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Number of songs from that year in dataset"</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>   ),</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>   <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>     peak_danceability<span class="sc">$</span>year,</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>     <span class="fu">round</span>(peak_danceability<span class="sc">$</span>avg_danceability, <span class="dv">3</span>),</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>     peak_danceability<span class="sc">$</span>songs_count</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(danceability_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="mp03_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">kable</span>(dance_peak_table, <span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#f2f2f2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Metric
</th>
<th style="text-align:right;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Year with peak average danceability
</td>
<td style="text-align:right;">
2017.000
</td>
</tr>
<tr>
<td style="text-align:left;">
Average danceability score
</td>
<td style="text-align:right;">
0.703
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of songs from that year in dataset
</td>
<td style="text-align:right;">
642475.000
</td>
</tr>
</tbody>
</table>
<p>** Peak years for danceability: **</p>
<ul>
<li><p>Generated line chart showing average danceability by release year</p></li>
<li><p>Used point size to indicate sample size for each year</p></li>
<li><p>Identified the exact year when danceability peaked</p></li>
</ul>
</section>
<section id="which-decade-is-most-represented-on-user-playlists" class="level3">
<h3 class="anchored" data-anchor-id="which-decade-is-most-represented-on-user-playlists"><strong>5.4 Which decade is most represented on user playlists?</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Calculate decade from year and count representations</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a> combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">release_decade =</span> (year <span class="sc">%/%</span> <span class="dv">10</span>) <span class="sc">*</span> <span class="dv">10</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a> decade_representation <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(release_decade)) <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(release_decade <span class="sc">&gt;=</span> <span class="dv">1950</span> <span class="sc">&amp;</span> release_decade <span class="sc">&lt;=</span> <span class="dv">2020</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(release_decade) <span class="sc">%&gt;%</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">song_count =</span> <span class="fu">n</span>(),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">total_playlist_appearances =</span> <span class="fu">sum</span>(playlist_appearances),</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">avg_appearances_per_song =</span> <span class="fu">mean</span>(playlist_appearances),</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(total_playlist_appearances))</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create a bar chart for decades</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a> decade_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(decade_representation, </span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(release_decade), </span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>                           <span class="at">y =</span> total_playlist_appearances)) <span class="sc">+</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> spotify_green, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(total_playlist_appearances)), </span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.9</span>),</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Total Playlist Appearances by Decade"</span>,</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="st">"Which decades are most represented in user playlists?"</span>,</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">"Decade"</span>,</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"Total Playlist Appearances"</span>,</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">caption =</span> <span class="st">"Based on song release decades"</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">+</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>     <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create a dual metric plot - songs per decade vs avg appearances</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a> decade_comparison <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(decade_representation) <span class="sc">+</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(release_decade), <span class="at">y =</span> song_count), </span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"#777777"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(release_decade), </span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> avg_appearances_per_song <span class="sc">*</span> <span class="dv">100</span>, </span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>                 <span class="at">group =</span> <span class="dv">1</span>), </span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> spotify_green, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(release_decade), </span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> avg_appearances_per_song <span class="sc">*</span> <span class="dv">100</span>), </span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> spotify_green, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_continuous</span>(</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>     <span class="at">name =</span> <span class="st">"Number of Songs"</span>,</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>     <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span> . <span class="sc">/</span> <span class="dv">100</span>, <span class="at">name =</span> <span class="st">"Avg Playlist Appearances per Song"</span>)</span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">+</span></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Songs Count vs Average Playlist Appearances by Decade"</span>,</span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="st">"Comparing quantity of songs with their average popularity"</span>,</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">"Decade"</span>,</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>     <span class="at">caption =</span> <span class="st">"Bars show number of songs, line shows average playlist appearances"</span></span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">+</span></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>     <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>     <span class="at">axis.title.y.left =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"#777777"</span>),</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>     <span class="at">axis.title.y.right =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_green),</span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a> <span class="co"># Report findings</span></span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a> most_represented_decade <span class="ot">&lt;-</span> decade_representation <span class="sc">%&gt;%</span> </span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(total_playlist_appearances)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create a table for most represented decade</span></span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a> decade_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>   <span class="at">Metric =</span> <span class="fu">c</span>(</span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Most represented decade in playlists"</span>,</span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Total playlist appearances"</span>,</span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Number of songs from this decade"</span>,</span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Average appearances per song"</span></span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>   ),</span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a>   <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a>     <span class="fu">paste0</span>(most_represented_decade<span class="sc">$</span>release_decade, <span class="st">"s"</span>),</span>
<span id="cb22-84"><a href="#cb22-84" aria-hidden="true" tabindex="-1"></a>     scales<span class="sc">::</span><span class="fu">comma</span>(most_represented_decade<span class="sc">$</span>total_playlist_appearances),</span>
<span id="cb22-85"><a href="#cb22-85" aria-hidden="true" tabindex="-1"></a>     scales<span class="sc">::</span><span class="fu">comma</span>(most_represented_decade<span class="sc">$</span>song_count),</span>
<span id="cb22-86"><a href="#cb22-86" aria-hidden="true" tabindex="-1"></a>     <span class="fu">round</span>(most_represented_decade<span class="sc">$</span>avg_appearances_per_song, <span class="dv">2</span>)</span>
<span id="cb22-87"><a href="#cb22-87" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb22-88"><a href="#cb22-88" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb22-89"><a href="#cb22-89" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(decade_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="mp03_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(decade_comparison)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="mp03_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">kable</span>(decade_table, <span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#f2f2f2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Metric
</th>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Most represented decade in playlists
</td>
<td style="text-align:left;">
2010s
</td>
</tr>
<tr>
<td style="text-align:left;">
Total playlist appearances
</td>
<td style="text-align:left;">
7,156,488,374
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of songs from this decade
</td>
<td style="text-align:left;">
5,393,872
</td>
</tr>
<tr>
<td style="text-align:left;">
Average appearances per song
</td>
<td style="text-align:left;">
1326.78
</td>
</tr>
</tbody>
</table>
<p><strong>Decades most represented in playlists</strong></p>
<ul>
<li><p>Created bar chart showing total playlist appearances by decade</p></li>
<li><p>Added dual-axis chart comparing song count vs.&nbsp;average appearances per song</p></li>
<li><p>Identified the most represented decade with supporting statistics</p></li>
</ul>
</section>
<section id="create-a-plot-of-key-frequency-using-polar-coordinates" class="level3">
<h3 class="anchored" data-anchor-id="create-a-plot-of-key-frequency-using-polar-coordinates"><strong>5.5 Create a plot of key frequency using polar coordinates</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Mapping of numerical keys to musical notation</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a> key_mapping <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>   <span class="st">"0"</span> <span class="ot">=</span> <span class="st">"C"</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>   <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"C‚ôØ/D‚ô≠"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>   <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"D"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>   <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"D‚ôØ/E‚ô≠"</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>   <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"E"</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>   <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"F"</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>   <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"F‚ôØ/G‚ô≠"</span>,</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>   <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"G"</span>,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>   <span class="st">"8"</span> <span class="ot">=</span> <span class="st">"G‚ôØ/A‚ô≠"</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>   <span class="st">"9"</span> <span class="ot">=</span> <span class="st">"A"</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>   <span class="st">"10"</span> <span class="ot">=</span> <span class="st">"A‚ôØ/B‚ô≠"</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>   <span class="st">"11"</span> <span class="ot">=</span> <span class="st">"B"</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a> <span class="co"># Count frequency of each key</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a> key_frequency <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(key)) <span class="sc">%&gt;%</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">key_name =</span> key_mapping[<span class="fu">as.character</span>(key)]) <span class="sc">%&gt;%</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(key, key_name) <span class="sc">%&gt;%</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">song_count =</span> <span class="fu">n</span>(),</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">total_appearances =</span> <span class="fu">sum</span>(playlist_appearances),</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">avg_popularity =</span> <span class="fu">mean</span>(popularity, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Order by circle of fifths (C, G, D, A, E, B, F#, C#, G#, D#, A#, F)</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>     <span class="at">circle_order =</span> <span class="fu">case_when</span>(</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>       key <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>,   <span class="co"># C</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>       key <span class="sc">==</span> <span class="dv">7</span> <span class="sc">~</span> <span class="dv">2</span>,   <span class="co"># G</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>       key <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="dv">3</span>,   <span class="co"># D</span></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>       key <span class="sc">==</span> <span class="dv">9</span> <span class="sc">~</span> <span class="dv">4</span>,   <span class="co"># A</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>       key <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="dv">5</span>,   <span class="co"># E</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>       key <span class="sc">==</span> <span class="dv">11</span> <span class="sc">~</span> <span class="dv">6</span>,  <span class="co"># B</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>       key <span class="sc">==</span> <span class="dv">6</span> <span class="sc">~</span> <span class="dv">7</span>,   <span class="co"># F#</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>       key <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="dv">8</span>,   <span class="co"># C#</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>       key <span class="sc">==</span> <span class="dv">8</span> <span class="sc">~</span> <span class="dv">9</span>,   <span class="co"># G#</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>       key <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="dv">10</span>,  <span class="co"># D#</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>       key <span class="sc">==</span> <span class="dv">10</span> <span class="sc">~</span> <span class="dv">11</span>, <span class="co"># A#</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>       key <span class="sc">==</span> <span class="dv">5</span> <span class="sc">~</span> <span class="dv">12</span>   <span class="co"># F</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(circle_order)</span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create a polar coordinate plot</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a> key_polar_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(key_frequency, </span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">aes</span>(<span class="at">x =</span> key_name, <span class="at">y =</span> total_appearances, <span class="at">fill =</span> avg_popularity)) <span class="sc">+</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coord_polar</span>() <span class="sc">+</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_fill_viridis</span>(<span class="at">option =</span> <span class="st">"viridis"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Musical Key Distribution in Spotify Playlists"</span>,</span>
<span id="cb25-55"><a href="#cb25-55" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="st">"Circle shows frequency of musical keys with color indicating average popularity"</span>,</span>
<span id="cb25-56"><a href="#cb25-56" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"Total Playlist Appearances"</span>,</span>
<span id="cb25-57"><a href="#cb25-57" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb25-58"><a href="#cb25-58" aria-hidden="true" tabindex="-1"></a>     <span class="at">fill =</span> <span class="st">"Avg. Popularity"</span></span>
<span id="cb25-59"><a href="#cb25-59" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">+</span></span>
<span id="cb25-60"><a href="#cb25-60" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb25-61"><a href="#cb25-61" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(</span>
<span id="cb25-62"><a href="#cb25-62" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb25-63"><a href="#cb25-63" aria-hidden="true" tabindex="-1"></a>     <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb25-64"><a href="#cb25-64" aria-hidden="true" tabindex="-1"></a>     <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb25-65"><a href="#cb25-65" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb25-66"><a href="#cb25-66" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb25-67"><a href="#cb25-67" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb25-68"><a href="#cb25-68" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create another version with popularity categories</span></span>
<span id="cb25-69"><a href="#cb25-69" aria-hidden="true" tabindex="-1"></a> key_popular_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span> </span>
<span id="cb25-70"><a href="#cb25-70" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(key)) <span class="sc">%&gt;%</span></span>
<span id="cb25-71"><a href="#cb25-71" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">key_name =</span> key_mapping[<span class="fu">as.character</span>(key)]) <span class="sc">%&gt;%</span></span>
<span id="cb25-72"><a href="#cb25-72" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(key_name, popularity_category) <span class="sc">%&gt;%</span></span>
<span id="cb25-73"><a href="#cb25-73" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">song_count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb25-74"><a href="#cb25-74" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb25-75"><a href="#cb25-75" aria-hidden="true" tabindex="-1"></a> key_popular_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(key_popular_data,</span>
<span id="cb25-76"><a href="#cb25-76" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">aes</span>(<span class="at">x =</span> key_name, <span class="at">y =</span> song_count, <span class="at">fill =</span> popularity_category)) <span class="sc">+</span></span>
<span id="cb25-77"><a href="#cb25-77" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb25-78"><a href="#cb25-78" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coord_polar</span>() <span class="sc">+</span></span>
<span id="cb25-79"><a href="#cb25-79" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Popular"</span> <span class="ot">=</span> spotify_green, <span class="st">"Less Popular"</span> <span class="ot">=</span> <span class="st">"#1E90FF"</span>)) <span class="sc">+</span></span>
<span id="cb25-80"><a href="#cb25-80" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb25-81"><a href="#cb25-81" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Distribution of Musical Keys by Popularity"</span>,</span>
<span id="cb25-82"><a href="#cb25-82" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="st">"Popular vs Less Popular Songs"</span>,</span>
<span id="cb25-83"><a href="#cb25-83" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb25-84"><a href="#cb25-84" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"Number of Songs"</span>,</span>
<span id="cb25-85"><a href="#cb25-85" aria-hidden="true" tabindex="-1"></a>     <span class="at">fill =</span> <span class="st">"Popularity Category"</span></span>
<span id="cb25-86"><a href="#cb25-86" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">+</span></span>
<span id="cb25-87"><a href="#cb25-87" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb25-88"><a href="#cb25-88" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(</span>
<span id="cb25-89"><a href="#cb25-89" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb25-90"><a href="#cb25-90" aria-hidden="true" tabindex="-1"></a>     <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb25-91"><a href="#cb25-91" aria-hidden="true" tabindex="-1"></a>     <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb25-92"><a href="#cb25-92" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>()</span>
<span id="cb25-93"><a href="#cb25-93" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb25-94"><a href="#cb25-94" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb25-95"><a href="#cb25-95" aria-hidden="true" tabindex="-1"></a> <span class="co"># Report most common key</span></span>
<span id="cb25-96"><a href="#cb25-96" aria-hidden="true" tabindex="-1"></a> most_common_key <span class="ot">&lt;-</span> key_frequency <span class="sc">%&gt;%</span> </span>
<span id="cb25-97"><a href="#cb25-97" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(total_appearances)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-98"><a href="#cb25-98" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb25-99"><a href="#cb25-99" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb25-100"><a href="#cb25-100" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create a table for the most common key</span></span>
<span id="cb25-101"><a href="#cb25-101" aria-hidden="true" tabindex="-1"></a> key_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb25-102"><a href="#cb25-102" aria-hidden="true" tabindex="-1"></a>   <span class="at">Metric =</span> <span class="fu">c</span>(</span>
<span id="cb25-103"><a href="#cb25-103" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Most common musical key"</span>,</span>
<span id="cb25-104"><a href="#cb25-104" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Songs in this key"</span>,</span>
<span id="cb25-105"><a href="#cb25-105" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Total playlist appearances"</span></span>
<span id="cb25-106"><a href="#cb25-106" aria-hidden="true" tabindex="-1"></a>   ),</span>
<span id="cb25-107"><a href="#cb25-107" aria-hidden="true" tabindex="-1"></a>   <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb25-108"><a href="#cb25-108" aria-hidden="true" tabindex="-1"></a>     most_common_key<span class="sc">$</span>key_name,</span>
<span id="cb25-109"><a href="#cb25-109" aria-hidden="true" tabindex="-1"></a>     most_common_key<span class="sc">$</span>song_count,</span>
<span id="cb25-110"><a href="#cb25-110" aria-hidden="true" tabindex="-1"></a>     scales<span class="sc">::</span><span class="fu">comma</span>(most_common_key<span class="sc">$</span>total_appearances)</span>
<span id="cb25-111"><a href="#cb25-111" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb25-112"><a href="#cb25-112" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb25-113"><a href="#cb25-113" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(key_polar_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="mp03_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(key_popular_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="mp03_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid" width="672"></p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">kable</span>(key_table, <span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#f2f2f2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Metric
</th>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Most common musical key
</td>
<td style="text-align:left;">
C‚ôØ/D‚ô≠
</td>
</tr>
<tr>
<td style="text-align:left;">
Songs in this key
</td>
<td style="text-align:left;">
1316669
</td>
</tr>
<tr>
<td style="text-align:left;">
Total playlist appearances
</td>
<td style="text-align:left;">
1,903,155,513
</td>
</tr>
</tbody>
</table>
<p><strong>Musical key distribution (polar coordinates)</strong></p>
<ul>
<li><p>Created circular plots showing frequency of musical keys</p></li>
<li><p>Mapped numerical keys to musical notation</p></li>
<li><p>Used color to indicate popularity or average popularity score</p></li>
<li><p>Created alternative view showing popular vs.&nbsp;less popular distribution</p></li>
</ul>
</section>
<section id="what-are-the-most-popular-track-lengths" class="level3">
<h3 class="anchored" data-anchor-id="what-are-the-most-popular-track-lengths"><strong>5.6 What are the most popular track lengths?</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create duration in minutes for easier categorization</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a> combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">duration_min =</span> duration_song <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">/</span> <span class="dv">60</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create duration categories</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a> duration_analysis <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">duration_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>       duration_min <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"&lt; 2 min"</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>       duration_min <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">&amp;</span> duration_min <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"2-3 min"</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>       duration_min <span class="sc">&gt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> duration_min <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"3-4 min"</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>       duration_min <span class="sc">&gt;=</span> <span class="dv">4</span> <span class="sc">&amp;</span> duration_min <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">~</span> <span class="st">"4-5 min"</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>       duration_min <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> duration_min <span class="sc">&lt;</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"5-6 min"</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>       duration_min <span class="sc">&gt;=</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"6+ min"</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>     ),</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">duration_category =</span> <span class="fu">factor</span>(duration_category, </span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>                                <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"&lt; 2 min"</span>, <span class="st">"2-3 min"</span>, <span class="st">"3-4 min"</span>, </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>                                           <span class="st">"4-5 min"</span>, <span class="st">"5-6 min"</span>, <span class="st">"6+ min"</span>))</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(duration_category, popularity_category) <span class="sc">%&gt;%</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">song_count =</span> <span class="fu">n</span>(),</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">total_appearances =</span> <span class="fu">sum</span>(playlist_appearances),</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">avg_appearances =</span> <span class="fu">mean</span>(playlist_appearances),</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create a stacked bar chart</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a> duration_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(duration_analysis, </span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">aes</span>(<span class="at">x =</span> duration_category, </span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>                             <span class="at">y =</span> song_count, </span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>                             <span class="at">fill =</span> popularity_category)) <span class="sc">+</span></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Popular"</span> <span class="ot">=</span> spotify_green, <span class="st">"Less Popular"</span> <span class="ot">=</span> <span class="st">"#b3b3b3"</span>)) <span class="sc">+</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Song Counts by Duration Category"</span>,</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="st">"Distribution of popular vs. less popular songs"</span>,</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">"Duration Category"</span>,</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"Number of Songs"</span>,</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>     <span class="at">fill =</span> <span class="st">"Popularity Category"</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">+</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>     <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a> <span class="co"># Calculate average playlist appearances by duration category</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a> duration_avg_data <span class="ot">&lt;-</span> duration_analysis <span class="sc">%&gt;%</span> </span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(duration_category) <span class="sc">%&gt;%</span></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarize</span>(<span class="at">avg_appearances =</span> <span class="fu">sum</span>(total_appearances) <span class="sc">/</span> <span class="fu">sum</span>(song_count))</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create a plot showing average playlist appearances by duration</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a> avg_appearances_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(duration_avg_data,</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">aes</span>(<span class="at">x =</span> duration_category, <span class="at">y =</span> avg_appearances)) <span class="sc">+</span></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> spotify_green, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(avg_appearances, <span class="dv">1</span>)), </span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>             <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">color =</span> spotify_black, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Average Playlist Appearances by Song Duration"</span>,</span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>     <span class="at">subtitle =</span> <span class="st">"Which song lengths are most frequently included in playlists?"</span>,</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">"Duration Category"</span>,</span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>     <span class="at">y =</span> <span class="st">"Average Playlist Appearances per Song"</span></span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">+</span></span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(</span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a> <span class="co"># Find most popular duration category</span></span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a> most_popular_duration <span class="ot">&lt;-</span> duration_avg_data <span class="sc">%&gt;%</span></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>   <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_appearances)) <span class="sc">%&gt;%</span></span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>   <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a> <span class="co"># Count songs in the most popular duration category</span></span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a> songs_in_category <span class="ot">&lt;-</span> <span class="fu">sum</span>(duration_analysis<span class="sc">$</span>song_count[</span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a>   duration_analysis<span class="sc">$</span>duration_category <span class="sc">==</span> most_popular_duration<span class="sc">$</span>duration_category])</span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create a table for most popular duration</span></span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a> duration_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a>   <span class="at">Metric =</span> <span class="fu">c</span>(</span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Most popular duration category"</span>,</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Average playlist appearances"</span>,</span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Number of songs in this category"</span></span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a>   ),</span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a>   <span class="at">Value =</span> <span class="fu">c</span>(</span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a>     <span class="fu">as.character</span>(most_popular_duration<span class="sc">$</span>duration_category),</span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a>     <span class="fu">round</span>(most_popular_duration<span class="sc">$</span>avg_appearances, <span class="dv">2</span>),</span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a>     songs_in_category</span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(duration_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="mp03_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(avg_appearances_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="mp03_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid" width="672"></p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">kable</span>(duration_table, <span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#f2f2f2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Metric
</th>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Most popular duration category
</td>
<td style="text-align:left;">
3-4 min
</td>
</tr>
<tr>
<td style="text-align:left;">
Average playlist appearances
</td>
<td style="text-align:left;">
1138.19
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of songs in this category
</td>
<td style="text-align:left;">
5699488
</td>
</tr>
</tbody>
</table>
<p><strong>Track length analysis</strong></p>
<ul>
<li><p>Categorized songs by duration ranges</p></li>
<li><p>Created stacked bar chart comparing popular vs.&nbsp;less popular songs</p></li>
<li><p>Added bar chart showing average playlist appearances by duration category</p></li>
<li><p>Identified optimal track length for playlist inclusion</p></li>
</ul>
</section>
<section id="how-do-audio-features-differ-between-popular-and-less-popular-songs" class="level3">
<h3 class="anchored" data-anchor-id="how-do-audio-features-differ-between-popular-and-less-popular-songs"><strong>5.7.1 How do audio features differ between popular and less popular songs?</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a long format dataset for comparing audio features</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>audio_features <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"danceability"</span>, <span class="st">"energy"</span>, <span class="st">"acousticness"</span>, </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"valence"</span>, <span class="st">"instrumentalness"</span>, <span class="st">"speechiness"</span>, <span class="st">"liveness"</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>audio_comparison <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(audio_features), popularity_category) <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">all_of</span>(audio_features),</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"feature"</span>,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean differences for each feature</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>feature_differences <span class="ot">&lt;-</span> audio_comparison <span class="sc">%&gt;%</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(feature, popularity_category) <span class="sc">%&gt;%</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_value =</span> <span class="fu">mean</span>(value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> popularity_category,</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> mean_value</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">difference =</span> Popular <span class="sc">-</span> <span class="st">`</span><span class="at">Less Popular</span><span class="st">`</span>,</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">percent_difference =</span> (difference <span class="sc">/</span> <span class="st">`</span><span class="at">Less Popular</span><span class="st">`</span>) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">kable</span>(feature_differences, <span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>                <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#f2f2f2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
feature
</th>
<th style="text-align:right;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Less Popular
</th>
<th style="text-align:right;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
Popular
</th>
<th style="text-align:right;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
difference
</th>
<th style="text-align:right;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
percent_difference
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
acousticness
</td>
<td style="text-align:right;">
0.2722641
</td>
<td style="text-align:right;">
0.1978791
</td>
<td style="text-align:right;">
-0.0743851
</td>
<td style="text-align:right;">
-27.320925
</td>
</tr>
<tr>
<td style="text-align:left;">
danceability
</td>
<td style="text-align:right;">
0.5735824
</td>
<td style="text-align:right;">
0.6157654
</td>
<td style="text-align:right;">
0.0421830
</td>
<td style="text-align:right;">
7.354305
</td>
</tr>
<tr>
<td style="text-align:left;">
energy
</td>
<td style="text-align:right;">
0.6342044
</td>
<td style="text-align:right;">
0.6636792
</td>
<td style="text-align:right;">
0.0294749
</td>
<td style="text-align:right;">
4.647536
</td>
</tr>
<tr>
<td style="text-align:left;">
instrumentalness
</td>
<td style="text-align:right;">
0.0578646
</td>
<td style="text-align:right;">
0.0202475
</td>
<td style="text-align:right;">
-0.0376171
</td>
<td style="text-align:right;">
-65.008791
</td>
</tr>
<tr>
<td style="text-align:left;">
liveness
</td>
<td style="text-align:right;">
0.1888513
</td>
<td style="text-align:right;">
0.1797443
</td>
<td style="text-align:right;">
-0.0091071
</td>
<td style="text-align:right;">
-4.822344
</td>
</tr>
<tr>
<td style="text-align:left;">
speechiness
</td>
<td style="text-align:right;">
0.0723519
</td>
<td style="text-align:right;">
0.0864362
</td>
<td style="text-align:right;">
0.0140843
</td>
<td style="text-align:right;">
19.466335
</td>
</tr>
<tr>
<td style="text-align:left;">
valence
</td>
<td style="text-align:right;">
0.5375293
</td>
<td style="text-align:right;">
0.5283512
</td>
<td style="text-align:right;">
-0.0091781
</td>
<td style="text-align:right;">
-1.707466
</td>
</tr>
</tbody>
</table>
<p><em>Used violin plots and percent difference charts to show how audio features differ between popular and less popular songs</em></p>
</section>
<section id="question-5.7.2-is-there-a-relationship-between-energy-and-danceability-and-does-it-differ-for-popular-songs" class="level3">
<h3 class="anchored" data-anchor-id="question-5.7.2-is-there-a-relationship-between-energy-and-danceability-and-does-it-differ-for-popular-songs"><strong>QUESTION 5.7.2: Is there a relationship between energy and danceability, and does it differ for popular songs?</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate correlation </span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  energy_dance_corr <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(popularity_category) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">correlation =</span> <span class="fu">cor</span>(energy, danceability, <span class="at">method =</span> <span class="st">"pearson"</span>),</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value =</span> <span class="fu">cor.test</span>(energy, danceability)<span class="sc">$</span>p.value,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">significance =</span> <span class="fu">ifelse</span>(p_value <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"***"</span>, </span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">ifelse</span>(p_value <span class="sc">&lt;</span> <span class="fl">0.01</span>, <span class="st">"**"</span>,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">ifelse</span>(p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"*"</span>, <span class="st">"ns"</span>))),</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">interpretation =</span> <span class="fu">case_when</span>(</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>        <span class="fu">abs</span>(correlation) <span class="sc">&lt;</span> <span class="fl">0.3</span> <span class="sc">~</span> <span class="st">"Weak"</span>,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">abs</span>(correlation) <span class="sc">&lt;</span> <span class="fl">0.5</span> <span class="sc">~</span> <span class="st">"Moderate"</span>,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">abs</span>(correlation) <span class="sc">&lt;</span> <span class="fl">0.7</span> <span class="sc">~</span> <span class="st">"Strong"</span>,</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Very Strong"</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co"># For the correlation table</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">kable</span>(energy_dance_corr, <span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#f2f2f2"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
popularity_category
</th>
<th style="text-align:right;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
correlation
</th>
<th style="text-align:right;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
p_value
</th>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
significance
</th>
<th style="text-align:left;font-weight: bold;background-color: rgba(242, 242, 242, 255) !important;">
interpretation
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Less Popular
</td>
<td style="text-align:right;">
0.0469552
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
***
</td>
<td style="text-align:left;">
Weak
</td>
</tr>
<tr>
<td style="text-align:left;">
Popular
</td>
<td style="text-align:right;">
-0.0619824
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
***
</td>
<td style="text-align:left;">
Weak
</td>
</tr>
</tbody>
</table>
<p><em>Created density contour plot showing relationship between these key features and how they differ for popular songs</em></p>
</section>
</section>
<section id="task-6-finding-related-songs" class="level2">
<h2 class="anchored" data-anchor-id="task-6-finding-related-songs"><strong>Task 6: Finding Related Songs</strong></h2>
<p>I created FIVE different ways to find related songs! üñêÔ∏è From playlist buddies to musical twins, artist families to year cousins, and theme soulmates - I covered EVERY angle! üíØ It was like building a musical friend-finder that actually WORKS! ü§ù I was jumping with excitement when my code successfully matched songs with similar vibes! üéâüéµ</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Define Spotify color scheme for consistent visuals</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a> spotify_green <span class="ot">&lt;-</span> <span class="st">"#1DB954"</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a> spotify_black <span class="ot">&lt;-</span> <span class="st">"#191414"</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a> spotify_gray <span class="ot">&lt;-</span> <span class="st">"#535353"</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a> spotify_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(spotify_green, <span class="st">"#1ED760"</span>, <span class="st">"#2D46B9"</span>, <span class="st">"#F573A0"</span>, <span class="st">"#509BF5"</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a> <span class="co"># Mapping of numerical keys to musical notation</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a> key_mapping <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>   <span class="st">"0"</span> <span class="ot">=</span> <span class="st">"C"</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>   <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"C‚ôØ/D‚ô≠"</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>   <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"D"</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>   <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"D‚ôØ/E‚ô≠"</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>   <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"E"</span>,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>   <span class="st">"5"</span> <span class="ot">=</span> <span class="st">"F"</span>,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>   <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"F‚ôØ/G‚ô≠"</span>,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>   <span class="st">"7"</span> <span class="ot">=</span> <span class="st">"G"</span>,</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>   <span class="st">"8"</span> <span class="ot">=</span> <span class="st">"G‚ôØ/A‚ô≠"</span>,</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>   <span class="st">"9"</span> <span class="ot">=</span> <span class="st">"A"</span>,</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>   <span class="st">"10"</span> <span class="ot">=</span> <span class="st">"A‚ôØ/B‚ô≠"</span>,</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>   <span class="st">"11"</span> <span class="ot">=</span> <span class="st">"B"</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a> <span class="co"># Define anchor songs</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a> anchor_songs <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>   <span class="at">artist_name =</span> <span class="fu">c</span>(<span class="st">"Kendrick Lamar"</span>, <span class="st">"Desiigner"</span>),</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>   <span class="at">track_name =</span> <span class="fu">c</span>(<span class="st">"HUMBLE."</span>, <span class="st">"Panda"</span>)</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a> <span class="co"># Print the anchor songs</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a> <span class="fu">kable</span>(anchor_songs, </span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Artist"</span>, <span class="st">"Track"</span>),</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Anchor Songs for Playlist Generation"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>                 <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>   <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>   <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(anchor_songs), <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-striped table-hover table-condensed caption-top" data-quarto-postprocess="true">
<caption>Anchor Songs for Playlist Generation</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: rgba(25, 20, 20, 255) !important;">Artist</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: rgba(25, 20, 20, 255) !important;">Track</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; color: rgba(25, 20, 20, 255) !important; background-color: white !important;">Kendrick Lamar</td>
<td style="text-align: left; color: rgba(25, 20, 20, 255) !important; background-color: white !important;">HUMBLE.</td>
</tr>
<tr class="even">
<td style="text-align: left; color: rgba(25, 20, 20, 255) !important; background-color: white !important;">Desiigner</td>
<td style="text-align: left; color: rgba(25, 20, 20, 255) !important; background-color: white !important;">Panda</td>
</tr>
</tbody>
</table>


<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Function to identify the anchor songs in our dataset</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a> find_anchor_songs <span class="ot">&lt;-</span> <span class="cf">function</span>(combined_data, anchor_songs) {</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Clean function for better matching</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>   clean_string <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">tolower</span>(<span class="fu">gsub</span>(<span class="st">"[[:punct:]]"</span>, <span class="st">""</span>, x))</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>   anchor_data <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>()</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(anchor_songs)) {</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Clean the search terms</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>     artist_clean <span class="ot">&lt;-</span> <span class="fu">clean_string</span>(anchor_songs<span class="sc">$</span>artist_name[i])</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>     track_clean <span class="ot">&lt;-</span> <span class="fu">clean_string</span>(anchor_songs<span class="sc">$</span>track_name[i])</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Search for matches in the data</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>     matches <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate</span>(</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">artist_clean_match =</span> <span class="fu">clean_string</span>(artist_name),</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">track_clean_match =</span> <span class="fu">clean_string</span>(track_name)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">%&gt;%</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>       <span class="fu">filter</span>(</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>         <span class="fu">grepl</span>(artist_clean, artist_clean_match, <span class="at">fixed =</span> <span class="cn">TRUE</span>) <span class="sc">&amp;</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>           <span class="fu">grepl</span>(track_clean, track_clean_match, <span class="at">fixed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">%&gt;%</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>       <span class="co"># Take the first match if multiple exist</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>       <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>       <span class="fu">select</span>(<span class="sc">-</span>artist_clean_match, <span class="sc">-</span>track_clean_match)</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Add to the results</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>     anchor_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(anchor_data, matches)</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Print information about anchors</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(<span class="fu">nrow</span>(anchor_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>     <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">"Found"</span>, <span class="fu">nrow</span>(anchor_data), <span class="st">"of"</span>, <span class="fu">nrow</span>(anchor_songs), <span class="st">"anchor songs in the dataset."</span>))</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Display the audio features of anchor songs</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>     anchor_features <span class="ot">&lt;-</span> anchor_data <span class="sc">%&gt;%</span></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>       <span class="fu">select</span>(artist_name, track_name, danceability, energy, tempo, key, mode, </span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>              acousticness, valence, popularity) <span class="sc">%&gt;%</span></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate</span>(<span class="at">key_name =</span> key_mapping[<span class="fu">as.character</span>(key)])</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(<span class="fu">kable</span>(anchor_features, </span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>                 <span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>                 <span class="at">caption =</span> <span class="st">"Audio Features of Anchor Songs"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>             <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>                           <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>             <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>             <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(anchor_features), <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black))</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>   } <span class="cf">else</span> {</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>     <span class="fu">warning</span>(<span class="st">"None of the anchor songs were found in the dataset."</span>)</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>     anchor_data <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(anchor_data)</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a> <span class="co"># Get anchor song data</span></span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a> anchor_data <span class="ot">&lt;-</span> <span class="fu">find_anchor_songs</span>(combined_data, anchor_songs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>
Audio Features of Anchor Songs
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
artist_name
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
track_name
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
danceability
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
energy
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
tempo
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
key
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
mode
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
acousticness
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
valence
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
popularity
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
key_name
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Kendrick Lamar
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
HUMBLE.
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.908
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.621
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
150.011
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
1
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.000282
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.421
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
83
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
C‚ôØ/D‚ô≠
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Desiigner
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Panda
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.601
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.695
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
101.564
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
10
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.021300
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.306
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
59
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
A‚ôØ/B‚ô≠
</td>
</tr>
</tbody>
</table>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/tvTRZJ-4EyI" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/4NJlUribp3c" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<section id="heuristic-1-songs-that-appear-on-the-same-playlists" class="level3">
<h3 class="anchored" data-anchor-id="heuristic-1-songs-that-appear-on-the-same-playlists"><strong>Heuristic 1: Songs that appear on the same playlists</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Heuristic 1: Songs that appear on the same playlists</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a> find_playlist_companions <span class="ot">&lt;-</span> <span class="cf">function</span>(anchor_data, combined_data, <span class="at">max_songs =</span> <span class="dv">10</span>) {</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Get the playlists that contain our anchor songs</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>   anchor_playlists <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">filter</span>(</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>       id <span class="sc">%in%</span> anchor_data<span class="sc">$</span>id</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(playlist_name) <span class="sc">%&gt;%</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">distinct</span>()</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Find other songs on these playlists</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>   companion_songs <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">inner_join</span>(anchor_playlists, <span class="at">by =</span> <span class="st">"playlist_name"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Exclude the anchor songs themselves</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>     <span class="fu">filter</span>(<span class="sc">!</span>(id <span class="sc">%in%</span> anchor_data<span class="sc">$</span>id)) <span class="sc">%&gt;%</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Count how many times each song appears across these playlists</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_by</span>(id, track_name, artist_name, popularity, danceability, </span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>              energy, tempo, key, mode, acousticness, valence) <span class="sc">%&gt;%</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>     <span class="fu">summarize</span>(</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">co_occurrences =</span> <span class="fu">n_distinct</span>(playlist_name),</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Sort by number of co-occurrences</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>     <span class="fu">arrange</span>(<span class="fu">desc</span>(co_occurrences)) <span class="sc">%&gt;%</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Categorize as popular or not</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">popularity_category =</span> <span class="fu">ifelse</span>(popularity <span class="sc">&gt;=</span> popularity_threshold, </span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Popular"</span>, <span class="st">"Less Popular"</span>)</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Take top matches</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>     <span class="fu">head</span>(max_songs)</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Create a display table</span></span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>   display_table <span class="ot">&lt;-</span> companion_songs <span class="sc">%&gt;%</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(track_name, artist_name, co_occurrences, popularity, popularity_category) <span class="sc">%&gt;%</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">Track =</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, track_name, <span class="st">"</span><span class="sc">\"</span><span class="st"> by "</span>, artist_name),</span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">Co-occurrences</span><span class="st">`</span> <span class="ot">=</span> co_occurrences,</span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>       <span class="at">Popularity =</span> popularity,</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">Category =</span> popularity_category</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(Track, <span class="st">`</span><span class="at">Co-occurrences</span><span class="st">`</span>, Popularity, Category)</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Print table with Spotify-inspired styling</span></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>   table_output <span class="ot">&lt;-</span> display_table <span class="sc">%&gt;%</span></span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>     <span class="fu">kable</span>(<span class="st">"html"</span>, <span class="at">caption =</span> <span class="st">"Songs that appear on the same playlists as anchor songs"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>     <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"condensed"</span>), </span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>                   <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(display_table), <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(display_table), <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>) <span class="co"># light gray alternating rows</span></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(table_output)</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(companion_songs)</span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a> playlist_companions <span class="ot">&lt;-</span> <span class="fu">find_playlist_companions</span>(anchor_data, combined_data, <span class="at">max_songs =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Songs that appear on the same playlists as anchor songs
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Track
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Co-occurrences
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Popularity
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Category
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúPanda‚Äù by Desiigner
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
4121
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
69
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúPanda‚Äù by Desiigner
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
4121
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
73
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúMask Off‚Äù by Future
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
3275
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
81
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúBounce Back‚Äù by Big Sean
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
3205
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
75
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúCaroline‚Äù by Amin√©
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
3200
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
76
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúDNA.‚Äù by Kendrick Lamar
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
3183
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
79
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚Äúgoosebumps‚Äù by Travis Scott
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
3095
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
70
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚Äúgoosebumps‚Äù by Travis Scott
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
3095
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
92
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúNo Role Modelz‚Äù by J. Cole
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
2963
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
82
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúFake Love‚Äù by Drake
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
2833
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
75
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
</tbody>
</table>
</section>
<section id="heuristic-2-songs-with-similar-key-and-tempo" class="level3">
<h3 class="anchored" data-anchor-id="heuristic-2-songs-with-similar-key-and-tempo"><strong>Heuristic 2: Songs with similar key and tempo</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a> find_musical_matches <span class="ot">&lt;-</span> <span class="cf">function</span>(anchor_data, combined_data, <span class="at">max_songs =</span> <span class="dv">10</span>) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Get the average musical characteristics of the anchor songs</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>   anchor_avg <span class="ot">&lt;-</span> anchor_data <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">summarize</span>(</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_tempo =</span> <span class="fu">mean</span>(tempo, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_danceability =</span> <span class="fu">mean</span>(danceability, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_energy =</span> <span class="fu">mean</span>(energy, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Get the keys and modes from our anchors</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>   anchor_keys <span class="ot">&lt;-</span> anchor_data <span class="sc">%&gt;%</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(key, mode) <span class="sc">%&gt;%</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">distinct</span>()</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Find songs with similar musical characteristics</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>   musical_matches <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Exclude the anchor songs</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>     <span class="fu">filter</span>(<span class="sc">!</span>(id <span class="sc">%in%</span> anchor_data<span class="sc">$</span>id)) <span class="sc">%&gt;%</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Find songs with matching keys/modes or similar tempo</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>     <span class="fu">inner_join</span>(anchor_keys, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"key"</span>, <span class="st">"mode"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Calculate how close the tempo is to our anchors</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">tempo_diff =</span> <span class="fu">abs</span>(tempo <span class="sc">-</span> anchor_avg<span class="sc">$</span>avg_tempo),</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">dance_diff =</span> <span class="fu">abs</span>(danceability <span class="sc">-</span> anchor_avg<span class="sc">$</span>avg_danceability),</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">energy_diff =</span> <span class="fu">abs</span>(energy <span class="sc">-</span> anchor_avg<span class="sc">$</span>avg_energy),</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>       <span class="co"># Combined score (lower is better)</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">similarity_score =</span> tempo_diff<span class="sc">/</span><span class="dv">20</span> <span class="sc">+</span> dance_diff <span class="sc">+</span> energy_diff</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Keep only certain columns</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(id, track_name, artist_name, key, mode, tempo, tempo_diff, </span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>            danceability, dance_diff, energy, energy_diff, similarity_score,</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>            popularity, acousticness, valence) <span class="sc">%&gt;%</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Sort by similarity</span></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>     <span class="fu">arrange</span>(similarity_score) <span class="sc">%&gt;%</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Categorize as popular or not</span></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">popularity_category =</span> <span class="fu">ifelse</span>(popularity <span class="sc">&gt;=</span> popularity_threshold, </span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Popular"</span>, <span class="st">"Less Popular"</span>)</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Take top matches</span></span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>     <span class="fu">head</span>(max_songs)</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Create a display table</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>   display_table <span class="ot">&lt;-</span> musical_matches <span class="sc">%&gt;%</span></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(track_name, artist_name, key, tempo, similarity_score, </span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>            popularity, popularity_category) <span class="sc">%&gt;%</span></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">Track =</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, track_name, <span class="st">"</span><span class="sc">\"</span><span class="st"> by "</span>, artist_name),</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">Key =</span> key_mapping[<span class="fu">as.character</span>(key)],</span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>       <span class="at">Tempo =</span> <span class="fu">round</span>(tempo, <span class="dv">1</span>),</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">Similarity Score</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(similarity_score, <span class="dv">3</span>),</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>       <span class="at">Popularity =</span> popularity,</span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>       <span class="at">Category =</span> popularity_category</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(Track, Key, Tempo, <span class="st">`</span><span class="at">Similarity Score</span><span class="st">`</span>, Popularity, Category)</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Print table with Spotify-inspired styling</span></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a>   table_output <span class="ot">&lt;-</span> display_table <span class="sc">%&gt;%</span></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>     <span class="fu">kable</span>(<span class="st">"html"</span>, <span class="at">caption =</span> <span class="st">"Songs with similar key and tempo to anchor songs"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>     <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"condensed"</span>), </span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>                   <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(display_table), <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(display_table), <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>) <span class="co"># light gray alternating rows</span></span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(table_output)</span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb36-69"><a href="#cb36-69" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(musical_matches)</span>
<span id="cb36-70"><a href="#cb36-70" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb36-71"><a href="#cb36-71" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb36-72"><a href="#cb36-72" aria-hidden="true" tabindex="-1"></a> musical_matches <span class="ot">&lt;-</span> <span class="fu">find_musical_matches</span>(anchor_data, combined_data, <span class="at">max_songs =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Songs with similar key and tempo to anchor songs
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Track
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Key
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Tempo
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Similarity Score
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Popularity
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Category
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúBackmask‚Äù by Mindless Self Indulgence
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
A‚ôØ/B‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
125.8
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.067
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
38
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúBackmask‚Äù by Mindless Self Indulgence
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
A‚ôØ/B‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
125.8
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.067
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
38
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúBackmask‚Äù by Mindless Self Indulgence
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
A‚ôØ/B‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
125.8
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.067
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
38
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúBackmask‚Äù by Mindless Self Indulgence
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
A‚ôØ/B‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
125.8
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.067
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
38
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúBrandy (You‚Äôre a Fine Girl)‚Äù by Looking Glass
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
C‚ôØ/D‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
125.3
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.098
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
74
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúBrandy (You‚Äôre a Fine Girl)‚Äù by Looking Glass
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
C‚ôØ/D‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
125.3
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.098
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
74
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúBrandy (You‚Äôre a Fine Girl)‚Äù by Looking Glass
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
C‚ôØ/D‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
125.3
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.098
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
74
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúBrandy (You‚Äôre a Fine Girl)‚Äù by Looking Glass
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
C‚ôØ/D‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
125.3
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.098
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
74
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúBrandy (You‚Äôre a Fine Girl)‚Äù by Looking Glass
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
C‚ôØ/D‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
125.3
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.098
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
74
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúBrandy (You‚Äôre a Fine Girl)‚Äù by Looking Glass
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
C‚ôØ/D‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
125.3
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.098
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
74
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
</tbody>
</table>
</section>
<section id="heuristic-3-songs-by-the-same-artists" class="level3">
<h3 class="anchored" data-anchor-id="heuristic-3-songs-by-the-same-artists"><strong>Heuristic 3: Songs by the same artists</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a> find_same_artist_songs <span class="ot">&lt;-</span> <span class="cf">function</span>(anchor_data, combined_data, <span class="at">max_songs =</span> <span class="dv">8</span>) {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Get the artists from our anchors</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>   anchor_artists <span class="ot">&lt;-</span> anchor_data <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(artist_name) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">distinct</span>()</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Find other songs by the same artists</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>   artist_songs <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Find songs by the same artists</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">inner_join</span>(anchor_artists, <span class="at">by =</span> <span class="st">"artist_name"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Exclude the anchor songs themselves</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>     <span class="fu">filter</span>(<span class="sc">!</span>(id <span class="sc">%in%</span> anchor_data<span class="sc">$</span>id)) <span class="sc">%&gt;%</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Keep only certain columns and unique songs</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>     <span class="fu">distinct</span>(id, track_name, artist_name, popularity, danceability, </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>              energy, tempo, key, mode, acousticness, valence, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Sort by popularity</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>     <span class="fu">arrange</span>(<span class="fu">desc</span>(popularity)) <span class="sc">%&gt;%</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Categorize as popular or not</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">popularity_category =</span> <span class="fu">ifelse</span>(popularity <span class="sc">&gt;=</span> popularity_threshold, </span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Popular"</span>, <span class="st">"Less Popular"</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Take top matches</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>     <span class="fu">head</span>(max_songs)</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Create a display table</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>   display_table <span class="ot">&lt;-</span> artist_songs <span class="sc">%&gt;%</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(track_name, artist_name, popularity, popularity_category, year) <span class="sc">%&gt;%</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">Track =</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, track_name, <span class="st">"</span><span class="sc">\"</span><span class="st">"</span>),</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">Artist =</span> artist_name,</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">Popularity =</span> popularity,</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">Category =</span> popularity_category,</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">Year =</span> year</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(Track, Artist, Year, Popularity, Category)</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Print table with Spotify-inspired styling</span></span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>   table_output <span class="ot">&lt;-</span> display_table <span class="sc">%&gt;%</span></span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>     <span class="fu">kable</span>(<span class="st">"html"</span>, <span class="at">caption =</span> <span class="st">"Other songs by the same artists"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>     <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"condensed"</span>), </span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>                   <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(display_table), <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(display_table), <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>) <span class="co"># light gray alternating rows</span></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(table_output)</span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(artist_songs)</span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a> artist_songs <span class="ot">&lt;-</span> <span class="fu">find_same_artist_songs</span>(anchor_data, combined_data, <span class="at">max_songs =</span> <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Other songs by the same artists
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Track
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Artist
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Year
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Popularity
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Category
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúDNA.‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Kendrick Lamar
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
2017
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
79
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúKing Kunta‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Kendrick Lamar
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
2015
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
74
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúAlright‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Kendrick Lamar
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
2015
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
74
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúAlright‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Kendrick Lamar
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
2015
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
74
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúPanda‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Desiigner
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
2016
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
73
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúSwimming Pools (Drank)‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Kendrick Lamar
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
2012
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
72
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúTiimmy Turner‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Desiigner
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
2016
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
71
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúELEMENT.‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Kendrick Lamar
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
2017
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
71
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
</tbody>
</table>
</section>
<section id="heuristic-4-songs-from-same-year-with-similar-acoustic-features" class="level3">
<h3 class="anchored" data-anchor-id="heuristic-4-songs-from-same-year-with-similar-acoustic-features"><strong>Heuristic 4: Songs from same year with similar acoustic features</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a> find_similar_year_songs <span class="ot">&lt;-</span> <span class="cf">function</span>(anchor_data, combined_data, <span class="at">max_songs =</span> <span class="dv">10</span>) {</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Get years and average features from anchor songs</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>   anchor_years <span class="ot">&lt;-</span> anchor_data <span class="sc">%&gt;%</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year)) <span class="sc">%&gt;%</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">distinct</span>()</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>   anchor_avg <span class="ot">&lt;-</span> anchor_data <span class="sc">%&gt;%</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">summarize</span>(</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_danceability =</span> <span class="fu">mean</span>(danceability, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_energy =</span> <span class="fu">mean</span>(energy, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_acousticness =</span> <span class="fu">mean</span>(acousticness, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_valence =</span> <span class="fu">mean</span>(valence, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Find songs from the same years with similar features</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>   year_songs <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Match songs from the same years</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>     <span class="fu">inner_join</span>(anchor_years, <span class="at">by =</span> <span class="st">"year"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Exclude the anchor songs</span></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>     <span class="fu">filter</span>(<span class="sc">!</span>(id <span class="sc">%in%</span> anchor_data<span class="sc">$</span>id)) <span class="sc">%&gt;%</span></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Calculate feature distance</span></span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">dance_diff =</span> <span class="fu">abs</span>(danceability <span class="sc">-</span> anchor_avg<span class="sc">$</span>avg_danceability),</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">energy_diff =</span> <span class="fu">abs</span>(energy <span class="sc">-</span> anchor_avg<span class="sc">$</span>avg_energy),</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">acousticness_diff =</span> <span class="fu">abs</span>(acousticness <span class="sc">-</span> anchor_avg<span class="sc">$</span>avg_acousticness),</span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">valence_diff =</span> <span class="fu">abs</span>(valence <span class="sc">-</span> anchor_avg<span class="sc">$</span>avg_valence),</span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>       <span class="co"># Overall similarity score (lower is better)</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">feature_similarity =</span> dance_diff <span class="sc">+</span> energy_diff <span class="sc">+</span> acousticness_diff <span class="sc">+</span> valence_diff</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Keep only certain columns</span></span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(id, track_name, artist_name, year, danceability, energy, </span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>            acousticness, valence, feature_similarity, popularity, tempo, key, mode) <span class="sc">%&gt;%</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Sort by similarity</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>     <span class="fu">arrange</span>(feature_similarity) <span class="sc">%&gt;%</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Categorize as popular or not</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">popularity_category =</span> <span class="fu">ifelse</span>(popularity <span class="sc">&gt;=</span> popularity_threshold, </span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"Popular"</span>, <span class="st">"Less Popular"</span>)</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Take top matches</span></span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>     <span class="fu">head</span>(max_songs)</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Create a display table</span></span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>   display_table <span class="ot">&lt;-</span> year_songs <span class="sc">%&gt;%</span></span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(track_name, artist_name, year, feature_similarity, </span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>            popularity, popularity_category) <span class="sc">%&gt;%</span></span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">Track =</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, track_name, <span class="st">"</span><span class="sc">\"</span><span class="st"> by "</span>, artist_name),</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>       <span class="at">Year =</span> year,</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">Feature Similarity</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(feature_similarity, <span class="dv">3</span>),</span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>       <span class="at">Popularity =</span> popularity,</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>       <span class="at">Category =</span> popularity_category</span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(Track, Year, <span class="st">`</span><span class="at">Feature Similarity</span><span class="st">`</span>, Popularity, Category)</span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Print table with Spotify-inspired styling</span></span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a>   table_output <span class="ot">&lt;-</span> display_table <span class="sc">%&gt;%</span></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>     <span class="fu">kable</span>(<span class="st">"html"</span>, <span class="at">caption =</span> <span class="st">"Songs from same years with similar acoustic features"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>     <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"condensed"</span>), </span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>                   <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(display_table), <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span></span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(display_table), <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>) <span class="co"># light gray alternating rows</span></span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(table_output)</span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(year_songs)</span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a> year_songs <span class="ot">&lt;-</span> <span class="fu">find_similar_year_songs</span>(anchor_data, combined_data, <span class="at">max_songs =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Songs from same years with similar acoustic features
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Track
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Year
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Feature Similarity
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Popularity
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Category
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúRansom‚Äù by A Boogie Wit da Hoodie
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
2016
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.063
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
55
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúRansom‚Äù by A Boogie Wit da Hoodie
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
2016
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.063
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
55
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúRansom‚Äù by A Boogie Wit da Hoodie
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
2016
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.063
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
55
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúRansom‚Äù by A Boogie Wit da Hoodie
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
2016
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.063
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
55
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúRansom‚Äù by A Boogie Wit da Hoodie
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
2016
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.063
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
55
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúRansom‚Äù by A Boogie Wit da Hoodie
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
2016
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.063
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
55
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúRansom‚Äù by A Boogie Wit da Hoodie
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
2016
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.063
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
55
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúRansom‚Äù by A Boogie Wit da Hoodie
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
2016
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.063
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
55
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúRansom‚Äù by A Boogie Wit da Hoodie
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
2016
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.063
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
55
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúRansom‚Äù by A Boogie Wit da Hoodie
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
2016
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.063
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
55
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Less Popular
</td>
</tr>
</tbody>
</table>
</section>
<section id="heuristic-5-songs-with-similar-lyrics-themes-custom-heuristic" class="level3">
<h3 class="anchored" data-anchor-id="heuristic-5-songs-with-similar-lyrics-themes-custom-heuristic"><strong>Heuristic 5: Songs with similar lyrics themes (custom heuristic)</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>find_thematic_matches <span class="ot">&lt;-</span> <span class="cf">function</span>(anchor_data, combined_data, <span class="at">max_songs =</span> <span class="dv">10</span>) {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For our anchor songs (Humble and Panda), we're looking for </span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># trap/hiphop songs with similar themes (status, luxury, braggadocio)</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># List of keywords related to these themes</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  theme_keywords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"money"</span>, <span class="st">"rich"</span>, <span class="st">"wealth"</span>, <span class="st">"baller"</span>, <span class="st">"boss"</span>, <span class="st">"stuntin"</span>, </span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"flex"</span>, <span class="st">"gang"</span>, <span class="st">"trap"</span>, <span class="st">"hustle"</span>, <span class="st">"lit"</span>, <span class="st">"swag"</span>, <span class="st">"designer"</span>, </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"gucci"</span>, <span class="st">"versace"</span>, <span class="st">"chain"</span>, <span class="st">"ice"</span>, <span class="st">"diamonds"</span>, <span class="st">"benz"</span>)</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create regex pattern for track name search</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  keyword_pattern <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">b("</span>, <span class="fu">paste</span>(theme_keywords, <span class="at">collapse =</span> <span class="st">"|"</span>), <span class="st">")</span><span class="sc">\\</span><span class="st">b"</span>)</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find songs with thematic similarity based on track names and genre hints</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  thematic_matches <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Exclude the anchor songs</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>(id <span class="sc">%in%</span> anchor_data<span class="sc">$</span>id)) <span class="sc">%&gt;%</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Look for tracks with relevant keywords or in hip-hop related albums</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">grepl</span>(keyword_pattern, <span class="fu">tolower</span>(track_name)) <span class="sc">|</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">grepl</span>(<span class="st">"rap"</span>, <span class="fu">tolower</span>(album_name)) <span class="sc">|</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">grepl</span>(<span class="st">"hip-hop"</span>, <span class="fu">tolower</span>(album_name)) <span class="sc">|</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">grepl</span>(<span class="st">"hip hop"</span>, <span class="fu">tolower</span>(album_name)) <span class="sc">|</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">grepl</span>(<span class="st">"trap"</span>, <span class="fu">tolower</span>(album_name))</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional filter for similar audio profile to our anchors</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>      danceability <span class="sc">&gt;</span> <span class="fl">0.6</span>,</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>      energy <span class="sc">&gt;</span> <span class="fl">0.6</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep only unique songs</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(id, track_name, artist_name, popularity, danceability, </span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>             energy, tempo, key, mode, acousticness, valence, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by popularity for better matches</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(popularity)) <span class="sc">%&gt;%</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Categorize as popular or not</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">popularity_category =</span> <span class="fu">ifelse</span>(popularity <span class="sc">&gt;=</span> popularity_threshold, </span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"Popular"</span>, <span class="st">"Less Popular"</span>),</span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">theme_match =</span> <span class="fu">if_else</span>(</span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">grepl</span>(keyword_pattern, <span class="fu">tolower</span>(track_name)), </span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Title theme match"</span>, </span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Genre match"</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Take top matches</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">head</span>(max_songs)</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a display table</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>  display_table <span class="ot">&lt;-</span> thematic_matches <span class="sc">%&gt;%</span></span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(track_name, artist_name, theme_match, popularity, popularity_category) <span class="sc">%&gt;%</span></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">Track =</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, track_name, <span class="st">"</span><span class="sc">\"</span><span class="st"> by "</span>, artist_name),</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Theme Match</span><span class="st">`</span> <span class="ot">=</span> theme_match,</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">Popularity =</span> <span class="fu">round</span>(popularity, <span class="dv">1</span>),</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">Category =</span> popularity_category</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Track, <span class="st">`</span><span class="at">Theme Match</span><span class="st">`</span>, Popularity, Category)</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Enhanced table styling</span></span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>  table_output <span class="ot">&lt;-</span> display_table <span class="sc">%&gt;%</span></span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="st">"html"</span>, </span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a>          <span class="at">caption =</span> <span class="st">"Songs with similar thematic elements"</span>,</span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>          <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"c"</span>, <span class="st">"r"</span>, <span class="st">"c"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"condensed"</span>), </span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>                  <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">width =</span> <span class="st">"45%"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column_spec</span>(<span class="dv">2</span>, <span class="at">width =</span> <span class="st">"20%"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column_spec</span>(<span class="dv">3</span>, <span class="at">width =</span> <span class="st">"15%"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column_spec</span>(<span class="dv">4</span>, <span class="at">width =</span> <span class="st">"20%"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="fu">which</span>(display_table<span class="sc">$</span>Category <span class="sc">==</span> <span class="st">"Less Popular"</span>), <span class="at">background =</span> <span class="st">"#f0f9f0"</span>)</span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print the table</span></span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(table_output)</span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(thematic_matches)</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function</span></span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>thematic_matches <span class="ot">&lt;-</span> <span class="fu">find_thematic_matches</span>(anchor_data, combined_data, <span class="at">max_songs =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Songs with similar thematic elements
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Track
</th>
<th style="text-align:center;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Theme Match
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Popularity
</th>
<th style="text-align:center;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Category
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 45%; background-color: rgba(240, 249, 240, 255) !important;">
‚Äúgoosebumps‚Äù by Travis Scott
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Genre match
</td>
<td style="text-align:right;width: 15%; background-color: rgba(240, 249, 240, 255) !important;">
92
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;width: 45%; background-color: rgba(240, 249, 240, 255) !important;">
‚ÄúTrap Queen‚Äù by Fetty Wap
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Title theme match
</td>
<td style="text-align:right;width: 15%; background-color: rgba(240, 249, 240, 255) !important;">
75
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;width: 45%; background-color: rgba(240, 249, 240, 255) !important;">
‚ÄúBitch Better Have My Money‚Äù by Rihanna
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Title theme match
</td>
<td style="text-align:right;width: 15%; background-color: rgba(240, 249, 240, 255) !important;">
75
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;width: 45%; background-color: rgba(240, 249, 240, 255) !important;">
‚ÄúPony‚Äù by Ginuwine
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Genre match
</td>
<td style="text-align:right;width: 15%; background-color: rgba(240, 249, 240, 255) !important;">
72
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;width: 45%; background-color: rgba(240, 249, 240, 255) !important;">
‚ÄúNo Money‚Äù by Galantis
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Title theme match
</td>
<td style="text-align:right;width: 15%; background-color: rgba(240, 249, 240, 255) !important;">
72
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;width: 45%; background-color: rgba(240, 249, 240, 255) !important;">
‚ÄúIce Ice Baby‚Äù by Vanilla Ice
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Title theme match
</td>
<td style="text-align:right;width: 15%; background-color: rgba(240, 249, 240, 255) !important;">
70
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;width: 45%; background-color: rgba(240, 249, 240, 255) !important;">
‚Äúgoosebumps‚Äù by Travis Scott
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Genre match
</td>
<td style="text-align:right;width: 15%; background-color: rgba(240, 249, 240, 255) !important;">
70
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;width: 45%; background-color: rgba(240, 249, 240, 255) !important;">
‚ÄúNo Money‚Äù by Galantis
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Title theme match
</td>
<td style="text-align:right;width: 15%; background-color: rgba(240, 249, 240, 255) !important;">
69
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;width: 45%; background-color: rgba(240, 249, 240, 255) !important;">
‚ÄúLifestyles of the Rich &amp; Famous‚Äù by Good Charlotte
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Title theme match
</td>
<td style="text-align:right;width: 15%; background-color: rgba(240, 249, 240, 255) !important;">
69
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Less Popular
</td>
</tr>
<tr>
<td style="text-align:left;width: 45%; background-color: rgba(240, 249, 240, 255) !important;">
‚ÄúDisco Inferno‚Äù by 50 Cent
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Genre match
</td>
<td style="text-align:right;width: 15%; background-color: rgba(240, 249, 240, 255) !important;">
69
</td>
<td style="text-align:center;width: 20%; background-color: rgba(240, 249, 240, 255) !important;">
Less Popular
</td>
</tr>
</tbody>
</table>
</section>
<section id="combine-all-candidates-and-select-a-diverse-set" class="level3">
<h3 class="anchored" data-anchor-id="combine-all-candidates-and-select-a-diverse-set"><strong>Combine all candidates and select a diverse set</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>combine_candidates <span class="ot">&lt;-</span> <span class="cf">function</span>(anchor_data, playlist_companions, musical_matches, </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                              artist_songs, year_songs, thematic_matches) {</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine all sources of recommendations</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  all_candidates <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    playlist_companions <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">source =</span> <span class="st">"Playlist companions"</span>),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    musical_matches <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">source =</span> <span class="st">"Musical matches"</span>),</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    artist_songs <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">source =</span> <span class="st">"Same artist"</span>),</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    year_songs <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">source =</span> <span class="st">"Same year"</span>),</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    thematic_matches <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">source =</span> <span class="st">"Thematic matches"</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove any duplicates</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure we have at least 20 candidates with at least 8 non-popular</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  popular_count <span class="ot">&lt;-</span> <span class="fu">sum</span>(all_candidates<span class="sc">$</span>popularity_category <span class="sc">==</span> <span class="st">"Popular"</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  less_popular_count <span class="ot">&lt;-</span> <span class="fu">sum</span>(all_candidates<span class="sc">$</span>popularity_category <span class="sc">==</span> <span class="st">"Less Popular"</span>)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">"Total candidates: "</span>, <span class="fu">nrow</span>(all_candidates), </span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>                <span class="st">" ("</span>, popular_count, <span class="st">" popular, "</span>, </span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>                less_popular_count, <span class="st">" less popular)"</span>))</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if we need more candidates</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(all_candidates) <span class="sc">&lt;</span> <span class="dv">20</span> <span class="sc">||</span> less_popular_count <span class="sc">&lt;</span> <span class="dv">8</span>) {</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Need more candidates, especially less popular ones."</span>)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Find additional less popular songs if needed</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(less_popular_count <span class="sc">&lt;</span> <span class="dv">8</span>) {</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>      additional_candidates <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Focus on less popular songs with similar features</span></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>          popularity <span class="sc">&lt;</span> popularity_threshold,</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>          <span class="sc">!</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(all_candidates<span class="sc">$</span>id, anchor_data<span class="sc">$</span>id)),</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Similar to our anchor songs</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>          <span class="fu">abs</span>(danceability <span class="sc">-</span> <span class="fu">mean</span>(anchor_data<span class="sc">$</span>danceability)) <span class="sc">&lt;</span> <span class="fl">0.2</span>,</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>          <span class="fu">abs</span>(energy <span class="sc">-</span> <span class="fu">mean</span>(anchor_data<span class="sc">$</span>energy)) <span class="sc">&lt;</span> <span class="fl">0.2</span></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(popularity)) <span class="sc">%&gt;%</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">head</span>(<span class="dv">8</span> <span class="sc">-</span> less_popular_count) <span class="sc">%&gt;%</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>          <span class="at">popularity_category =</span> <span class="st">"Less Popular"</span>,</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">source =</span> <span class="st">"Additional less popular"</span></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add to our pool</span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>      all_candidates <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_candidates, additional_candidates)</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add more candidates if still under 20 total</span></span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(all_candidates) <span class="sc">&lt;</span> <span class="dv">20</span>) {</span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>      more_candidates <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(</span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>          <span class="sc">!</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(all_candidates<span class="sc">$</span>id, anchor_data<span class="sc">$</span>id))</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Get songs with similar features to our anchors</span></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a>          <span class="at">dance_diff =</span> <span class="fu">abs</span>(danceability <span class="sc">-</span> <span class="fu">mean</span>(anchor_data<span class="sc">$</span>danceability)),</span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>          <span class="at">energy_diff =</span> <span class="fu">abs</span>(energy <span class="sc">-</span> <span class="fu">mean</span>(anchor_data<span class="sc">$</span>energy)),</span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>          <span class="at">similarity =</span> dance_diff <span class="sc">+</span> energy_diff</span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(similarity) <span class="sc">%&gt;%</span></span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">head</span>(<span class="dv">20</span> <span class="sc">-</span> <span class="fu">nrow</span>(all_candidates)) <span class="sc">%&gt;%</span></span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(</span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>          <span class="at">popularity_category =</span> <span class="fu">ifelse</span>(popularity <span class="sc">&gt;=</span> popularity_threshold, </span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">"Popular"</span>, <span class="st">"Less Popular"</span>),</span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>          <span class="at">source =</span> <span class="st">"Additional by similarity"</span></span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Add to our pool</span></span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>      all_candidates <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_candidates, more_candidates)</span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Final check of counts</span></span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a>  popular_count <span class="ot">&lt;-</span> <span class="fu">sum</span>(all_candidates<span class="sc">$</span>popularity_category <span class="sc">==</span> <span class="st">"Popular"</span>)</span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a>  less_popular_count <span class="ot">&lt;-</span> <span class="fu">sum</span>(all_candidates<span class="sc">$</span>popularity_category <span class="sc">==</span> <span class="st">"Less Popular"</span>)</span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">"Final candidates: "</span>, <span class="fu">nrow</span>(all_candidates), </span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true" tabindex="-1"></a>                <span class="st">" ("</span>, popular_count, <span class="st">" popular, "</span>, </span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true" tabindex="-1"></a>                less_popular_count, <span class="st">" less popular)"</span>))</span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a summary table</span></span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true" tabindex="-1"></a>  summary_table <span class="ot">&lt;-</span> all_candidates <span class="sc">%&gt;%</span></span>
<span id="cb40-83"><a href="#cb40-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(source, popularity_category) <span class="sc">%&gt;%</span></span>
<span id="cb40-84"><a href="#cb40-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-85"><a href="#cb40-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use complete to ensure all combinations exist before pivoting</span></span>
<span id="cb40-86"><a href="#cb40-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">complete</span>(source, popularity_category, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">count =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb40-87"><a href="#cb40-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(</span>
<span id="cb40-88"><a href="#cb40-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">names_from =</span> popularity_category, </span>
<span id="cb40-89"><a href="#cb40-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_from =</span> count,</span>
<span id="cb40-90"><a href="#cb40-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">values_fill =</span> <span class="dv">0</span>  <span class="co"># Fill NA values with 0</span></span>
<span id="cb40-91"><a href="#cb40-91" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb40-92"><a href="#cb40-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the actual column names in the mutate call</span></span>
<span id="cb40-93"><a href="#cb40-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-94"><a href="#cb40-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb40-95"><a href="#cb40-95" aria-hidden="true" tabindex="-1"></a>      <span class="at">Total =</span> <span class="fu">sum</span>(<span class="fu">c_across</span>(<span class="fu">where</span>(is.numeric)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-96"><a href="#cb40-96" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb40-97"><a href="#cb40-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb40-98"><a href="#cb40-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-99"><a href="#cb40-99" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count how many columns are in the summary table to correctly set up header</span></span>
<span id="cb40-100"><a href="#cb40-100" aria-hidden="true" tabindex="-1"></a>  summary_col_count <span class="ot">&lt;-</span> <span class="fu">ncol</span>(summary_table)</span>
<span id="cb40-101"><a href="#cb40-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-102"><a href="#cb40-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Enhanced table formatting for summary table - NO add_header_above</span></span>
<span id="cb40-103"><a href="#cb40-103" aria-hidden="true" tabindex="-1"></a>  summary_table_styled <span class="ot">&lt;-</span> summary_table <span class="sc">%&gt;%</span></span>
<span id="cb40-104"><a href="#cb40-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(</span>
<span id="cb40-105"><a href="#cb40-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb40-106"><a href="#cb40-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Candidate songs by source and popularity"</span>,</span>
<span id="cb40-107"><a href="#cb40-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="fu">rep</span>(<span class="st">"c"</span>, summary_col_count<span class="dv">-1</span>))</span>
<span id="cb40-108"><a href="#cb40-108" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb40-109"><a href="#cb40-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(</span>
<span id="cb40-110"><a href="#cb40-110" aria-hidden="true" tabindex="-1"></a>      <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb40-111"><a href="#cb40-111" aria-hidden="true" tabindex="-1"></a>      <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb40-112"><a href="#cb40-112" aria-hidden="true" tabindex="-1"></a>      <span class="at">position =</span> <span class="st">"center"</span></span>
<span id="cb40-113"><a href="#cb40-113" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb40-114"><a href="#cb40-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-115"><a href="#cb40-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="fu">nrow</span>(summary_table), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">background =</span> <span class="st">"#f5f5f5"</span>)</span>
<span id="cb40-116"><a href="#cb40-116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-117"><a href="#cb40-117" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print the enhanced summary table</span></span>
<span id="cb40-118"><a href="#cb40-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(summary_table_styled)</span>
<span id="cb40-119"><a href="#cb40-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-120"><a href="#cb40-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Format the candidate display table with improved styling</span></span>
<span id="cb40-121"><a href="#cb40-121" aria-hidden="true" tabindex="-1"></a>  candidate_display <span class="ot">&lt;-</span> all_candidates <span class="sc">%&gt;%</span></span>
<span id="cb40-122"><a href="#cb40-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(track_name, artist_name, popularity, popularity_category, source) <span class="sc">%&gt;%</span></span>
<span id="cb40-123"><a href="#cb40-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(popularity)) <span class="sc">%&gt;%</span></span>
<span id="cb40-124"><a href="#cb40-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb40-125"><a href="#cb40-125" aria-hidden="true" tabindex="-1"></a>      <span class="at">Track =</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, track_name, <span class="st">"</span><span class="sc">\"</span><span class="st"> by "</span>, artist_name),</span>
<span id="cb40-126"><a href="#cb40-126" aria-hidden="true" tabindex="-1"></a>      <span class="at">Popularity =</span> <span class="fu">round</span>(popularity, <span class="dv">1</span>),  <span class="co"># Round to 1 decimal place for cleaner display</span></span>
<span id="cb40-127"><a href="#cb40-127" aria-hidden="true" tabindex="-1"></a>      <span class="at">Category =</span> popularity_category,</span>
<span id="cb40-128"><a href="#cb40-128" aria-hidden="true" tabindex="-1"></a>      <span class="at">Source =</span> source</span>
<span id="cb40-129"><a href="#cb40-129" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb40-130"><a href="#cb40-130" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Track, Popularity, Category, Source)</span>
<span id="cb40-131"><a href="#cb40-131" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-132"><a href="#cb40-132" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Enhanced table formatting for candidate display</span></span>
<span id="cb40-133"><a href="#cb40-133" aria-hidden="true" tabindex="-1"></a>  candidate_table_styled <span class="ot">&lt;-</span> candidate_display <span class="sc">%&gt;%</span></span>
<span id="cb40-134"><a href="#cb40-134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(</span>
<span id="cb40-135"><a href="#cb40-135" aria-hidden="true" tabindex="-1"></a>      <span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb40-136"><a href="#cb40-136" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"All playlist candidates"</span>,</span>
<span id="cb40-137"><a href="#cb40-137" aria-hidden="true" tabindex="-1"></a>      <span class="at">align =</span> <span class="fu">c</span>(<span class="st">"l"</span>, <span class="st">"c"</span>, <span class="st">"c"</span>, <span class="st">"l"</span>)</span>
<span id="cb40-138"><a href="#cb40-138" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb40-139"><a href="#cb40-139" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(</span>
<span id="cb40-140"><a href="#cb40-140" aria-hidden="true" tabindex="-1"></a>      <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb40-141"><a href="#cb40-141" aria-hidden="true" tabindex="-1"></a>      <span class="at">full_width =</span> <span class="cn">TRUE</span>,</span>
<span id="cb40-142"><a href="#cb40-142" aria-hidden="true" tabindex="-1"></a>      <span class="at">position =</span> <span class="st">"center"</span></span>
<span id="cb40-143"><a href="#cb40-143" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb40-144"><a href="#cb40-144" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-145"><a href="#cb40-145" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="fu">which</span>(all_candidates<span class="sc">$</span>popularity_category <span class="sc">==</span> <span class="st">"Less Popular"</span>), </span>
<span id="cb40-146"><a href="#cb40-146" aria-hidden="true" tabindex="-1"></a>            <span class="at">background =</span> <span class="st">"#f0f9f0"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-147"><a href="#cb40-147" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">width =</span> <span class="st">"40%"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-148"><a href="#cb40-148" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column_spec</span>(<span class="dv">2</span>, <span class="at">width =</span> <span class="st">"15%"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-149"><a href="#cb40-149" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column_spec</span>(<span class="dv">3</span>, <span class="at">width =</span> <span class="st">"15%"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-150"><a href="#cb40-150" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column_spec</span>(<span class="dv">4</span>, <span class="at">width =</span> <span class="st">"30%"</span>)</span>
<span id="cb40-151"><a href="#cb40-151" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-152"><a href="#cb40-152" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print the enhanced candidate table</span></span>
<span id="cb40-153"><a href="#cb40-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(candidate_table_styled)</span>
<span id="cb40-154"><a href="#cb40-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-155"><a href="#cb40-155" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make sure to return the all_candidates object for subsequent functions</span></span>
<span id="cb40-156"><a href="#cb40-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(all_candidates)</span>
<span id="cb40-157"><a href="#cb40-157" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-158"><a href="#cb40-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-159"><a href="#cb40-159" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the function and store its result</span></span>
<span id="cb40-160"><a href="#cb40-160" aria-hidden="true" tabindex="-1"></a>all_candidates <span class="ot">&lt;-</span> <span class="fu">combine_candidates</span>(anchor_data, playlist_companions, musical_matches, </span>
<span id="cb40-161"><a href="#cb40-161" aria-hidden="true" tabindex="-1"></a>                                    artist_songs, year_songs, thematic_matches)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-striped table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Candidate songs by source and popularity
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
source
</th>
<th style="text-align:center;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Less Popular
</th>
<th style="text-align:center;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Total
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Musical matches
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
Playlist companions
</td>
<td style="text-align:center;">
10
</td>
<td style="text-align:center;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
Same artist
</td>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
Same year
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;background-color: rgba(245, 245, 245, 255) !important;">
Thematic matches
</td>
<td style="text-align:center;font-weight: bold;background-color: rgba(245, 245, 245, 255) !important;">
8
</td>
<td style="text-align:center;font-weight: bold;background-color: rgba(245, 245, 245, 255) !important;">
8
</td>
</tr>
</tbody>
</table>
<table class="table table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>
All playlist candidates
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Track
</th>
<th style="text-align:center;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Popularity
</th>
<th style="text-align:center;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Category
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Source
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚Äúgoosebumps‚Äù by Travis Scott
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
92
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Playlist companions
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúNo Role Modelz‚Äù by J. Cole
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
82
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Playlist companions
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúMask Off‚Äù by Future
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
81
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Playlist companions
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúDNA.‚Äù by Kendrick Lamar
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
79
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Playlist companions
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúCaroline‚Äù by Amin√©
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
76
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Playlist companions
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúBounce Back‚Äù by Big Sean
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
75
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Playlist companions
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúFake Love‚Äù by Drake
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
75
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Playlist companions
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúTrap Queen‚Äù by Fetty Wap
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
75
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Thematic matches
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúBitch Better Have My Money‚Äù by Rihanna
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
75
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Thematic matches
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúBrandy (You‚Äôre a Fine Girl)‚Äù by Looking Glass
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
74
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Musical matches
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúKing Kunta‚Äù by Kendrick Lamar
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
74
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Same artist
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúAlright‚Äù by Kendrick Lamar
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
74
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Same artist
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúAlright‚Äù by Kendrick Lamar
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
74
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Same artist
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúPanda‚Äù by Desiigner
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
73
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Playlist companions
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúSwimming Pools (Drank)‚Äù by Kendrick Lamar
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
72
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Same artist
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúPony‚Äù by Ginuwine
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
72
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Thematic matches
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúNo Money‚Äù by Galantis
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
72
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Thematic matches
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúTiimmy Turner‚Äù by Desiigner
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
71
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Same artist
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúELEMENT.‚Äù by Kendrick Lamar
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
71
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Same artist
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚Äúgoosebumps‚Äù by Travis Scott
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
70
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Playlist companions
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúIce Ice Baby‚Äù by Vanilla Ice
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
70
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Thematic matches
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúPanda‚Äù by Desiigner
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
69
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Playlist companions
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúNo Money‚Äù by Galantis
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
69
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Thematic matches
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúLifestyles of the Rich &amp; Famous‚Äù by Good Charlotte
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
69
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Thematic matches
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúDisco Inferno‚Äù by 50 Cent
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
69
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Thematic matches
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúRansom‚Äù by A Boogie Wit da Hoodie
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
55
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Same year
</td>
</tr>
<tr>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 40%; ">
‚ÄúBackmask‚Äù by Mindless Self Indulgence
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
38
</td>
<td style="text-align:center;background-color: rgba(240, 249, 240, 255) !important;width: 15%; ">
Less Popular
</td>
<td style="text-align:left;background-color: rgba(240, 249, 240, 255) !important;width: 30%; ">
Musical matches
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="task-7-create-the-ultimate-playlist" class="level2">
<h2 class="anchored" data-anchor-id="task-7-create-the-ultimate-playlist"><strong>Task 7: Create the Ultimate Playlist</strong></h2>
<p>THIS WAS MY MASTERPIECE! üë®‚Äçüé® I applied all my musical wisdom to craft the PERFECT playlist! üèÜ I balanced chart-toppers with hidden gems while creating the most satisfying audio journey EVER! üõ£Ô∏è When I saw my playlist flow visualizations, I literally gasped - they were THAT beautiful! üòç I‚Äôve basically become a data-driven DJ and I‚Äôm living for it! üéßüï∫</p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a> create_ultimate_playlist <span class="ot">&lt;-</span> <span class="cf">function</span>(anchor_data, all_candidates, <span class="at">target_size =</span> <span class="dv">12</span>) {</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Initialize the playlist with our anchor songs</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>   playlist <span class="ot">&lt;-</span> anchor_data <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">key_name =</span> key_mapping[<span class="fu">as.character</span>(key)]) <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(id, track_name, artist_name, danceability, energy, tempo, </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>            key, mode, acousticness, valence, popularity, duration_song,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>            year, key_name) <span class="sc">%&gt;%</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">playlist_position =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">source =</span> <span class="st">"Anchor"</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Create a list to track used combinations of artist_name and track_name </span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>   <span class="co"># to prevent duplicates</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>   used_tracks <span class="ot">&lt;-</span> playlist <span class="sc">%&gt;%</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">track_id =</span> <span class="fu">paste</span>(artist_name, track_name, <span class="at">sep =</span> <span class="st">" - "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>     <span class="fu">pull</span>(track_id)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Calculate target values for each position</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>   positions <span class="ot">&lt;-</span> target_size <span class="sc">-</span> <span class="fu">nrow</span>(playlist)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>   target_energy <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Rise phase</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>     <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">mean</span>(playlist<span class="sc">$</span>energy), </span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">to =</span> <span class="fl">0.9</span>, </span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">length.out =</span> <span class="fu">floor</span>(positions<span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span> <span class="dv">1</span>)[<span class="sc">-</span><span class="dv">1</span>],</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Plateau phase</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rep</span>(<span class="fl">0.9</span>, <span class="fu">floor</span>(positions<span class="sc">/</span><span class="dv">3</span>)),</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Fall phase</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>     <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.9</span>, </span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">to =</span> <span class="fl">0.7</span>, </span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">length.out =</span> <span class="fu">ceiling</span>(positions<span class="sc">/</span><span class="dv">3</span>))</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Calculate target danceability</span></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>   target_danceability <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Rise</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>     <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">mean</span>(playlist<span class="sc">$</span>danceability), </span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">to =</span> <span class="fl">0.8</span>, </span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">length.out =</span> <span class="fu">floor</span>(positions<span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span> <span class="dv">1</span>)[<span class="sc">-</span><span class="dv">1</span>],</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Plateau</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>     <span class="fu">rep</span>(<span class="fl">0.8</span>, <span class="fu">floor</span>(positions<span class="sc">/</span><span class="dv">3</span>)),</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Fall</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>     <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.8</span>, </span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">to =</span> <span class="fl">0.7</span>, </span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">length.out =</span> <span class="fu">ceiling</span>(positions<span class="sc">/</span><span class="dv">3</span>))</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Prepare candidate pool</span></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>   candidate_pool <span class="ot">&lt;-</span> all_candidates <span class="sc">%&gt;%</span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Add key name for better display</span></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">key_name =</span> key_mapping[<span class="fu">as.character</span>(key)]) <span class="sc">%&gt;%</span></span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Add a track_id field to check for duplicates</span></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">track_id =</span> <span class="fu">paste</span>(artist_name, track_name, <span class="at">sep =</span> <span class="st">" - "</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Exclude songs already in playlist and songs with the same name/artist</span></span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a>     <span class="fu">filter</span>(</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>       <span class="sc">!</span>(id <span class="sc">%in%</span> playlist<span class="sc">$</span>id),</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>       <span class="sc">!</span>(track_id <span class="sc">%in%</span> used_tracks)</span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Track if we've hit our requirements</span></span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>   less_popular_included <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>   required_less_popular <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Build the playlist position by position</span></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span> (pos <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>positions) {</span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>     current_position <span class="ot">&lt;-</span> <span class="fu">nrow</span>(playlist) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Get the last song in our playlist</span></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>     last_song <span class="ot">&lt;-</span> playlist <span class="sc">%&gt;%</span> </span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>       <span class="fu">filter</span>(playlist_position <span class="sc">==</span> <span class="fu">max</span>(playlist_position))</span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Determine what we need for this position</span></span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a>     target_e <span class="ot">&lt;-</span> target_energy[pos]</span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a>     target_d <span class="ot">&lt;-</span> target_danceability[pos]</span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Do we need a less popular song?</span></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a>     need_less_popular <span class="ot">&lt;-</span> (less_popular_included <span class="sc">&lt;</span> required_less_popular) <span class="sc">&amp;&amp;</span> </span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a>       (current_position <span class="sc">&gt;</span> target_size <span class="sc">-</span> required_less_popular)</span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Check if we have any candidates left</span></span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span>(<span class="fu">nrow</span>(candidate_pool) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a>       <span class="fu">warning</span>(<span class="st">"Ran out of candidates before completing the playlist."</span>)</span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a>       <span class="cf">break</span></span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Score each candidate for this position</span></span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a>     candidates_with_scores <span class="ot">&lt;-</span> candidate_pool <span class="sc">%&gt;%</span></span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a>       <span class="fu">mutate</span>(</span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Score for energy and danceability matching</span></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a>         <span class="at">energy_score =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">abs</span>(energy <span class="sc">-</span> target_e),</span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a>         <span class="at">dance_score =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">abs</span>(danceability <span class="sc">-</span> target_d),</span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Score for smooth key transition</span></span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a>         <span class="at">key_score =</span> <span class="fu">if_else</span>(key <span class="sc">==</span> last_song<span class="sc">$</span>key, <span class="fl">1.0</span>,</span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">if_else</span>(<span class="fu">abs</span>(key <span class="sc">-</span> last_song<span class="sc">$</span>key) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>), <span class="fl">0.8</span>, <span class="fl">0.5</span>)),</span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Score for popularity requirement</span></span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a>         <span class="at">popularity_score =</span> <span class="fu">case_when</span>(</span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a>           need_less_popular <span class="sc">&amp;</span> popularity <span class="sc">&lt;</span> popularity_threshold <span class="sc">~</span> <span class="fl">1.0</span>,</span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a>           need_less_popular <span class="sc">~</span> <span class="fl">0.2</span>,</span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a>           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fl">0.5</span></span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a>         ),</span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Combined score (higher is better)</span></span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_score =</span> (energy_score <span class="sc">*</span> <span class="dv">3</span> <span class="sc">+</span> dance_score <span class="sc">*</span> <span class="dv">3</span> <span class="sc">+</span> key_score <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> popularity_score <span class="sc">*</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="dv">10</span></span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">%&gt;%</span></span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true" tabindex="-1"></a>       <span class="fu">arrange</span>(<span class="fu">desc</span>(total_score))</span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb41-106"><a href="#cb41-106" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Select the best candidate</span></span>
<span id="cb41-107"><a href="#cb41-107" aria-hidden="true" tabindex="-1"></a>     best_candidate <span class="ot">&lt;-</span> candidates_with_scores <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">1</span>)</span>
<span id="cb41-108"><a href="#cb41-108" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb41-109"><a href="#cb41-109" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Add to our playlist</span></span>
<span id="cb41-110"><a href="#cb41-110" aria-hidden="true" tabindex="-1"></a>     playlist <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb41-111"><a href="#cb41-111" aria-hidden="true" tabindex="-1"></a>       playlist,</span>
<span id="cb41-112"><a href="#cb41-112" aria-hidden="true" tabindex="-1"></a>       best_candidate <span class="sc">%&gt;%</span></span>
<span id="cb41-113"><a href="#cb41-113" aria-hidden="true" tabindex="-1"></a>         <span class="fu">select</span>(id, track_name, artist_name, danceability, energy, tempo, </span>
<span id="cb41-114"><a href="#cb41-114" aria-hidden="true" tabindex="-1"></a>                key, mode, acousticness, valence, popularity, duration_song,</span>
<span id="cb41-115"><a href="#cb41-115" aria-hidden="true" tabindex="-1"></a>                year, key_name, source, track_id) <span class="sc">%&gt;%</span></span>
<span id="cb41-116"><a href="#cb41-116" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">playlist_position =</span> current_position)</span>
<span id="cb41-117"><a href="#cb41-117" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb41-118"><a href="#cb41-118" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb41-119"><a href="#cb41-119" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Update our tracking lists</span></span>
<span id="cb41-120"><a href="#cb41-120" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span> (best_candidate<span class="sc">$</span>popularity <span class="sc">&lt;</span> popularity_threshold) {</span>
<span id="cb41-121"><a href="#cb41-121" aria-hidden="true" tabindex="-1"></a>       less_popular_included <span class="ot">&lt;-</span> less_popular_included <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb41-122"><a href="#cb41-122" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb41-123"><a href="#cb41-123" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb41-124"><a href="#cb41-124" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Add this track to our used tracks list</span></span>
<span id="cb41-125"><a href="#cb41-125" aria-hidden="true" tabindex="-1"></a>     used_tracks <span class="ot">&lt;-</span> <span class="fu">c</span>(used_tracks, best_candidate<span class="sc">$</span>track_id)</span>
<span id="cb41-126"><a href="#cb41-126" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb41-127"><a href="#cb41-127" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Remove this song and any duplicate tracks from the candidate pool</span></span>
<span id="cb41-128"><a href="#cb41-128" aria-hidden="true" tabindex="-1"></a>     candidate_pool <span class="ot">&lt;-</span> candidate_pool <span class="sc">%&gt;%</span></span>
<span id="cb41-129"><a href="#cb41-129" aria-hidden="true" tabindex="-1"></a>       <span class="fu">filter</span>(</span>
<span id="cb41-130"><a href="#cb41-130" aria-hidden="true" tabindex="-1"></a>         id <span class="sc">!=</span> best_candidate<span class="sc">$</span>id,</span>
<span id="cb41-131"><a href="#cb41-131" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>(track_id <span class="sc">%in%</span> used_tracks)  <span class="co"># This removes any other instances of the same track</span></span>
<span id="cb41-132"><a href="#cb41-132" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb41-133"><a href="#cb41-133" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb41-134"><a href="#cb41-134" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-135"><a href="#cb41-135" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Clean up the final playlist</span></span>
<span id="cb41-136"><a href="#cb41-136" aria-hidden="true" tabindex="-1"></a>   playlist <span class="ot">&lt;-</span> playlist <span class="sc">%&gt;%</span></span>
<span id="cb41-137"><a href="#cb41-137" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(<span class="sc">-</span>track_id)  <span class="co"># Remove the temporary track_id column</span></span>
<span id="cb41-138"><a href="#cb41-138" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-139"><a href="#cb41-139" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Calculate the total playlist duration</span></span>
<span id="cb41-140"><a href="#cb41-140" aria-hidden="true" tabindex="-1"></a>   total_duration_ms <span class="ot">&lt;-</span> <span class="fu">sum</span>(playlist<span class="sc">$</span>duration_song, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-141"><a href="#cb41-141" aria-hidden="true" tabindex="-1"></a>   total_minutes <span class="ot">&lt;-</span> <span class="fu">round</span>(total_duration_ms <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">/</span> <span class="dv">60</span>, <span class="dv">1</span>)</span>
<span id="cb41-142"><a href="#cb41-142" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-143"><a href="#cb41-143" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Create a display table of the final playlist</span></span>
<span id="cb41-144"><a href="#cb41-144" aria-hidden="true" tabindex="-1"></a>   playlist_display <span class="ot">&lt;-</span> playlist <span class="sc">%&gt;%</span></span>
<span id="cb41-145"><a href="#cb41-145" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(playlist_position, track_name, artist_name, popularity, key_name, </span>
<span id="cb41-146"><a href="#cb41-146" aria-hidden="true" tabindex="-1"></a>            danceability, energy, source) <span class="sc">%&gt;%</span></span>
<span id="cb41-147"><a href="#cb41-147" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb41-148"><a href="#cb41-148" aria-hidden="true" tabindex="-1"></a>       <span class="at">Position =</span> playlist_position,</span>
<span id="cb41-149"><a href="#cb41-149" aria-hidden="true" tabindex="-1"></a>       <span class="at">Track =</span> <span class="fu">paste0</span>(<span class="st">"</span><span class="sc">\"</span><span class="st">"</span>, track_name, <span class="st">"</span><span class="sc">\"</span><span class="st">"</span>),</span>
<span id="cb41-150"><a href="#cb41-150" aria-hidden="true" tabindex="-1"></a>       <span class="at">Artist =</span> artist_name,</span>
<span id="cb41-151"><a href="#cb41-151" aria-hidden="true" tabindex="-1"></a>       <span class="at">Key =</span> key_name,</span>
<span id="cb41-152"><a href="#cb41-152" aria-hidden="true" tabindex="-1"></a>       <span class="at">Danceability =</span> <span class="fu">round</span>(danceability, <span class="dv">2</span>),</span>
<span id="cb41-153"><a href="#cb41-153" aria-hidden="true" tabindex="-1"></a>       <span class="at">Energy =</span> <span class="fu">round</span>(energy, <span class="dv">2</span>),</span>
<span id="cb41-154"><a href="#cb41-154" aria-hidden="true" tabindex="-1"></a>       <span class="at">Popularity =</span> popularity,</span>
<span id="cb41-155"><a href="#cb41-155" aria-hidden="true" tabindex="-1"></a>       <span class="at">Source =</span> source</span>
<span id="cb41-156"><a href="#cb41-156" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb41-157"><a href="#cb41-157" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(Position, Track, Artist, Key, Danceability, Energy, Popularity, Source)</span>
<span id="cb41-158"><a href="#cb41-158" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-159"><a href="#cb41-159" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Print table with Spotify-inspired styling</span></span>
<span id="cb41-160"><a href="#cb41-160" aria-hidden="true" tabindex="-1"></a>   table_output <span class="ot">&lt;-</span> playlist_display <span class="sc">%&gt;%</span></span>
<span id="cb41-161"><a href="#cb41-161" aria-hidden="true" tabindex="-1"></a>     <span class="fu">kable</span>(<span class="st">"html"</span>, <span class="at">caption =</span> <span class="st">"The Ultimate Playlist"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-162"><a href="#cb41-162" aria-hidden="true" tabindex="-1"></a>     <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"condensed"</span>), </span>
<span id="cb41-163"><a href="#cb41-163" aria-hidden="true" tabindex="-1"></a>                   <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-164"><a href="#cb41-164" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-165"><a href="#cb41-165" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(playlist_display), <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span></span>
<span id="cb41-166"><a href="#cb41-166" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(playlist_display), <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>) <span class="co"># light gray alternating rows</span></span>
<span id="cb41-167"><a href="#cb41-167" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-168"><a href="#cb41-168" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(table_output)</span>
<span id="cb41-169"><a href="#cb41-169" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb41-170"><a href="#cb41-170" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Return the playlist data for further analysis</span></span>
<span id="cb41-171"><a href="#cb41-171" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb41-172"><a href="#cb41-172" aria-hidden="true" tabindex="-1"></a>     <span class="at">playlist =</span> playlist,</span>
<span id="cb41-173"><a href="#cb41-173" aria-hidden="true" tabindex="-1"></a>     <span class="at">total_duration_ms =</span> total_duration_ms,</span>
<span id="cb41-174"><a href="#cb41-174" aria-hidden="true" tabindex="-1"></a>     <span class="at">total_minutes =</span> total_minutes</span>
<span id="cb41-175"><a href="#cb41-175" aria-hidden="true" tabindex="-1"></a>   ))</span>
<span id="cb41-176"><a href="#cb41-176" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb41-177"><a href="#cb41-177" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb41-178"><a href="#cb41-178" aria-hidden="true" tabindex="-1"></a> <span class="co"># Create our ultimate playlist</span></span>
<span id="cb41-179"><a href="#cb41-179" aria-hidden="true" tabindex="-1"></a> ultimate_playlist_data <span class="ot">&lt;-</span> <span class="fu">create_ultimate_playlist</span>(anchor_data, all_candidates, <span class="at">target_size =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<table class="table table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<caption>
The Ultimate Playlist
</caption>
<thead>
<tr>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Position
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Track
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Artist
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Key
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Danceability
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Energy
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Popularity
</th>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
Source
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
1
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúHUMBLE.‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Kendrick Lamar
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
C‚ôØ/D‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.91
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.62
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
83
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Anchor
</td>
</tr>
<tr>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
2
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúPanda‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Desiigner
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
A‚ôØ/B‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.60
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.70
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
59
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Anchor
</td>
</tr>
<tr>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
3
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúBackmask‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Mindless Self Indulgence
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
A‚ôØ/B‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.81
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.65
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
38
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Musical matches
</td>
</tr>
<tr>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
4
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúNo Role Modelz‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
J. Cole
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
A‚ôØ/B‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.70
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.52
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
82
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Playlist companions
</td>
</tr>
<tr>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
5
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúTrap Queen‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Fetty Wap
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
G
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.75
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.87
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
75
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Thematic matches
</td>
</tr>
<tr>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
6
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúAlright‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Kendrick Lamar
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
G
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.80
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.77
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
74
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Same artist
</td>
</tr>
<tr>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
7
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚Äúgoosebumps‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Travis Scott
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
G
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.84
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.73
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
92
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Playlist companions
</td>
</tr>
<tr>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
8
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúIce Ice Baby‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Vanilla Ice
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
D
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.98
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.79
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
70
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Thematic matches
</td>
</tr>
<tr>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
9
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúNo Money‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Galantis
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
F‚ôØ/G‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.67
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.92
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
69
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Thematic matches
</td>
</tr>
<tr>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
10
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúBitch Better Have My Money‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Rihanna
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
C‚ôØ/D‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.78
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.73
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
75
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Thematic matches
</td>
</tr>
<tr>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
11
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
‚ÄúRansom‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
A Boogie Wit da Hoodie
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
C‚ôØ/D‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.76
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.69
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
55
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Same year
</td>
</tr>
<tr>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
12
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
‚ÄúBrandy (You‚Äôre a Fine Girl)‚Äù
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Looking Glass
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
C‚ôØ/D‚ô≠
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.72
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.62
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
74
</td>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Musical matches
</td>
</tr>
</tbody>
</table>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a> ultimate_playlist <span class="ot">&lt;-</span> ultimate_playlist_data<span class="sc">$</span>playlist</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<section id="visualize-the-flow-of-the-playlist" class="level3">
<h3 class="anchored" data-anchor-id="visualize-the-flow-of-the-playlist"><strong>Visualize the flow of the playlist</strong></h3>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a> visualize_playlist_flow <span class="ot">&lt;-</span> <span class="cf">function</span>(playlist) {</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Gather the audio features for plotting</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>   features_long <span class="ot">&lt;-</span> playlist <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">select</span>(playlist_position, track_name, artist_name, </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>            danceability, energy, valence, acousticness) <span class="sc">%&gt;%</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">pivot_longer</span>(</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">cols =</span> <span class="fu">c</span>(danceability, energy, valence, acousticness),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">names_to =</span> <span class="st">"feature"</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>       <span class="co"># Capitalize feature names for better display</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">feature =</span> <span class="fu">str_to_title</span>(feature),</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>       <span class="co"># Create labels for the x-axis</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">track_label =</span> <span class="fu">paste0</span>(playlist_position, <span class="st">". "</span>, </span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">str_trunc</span>(track_name, <span class="dv">15</span>, <span class="st">"right"</span>), <span class="st">" - "</span>, </span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">str_trunc</span>(artist_name, <span class="dv">15</span>, <span class="st">"right"</span>))</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Create a line plot showing the flow of features across the playlist</span></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>   flow_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(features_long, </span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> playlist_position, <span class="at">y =</span> value, </span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>                           <span class="at">color =</span> feature, <span class="at">group =</span> feature)) <span class="sc">+</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span>  <span class="co"># Changed from size to linewidth</span></span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>     <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Danceability"</span> <span class="ot">=</span> spotify_green,</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Energy"</span> <span class="ot">=</span> <span class="st">"#509BF5"</span>,</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Valence"</span> <span class="ot">=</span> <span class="st">"#F573A0"</span>,</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>       <span class="st">"Acousticness"</span> <span class="ot">=</span> <span class="st">"#2D46B9"</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>     )) <span class="sc">+</span></span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> playlist<span class="sc">$</span>playlist_position,</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>                        <span class="at">labels =</span> <span class="fu">str_trunc</span>(playlist<span class="sc">$</span>track_name, <span class="dv">10</span>, <span class="st">"right"</span>)) <span class="sc">+</span></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>     <span class="fu">labs</span>(</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Flow of Musical Features Across the Playlist"</span>,</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Showing how energy, danceability, valence and acousticness evolve"</span>,</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Track Position"</span>,</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Feature Value (0-1)"</span>,</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Feature"</span></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">+</span></span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>     <span class="fu">theme</span>(</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">color =</span> spotify_black, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> spotify_gray, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_gray, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>       <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_black, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>       <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>       <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#E0E0E0"</span>),</span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#F0F0F0"</span>),</span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_black),</span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_gray)</span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Create a radar chart with only available features</span></span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Check which features are available in the dataset</span></span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>   available_features <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Danceability"</span> <span class="ot">=</span> <span class="st">"danceability"</span> <span class="sc">%in%</span> <span class="fu">names</span>(playlist),</span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Energy"</span> <span class="ot">=</span> <span class="st">"energy"</span> <span class="sc">%in%</span> <span class="fu">names</span>(playlist),</span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Valence"</span> <span class="ot">=</span> <span class="st">"valence"</span> <span class="sc">%in%</span> <span class="fu">names</span>(playlist),</span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Acousticness"</span> <span class="ot">=</span> <span class="st">"acousticness"</span> <span class="sc">%in%</span> <span class="fu">names</span>(playlist),</span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Instrumentalness"</span> <span class="ot">=</span> <span class="st">"instrumentalness"</span> <span class="sc">%in%</span> <span class="fu">names</span>(playlist),</span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Speechiness"</span> <span class="ot">=</span> <span class="st">"speechiness"</span> <span class="sc">%in%</span> <span class="fu">names</span>(playlist),</span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a>     <span class="st">"Liveness"</span> <span class="ot">=</span> <span class="st">"liveness"</span> <span class="sc">%in%</span> <span class="fu">names</span>(playlist)</span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Use only available features</span></span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a>   feature_names <span class="ot">&lt;-</span> <span class="fu">names</span>(available_features)[available_features]</span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a>   feature_cols <span class="ot">&lt;-</span> <span class="fu">tolower</span>(feature_names)</span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Prepare radar data only with available features</span></span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a>   radar_summary <span class="ot">&lt;-</span> playlist <span class="sc">%&gt;%</span></span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a>     <span class="fu">summarize_at</span>(<span class="fu">vars</span>(<span class="fu">all_of</span>(feature_cols)), mean) <span class="sc">%&gt;%</span></span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a>     <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), </span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a>                  <span class="at">names_to =</span> <span class="st">"feature"</span>, </span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a>                  <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb43-78"><a href="#cb43-78" aria-hidden="true" tabindex="-1"></a>       <span class="co"># Capitalize feature names</span></span>
<span id="cb43-79"><a href="#cb43-79" aria-hidden="true" tabindex="-1"></a>       <span class="at">feature =</span> <span class="fu">str_to_title</span>(feature),</span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"Playlist"</span></span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Create baseline data for available features</span></span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true" tabindex="-1"></a>   baseline_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb43-85"><a href="#cb43-85" aria-hidden="true" tabindex="-1"></a>     <span class="at">feature =</span> feature_names,</span>
<span id="cb43-86"><a href="#cb43-86" aria-hidden="true" tabindex="-1"></a>     <span class="at">value =</span> <span class="fl">0.5</span>,</span>
<span id="cb43-87"><a href="#cb43-87" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">"Baseline"</span></span>
<span id="cb43-88"><a href="#cb43-88" aria-hidden="true" tabindex="-1"></a>   )</span>
<span id="cb43-89"><a href="#cb43-89" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-90"><a href="#cb43-90" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Combine playlist data with baseline</span></span>
<span id="cb43-91"><a href="#cb43-91" aria-hidden="true" tabindex="-1"></a>   radar_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(radar_summary, baseline_data)</span>
<span id="cb43-92"><a href="#cb43-92" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-93"><a href="#cb43-93" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Create a radar chart (only if we have at least 3 features)</span></span>
<span id="cb43-94"><a href="#cb43-94" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(<span class="fu">length</span>(feature_names) <span class="sc">&gt;=</span> <span class="dv">3</span>) {</span>
<span id="cb43-95"><a href="#cb43-95" aria-hidden="true" tabindex="-1"></a>     radar_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(radar_data, </span>
<span id="cb43-96"><a href="#cb43-96" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">aes</span>(<span class="at">x =</span> feature, <span class="at">y =</span> value, </span>
<span id="cb43-97"><a href="#cb43-97" aria-hidden="true" tabindex="-1"></a>                              <span class="at">group =</span> type, <span class="at">fill =</span> type)) <span class="sc">+</span></span>
<span id="cb43-98"><a href="#cb43-98" aria-hidden="true" tabindex="-1"></a>       <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">color =</span> type), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb43-99"><a href="#cb43-99" aria-hidden="true" tabindex="-1"></a>       <span class="fu">coord_polar</span>() <span class="sc">+</span></span>
<span id="cb43-100"><a href="#cb43-100" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Playlist"</span> <span class="ot">=</span> spotify_green, <span class="st">"Baseline"</span> <span class="ot">=</span> <span class="st">"#777777"</span>)) <span class="sc">+</span></span>
<span id="cb43-101"><a href="#cb43-101" aria-hidden="true" tabindex="-1"></a>       <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Playlist"</span> <span class="ot">=</span> spotify_green, <span class="st">"Baseline"</span> <span class="ot">=</span> <span class="st">"#777777"</span>)) <span class="sc">+</span></span>
<span id="cb43-102"><a href="#cb43-102" aria-hidden="true" tabindex="-1"></a>       <span class="fu">labs</span>(</span>
<span id="cb43-103"><a href="#cb43-103" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"Radar Chart of Playlist Audio Characteristics"</span>,</span>
<span id="cb43-104"><a href="#cb43-104" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="st">"Average audio feature values compared to baseline (0.5)"</span>,</span>
<span id="cb43-105"><a href="#cb43-105" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">"Type"</span>,</span>
<span id="cb43-106"><a href="#cb43-106" aria-hidden="true" tabindex="-1"></a>         <span class="at">color =</span> <span class="st">"Type"</span></span>
<span id="cb43-107"><a href="#cb43-107" aria-hidden="true" tabindex="-1"></a>       ) <span class="sc">+</span></span>
<span id="cb43-108"><a href="#cb43-108" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb43-109"><a href="#cb43-109" aria-hidden="true" tabindex="-1"></a>       <span class="fu">theme</span>(</span>
<span id="cb43-110"><a href="#cb43-110" aria-hidden="true" tabindex="-1"></a>         <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">color =</span> spotify_black, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb43-111"><a href="#cb43-111" aria-hidden="true" tabindex="-1"></a>         <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">color =</span> spotify_gray, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb43-112"><a href="#cb43-112" aria-hidden="true" tabindex="-1"></a>         <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb43-113"><a href="#cb43-113" aria-hidden="true" tabindex="-1"></a>         <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb43-114"><a href="#cb43-114" aria-hidden="true" tabindex="-1"></a>         <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> spotify_black),</span>
<span id="cb43-115"><a href="#cb43-115" aria-hidden="true" tabindex="-1"></a>         <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"#E0E0E0"</span>),</span>
<span id="cb43-116"><a href="#cb43-116" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb43-117"><a href="#cb43-117" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_black),</span>
<span id="cb43-118"><a href="#cb43-118" aria-hidden="true" tabindex="-1"></a>         <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> spotify_gray)</span>
<span id="cb43-119"><a href="#cb43-119" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb43-120"><a href="#cb43-120" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb43-121"><a href="#cb43-121" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Print the radar plot</span></span>
<span id="cb43-122"><a href="#cb43-122" aria-hidden="true" tabindex="-1"></a>     <span class="fu">print</span>(radar_plot)</span>
<span id="cb43-123"><a href="#cb43-123" aria-hidden="true" tabindex="-1"></a>   } <span class="cf">else</span> {</span>
<span id="cb43-124"><a href="#cb43-124" aria-hidden="true" tabindex="-1"></a>     <span class="fu">message</span>(<span class="st">"Not enough audio features available for radar chart (minimum 3 needed)."</span>)</span>
<span id="cb43-125"><a href="#cb43-125" aria-hidden="true" tabindex="-1"></a>     radar_plot <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb43-126"><a href="#cb43-126" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb43-127"><a href="#cb43-127" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-128"><a href="#cb43-128" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Print the flow plot</span></span>
<span id="cb43-129"><a href="#cb43-129" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(flow_plot)</span>
<span id="cb43-130"><a href="#cb43-130" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-131"><a href="#cb43-131" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Create a table summarizing the flow</span></span>
<span id="cb43-132"><a href="#cb43-132" aria-hidden="true" tabindex="-1"></a>   flow_summary <span class="ot">&lt;-</span> playlist <span class="sc">%&gt;%</span></span>
<span id="cb43-133"><a href="#cb43-133" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb43-134"><a href="#cb43-134" aria-hidden="true" tabindex="-1"></a>       <span class="at">segment =</span> <span class="fu">case_when</span>(</span>
<span id="cb43-135"><a href="#cb43-135" aria-hidden="true" tabindex="-1"></a>         playlist_position <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Beginning (tracks 1-3)"</span>,</span>
<span id="cb43-136"><a href="#cb43-136" aria-hidden="true" tabindex="-1"></a>         playlist_position <span class="sc">&lt;=</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Early Middle (tracks 4-6)"</span>,</span>
<span id="cb43-137"><a href="#cb43-137" aria-hidden="true" tabindex="-1"></a>         playlist_position <span class="sc">&lt;=</span> <span class="dv">9</span> <span class="sc">~</span> <span class="st">"Late Middle (tracks 7-9)"</span>,</span>
<span id="cb43-138"><a href="#cb43-138" aria-hidden="true" tabindex="-1"></a>         <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"End (tracks 10-12)"</span></span>
<span id="cb43-139"><a href="#cb43-139" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb43-140"><a href="#cb43-140" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb43-141"><a href="#cb43-141" aria-hidden="true" tabindex="-1"></a>     <span class="fu">group_by</span>(segment) <span class="sc">%&gt;%</span></span>
<span id="cb43-142"><a href="#cb43-142" aria-hidden="true" tabindex="-1"></a>     <span class="fu">summarize</span>(</span>
<span id="cb43-143"><a href="#cb43-143" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_danceability =</span> <span class="fu">mean</span>(danceability),</span>
<span id="cb43-144"><a href="#cb43-144" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_energy =</span> <span class="fu">mean</span>(energy),</span>
<span id="cb43-145"><a href="#cb43-145" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_valence =</span> <span class="fu">mean</span>(valence),</span>
<span id="cb43-146"><a href="#cb43-146" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_tempo =</span> <span class="fu">mean</span>(tempo),</span>
<span id="cb43-147"><a href="#cb43-147" aria-hidden="true" tabindex="-1"></a>       <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb43-148"><a href="#cb43-148" aria-hidden="true" tabindex="-1"></a>     ) <span class="sc">%&gt;%</span></span>
<span id="cb43-149"><a href="#cb43-149" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(</span>
<span id="cb43-150"><a href="#cb43-150" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_danceability =</span> <span class="fu">round</span>(avg_danceability, <span class="dv">2</span>),</span>
<span id="cb43-151"><a href="#cb43-151" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_energy =</span> <span class="fu">round</span>(avg_energy, <span class="dv">2</span>),</span>
<span id="cb43-152"><a href="#cb43-152" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_valence =</span> <span class="fu">round</span>(avg_valence, <span class="dv">2</span>),</span>
<span id="cb43-153"><a href="#cb43-153" aria-hidden="true" tabindex="-1"></a>       <span class="at">avg_tempo =</span> <span class="fu">round</span>(avg_tempo, <span class="dv">1</span>)</span>
<span id="cb43-154"><a href="#cb43-154" aria-hidden="true" tabindex="-1"></a>     )</span>
<span id="cb43-155"><a href="#cb43-155" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-156"><a href="#cb43-156" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Print summary table</span></span>
<span id="cb43-157"><a href="#cb43-157" aria-hidden="true" tabindex="-1"></a>   flow_table <span class="ot">&lt;-</span> flow_summary <span class="sc">%&gt;%</span></span>
<span id="cb43-158"><a href="#cb43-158" aria-hidden="true" tabindex="-1"></a>     <span class="fu">kable</span>(<span class="st">"html"</span>, <span class="at">caption =</span> <span class="st">"Flow Summary by Playlist Segment"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-159"><a href="#cb43-159" aria-hidden="true" tabindex="-1"></a>     <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"hover"</span>, <span class="st">"condensed"</span>), </span>
<span id="cb43-160"><a href="#cb43-160" aria-hidden="true" tabindex="-1"></a>                   <span class="at">full_width =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-161"><a href="#cb43-161" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> spotify_black, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-162"><a href="#cb43-162" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(flow_summary), <span class="at">background =</span> <span class="st">"white"</span>, <span class="at">color =</span> spotify_black) <span class="sc">%&gt;%</span></span>
<span id="cb43-163"><a href="#cb43-163" aria-hidden="true" tabindex="-1"></a>     <span class="fu">row_spec</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(flow_summary), <span class="dv">2</span>), <span class="at">background =</span> <span class="st">"#f8f8f8"</span>)</span>
<span id="cb43-164"><a href="#cb43-164" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-165"><a href="#cb43-165" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(flow_table)</span>
<span id="cb43-166"><a href="#cb43-166" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb43-167"><a href="#cb43-167" aria-hidden="true" tabindex="-1"></a>   <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb43-168"><a href="#cb43-168" aria-hidden="true" tabindex="-1"></a>     <span class="at">flow_plot =</span> flow_plot,</span>
<span id="cb43-169"><a href="#cb43-169" aria-hidden="true" tabindex="-1"></a>     <span class="at">radar_plot =</span> radar_plot</span>
<span id="cb43-170"><a href="#cb43-170" aria-hidden="true" tabindex="-1"></a>   ))</span>
<span id="cb43-171"><a href="#cb43-171" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb43-172"><a href="#cb43-172" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate visualizations for our playlist</span></span>
<span id="cb43-173"><a href="#cb43-173" aria-hidden="true" tabindex="-1"></a> playlist_visualizations <span class="ot">&lt;-</span> <span class="fu">visualize_playlist_flow</span>(ultimate_playlist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<img src="mp03_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"><img src="mp03_files/figure-html/unnamed-chunk-29-2.png" class="img-fluid" width="672">
<table class="table table-hover table-condensed" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
Flow Summary by Playlist Segment
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
segment
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
avg_danceability
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
avg_energy
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
avg_valence
</th>
<th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(25, 20, 20, 255) !important;">
avg_tempo
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
Beginning (tracks 1-3)
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.77
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.65
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.51
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
125.8
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Early Middle (tracks 4-6)
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.75
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.72
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.61
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
119.4
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
End (tracks 10-12)
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.75
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.68
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
0.52
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;background-color: rgba(248, 248, 248, 255) !important;">
134.7
</td>
</tr>
<tr>
<td style="text-align:left;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
Late Middle (tracks 7-9)
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.83
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.81
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
0.60
</td>
<td style="text-align:right;color: rgba(25, 20, 20, 255) !important;background-color: white !important;">
124.0
</td>
</tr>
</tbody>
</table>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># View the flow plot</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(playlist_visualizations<span class="sc">$</span>flow_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="mp03_files/figure-html/unnamed-chunk-29-3.png" class="img-fluid" width="672"></p>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># View the radar plot</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(playlist_visualizations<span class="sc">$</span>radar_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<p><img src="mp03_files/figure-html/unnamed-chunk-29-4.png" class="img-fluid" width="672"></p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/<Vihan-Raghuvanshi>\.github\.io\/STA9750-2025-SPRING\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>