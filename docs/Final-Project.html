<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Financial Impact of Remote Work on MTA: NYC Subway Ridership – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-0cb5735cee7cc8ae56ecf7c7052d4876.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<!-- Inject subway animation on page load -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Create the animation container
  var container = document.createElement('div');
  container.className = 'subway-container';
  container.innerHTML = `
    <div class="mta-logo">MTA</div>
    <div class="subway-track"></div>
    <div class="subway-stop stop-1"></div>
    <div class="subway-stop stop-2"></div>
    <div class="subway-stop stop-3"></div>
    <div class="subway-stop stop-4"></div>
    <div class="subway-train">
      <div class="train-window window-1"></div>
      <div class="train-window window-2"></div>
      <div class="train-window window-3"></div>
    </div>
  `;
  
  // Add it to the beginning of the body
  document.body.insertBefore(container, document.body.firstChild);
});
</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet">
<script src="site_libs/dygraphs-1.1.1/dygraph-combined.js"></script>
<script src="site_libs/dygraphs-1.1.1/shapes.js"></script>
<script src="site_libs/moment-2.8.4/moment.js"></script>
<script src="site_libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
<script src="site_libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script>
<script src="site_libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script>
<script src="site_libs/Dygraph.Plugins.Crosshair-1.0/crosshair.js"></script>
<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<link rel="stylesheet" href="FinalprojectMTA.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary"><strong>Executive Summary</strong></a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><strong>Introduction</strong></a></li>
  <li><a href="#dataset-description" id="toc-dataset-description" class="nav-link" data-scroll-target="#dataset-description"><strong>Dataset Description</strong></a></li>
  <li><a href="#analysis-1-overall-subway-ridership-recovery" id="toc-analysis-1-overall-subway-ridership-recovery" class="nav-link" data-scroll-target="#analysis-1-overall-subway-ridership-recovery"><strong>Analysis 1: Overall Subway Ridership Recovery</strong></a></li>
  <li><a href="#analysis-2-weekday-vs.-weekend-ridership-recovery" id="toc-analysis-2-weekday-vs.-weekend-ridership-recovery" class="nav-link" data-scroll-target="#analysis-2-weekday-vs.-weekend-ridership-recovery"><strong>Analysis 2: Weekday vs.&nbsp;Weekend Ridership Recovery</strong></a></li>
  <li><a href="#analysis-3-revenue-impact-estimation" id="toc-analysis-3-revenue-impact-estimation" class="nav-link" data-scroll-target="#analysis-3-revenue-impact-estimation"><strong>Analysis 3: Revenue Impact Estimation</strong></a></li>
  <li><a href="#analysis-4-time-slot-analysis-remote-work-indicator" id="toc-analysis-4-time-slot-analysis-remote-work-indicator" class="nav-link" data-scroll-target="#analysis-4-time-slot-analysis-remote-work-indicator"><strong>Analysis 4: Time Slot Analysis (Remote Work Indicator)</strong></a></li>
  <li><a href="#focus-on-the-big-question" id="toc-focus-on-the-big-question" class="nav-link" data-scroll-target="#focus-on-the-big-question"><strong>Focus on the BIG Question</strong></a>
  <ul class="collapse">
  <li><a href="#approach" id="toc-approach" class="nav-link" data-scroll-target="#approach"><strong>Approach</strong></a></li>
  <li><a href="#key-findings" id="toc-key-findings" class="nav-link" data-scroll-target="#key-findings"><strong>Key Findings</strong></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><strong>Financial Impact of Remote Work on MTA: NYC Subway Ridership</strong></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="executive-summary" class="level2">
<h2 class="anchored" data-anchor-id="executive-summary"><strong>Executive Summary</strong></h2>
<p><strong>Financial Impact of Remote Work on MTA: NYC Subway Ridership</strong></p>
<p>The COVID-19 pandemic triggered profound changes in New York City’s subway ridership patterns that persist well beyond the initial health crisis. This analysis examines the specific financial impact of remote work on the Metropolitan Transportation Authority (MTA) between 2019 and 2023, revealing structural changes in commuter behavior with significant revenue implications.</p>
<p><strong>Key findings include:</strong></p>
<p><strong>Persistent Recovery Gap:</strong> By 2023, subway ridership had recovered to only 70% of pre-pandemic levels, with a notable 10.2 percentage point gap between weekend recovery (77.3%) and weekday recovery (67.1%), directly attributable to remote work.</p>
<p><strong>Substantial Revenue Loss:</strong> MTA experienced approximately $8.8 billion in cumulative fare revenue losses between 2020-2023, with an estimated $2.5-3.0 billion specifically attributable to remote work practices.</p>
<p><strong>Changing Commute Patterns:</strong> Time slot analysis reveals significant shifts in traditional commuting patterns, with morning rush hours showing weaker recovery than evening rush hours, consistent with hybrid work arrangements.</p>
<p><strong>Daily Ridership Impact:</strong> Approximately 541,540 daily subway riders were lost to remote work in 2023 alone, representing about 31% of the total ridership decline from pre-pandemic levels.</p>
<p><strong>Annual Remote Work Impact:</strong> The financial impact specifically attributable to remote work in 2023 was approximately $379.8 million in lost fare revenue.</p>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction"><strong>Introduction</strong></h2>
<p><strong>Overarching Question</strong></p>
<p>The pandemic disrupted NYC’s subway system, raising a critical question: How much revenue has the MTA lost specifically due to remote work between 2019-2023?</p>
<p>This question distinguishes temporary disruptions from permanent changes in commuter behavior and Quantifies financial impacts for MTA’s long-term planning Reveals how evolving work patterns are reshaping urban mobility needs.</p>
<p><strong>The Specific Question Being Answered in this analysis include:</strong></p>
<p>This analysis isolates remote work’s contribution to the MTA’s revenue shortfall by comparing weekday versus weekend recovery rates and analyzing time-of-day ridership patterns.</p>
<p>We examine:</p>
<ul>
<li><strong>Differences between weekday and weekend recovery patterns</strong></li>
<li><strong>Shifts in rush hour versus non-peak ridership</strong></li>
<li><strong>Financial implications based on reconstructed ridership scenarios</strong></li>
</ul>
<p>The findings provide actionable insights for the MTA’s strategic planning as remote and hybrid work become permanent features of NYC’s economic landscape.</p>
</section>
<section id="dataset-description" class="level2">
<h2 class="anchored" data-anchor-id="dataset-description"><strong>Dataset Description</strong></h2>
<p>This analysis uses two complementary datasets from the New York City Metropolitan Transportation Authority (MTA):</p>
<ol type="1">
<li><p><strong>Daily Ridership Dataset</strong>: Contains 1,776 observations from March 1, 2020 through January 9, 2025, tracking daily ridership across various transportation modes. Key metrics include total estimated ridership and percentage of <strong>comparable pre-pandemic day for subways</strong>. The dataset includes temporal variables (day of week, month, year, quarter) that enable trend analysis over time. <a href="https://github.com/Vihan-Raghuvanshi/STA9750-2025-SPRING/blob/main/FinalProject.R#L24">click here to see how to download data</a></p></li>
<li><p><strong>Time Slot Analysis Dataset</strong>: Original dataset contained <strong>110M rows of data</strong>, which was then converted into Time slot Analysis, Containing <strong>6,519 observations</strong> from July 1, 2020 through December 31, 2024, breaking down ridership by time of day. The dataset categorizes travel into four time slots: Morning Rush (6AM-10AM), Midday (10AM-3PM), Evening Rush (3PM-7PM), and Off-Hours (7PM-6AM). It also distinguishes between weekday and weekend ridership, with information on total ridership and unique stations used during each time period. <a href="https://github.com/Vihan-Raghuvanshi/STA9750-2025-SPRING/blob/main/FinalProject.R#L552">click here to see how to download dataset</a></p></li>
</ol>
<p>These datasets are particularly valuable because they include the percentage comparison to pre-pandemic levels, allowing us to reconstruct what ridership would have been without the pandemic disruption. This feature enables accurate calculation of revenue impacts and helps isolate the effect of remote work based on different time slots when the ridership increased/decreased.</p>
</section>
<section id="analysis-1-overall-subway-ridership-recovery" class="level2">
<h2 class="anchored" data-anchor-id="analysis-1-overall-subway-ridership-recovery"><strong>Analysis 1: Overall Subway Ridership Recovery</strong></h2>
<p><strong>Approach</strong>: We calculated yearly average subway ridership and compared it to pre-pandemic levels using the percentage metric provided in the dataset. This established a baseline understanding of how the system has recovered over time.</p>
<p><strong>Results</strong>: NYC subway ridership has shown steady recovery since the pandemic began, but remains significantly below pre-pandemic levels. In 2020, at the height of the pandemic, ridership averaged only 1.2 million daily riders (26.3% of pre-pandemic levels). By 2023, this had improved to 3.15 million daily riders, representing 70% of pre-pandemic volumes. While the recovery trend is positive, the plateau at 70% suggests that approximately 30% of pre-pandemic ridership has not returned after four years. This indicates structural changes in travel patterns rather than temporary pandemic effects, with remote work being a likely major contributor.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. RIDERSHIP ANALYSIS: How has total MTA ridership changed from 2019 to 2023?</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xts)       <span class="co"># For time series objects</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dygraphs)  <span class="co"># For interactive plots</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra) <span class="co"># For styled tables</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create year and month columns for easier aggregation</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>daily_ridership<span class="sc">$</span>year_month <span class="ot">&lt;-</span> <span class="fu">format</span>(daily_ridership<span class="sc">$</span>Date, <span class="st">"%Y-%m"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate yearly averages for subway only</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>yearly_subway_ridership <span class="ot">&lt;-</span> daily_ridership <span class="sc">%&gt;%</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Avg Daily Ridership</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Subways: Total Estimated Ridership</span><span class="st">`</span>),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">% of Pre-Pandemic Level</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Subways: % of Comparable Pre-Pandemic Day</span><span class="st">`</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span>  <span class="co"># Filter to years through 2023</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Format for better readability</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>yearly_subway_ridership<span class="sc">$</span><span class="st">`</span><span class="at">Avg Daily Ridership</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(yearly_subway_ridership<span class="sc">$</span><span class="st">`</span><span class="at">Avg Daily Ridership</span><span class="st">`</span>, <span class="dv">0</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>yearly_subway_ridership<span class="sc">$</span><span class="st">`</span><span class="at">% of Pre-Pandemic Level</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(yearly_subway_ridership<span class="sc">$</span><span class="st">`</span><span class="at">% of Pre-Pandemic Level</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dates for the time series (using July 1 of each year as representative date)</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>yearly_subway_ridership<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(yearly_subway_ridership<span class="sc">$</span>year, <span class="st">"-07-01"</span>))</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># MTA colors for theming</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>mta_blue <span class="ot">&lt;-</span> <span class="st">"#0039A6"</span>   <span class="co"># MTA subway blue</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>mta_red <span class="ot">&lt;-</span> <span class="st">"#EE352E"</span>    <span class="co"># MTA 1,2,3 lines red</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Display table with MTA theme</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  yearly_subway_ridership[, <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"Avg Daily Ridership"</span>, <span class="st">"% of Pre-Pandemic Level"</span>)],</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">format  =</span> <span class="st">"html"</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Yearly Subway Ridership and Recovery (%)"</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width        =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">position          =</span> <span class="st">"center"</span>    <span class="co"># centers the table and the caption</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> mta_blue, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">background =</span> <span class="st">"#f8f8f8"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Yearly Subway Ridership and Recovery (%)</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">year</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">Avg Daily Ridership</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">% of Pre-Pandemic Level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2020</td>
<td style="text-align: right;">1209467</td>
<td style="text-align: right;">26.3</td>
</tr>
<tr class="even">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2021</td>
<td style="text-align: right;">2081672</td>
<td style="text-align: right;">46.4</td>
</tr>
<tr class="odd">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2022</td>
<td style="text-align: right;">2773989</td>
<td style="text-align: right;">61.3</td>
</tr>
<tr class="even">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2023</td>
<td style="text-align: right;">3151280</td>
<td style="text-align: right;">70.0</td>
</tr>
</tbody>
</table>


</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create xts objects for time series visualization</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ridership_xts <span class="ot">&lt;-</span> <span class="fu">xts</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">cbind</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    yearly_subway_ridership<span class="sc">$</span><span class="st">`</span><span class="at">Avg Daily Ridership</span><span class="st">`</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    yearly_subway_ridership<span class="sc">$</span><span class="st">`</span><span class="at">% of Pre-Pandemic Level</span><span class="st">`</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">order.by =</span> yearly_subway_ridership<span class="sc">$</span>date</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns for better display</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ridership_xts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Daily Ridership"</span>, <span class="st">"% of Pre-Pandemic"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create interactive dygraph</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">dygraph</span>(ridership_xts, <span class="at">main =</span> <span class="st">"NYC Subway Ridership Recovery (2019-2023)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dySeries</span>(<span class="st">"Daily Ridership"</span>, <span class="at">label =</span> <span class="st">"Daily Ridership"</span>, <span class="at">color =</span> mta_blue, </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">fillGraph =</span> <span class="cn">TRUE</span>, <span class="at">strokeWidth =</span> <span class="fl">2.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dySeries</span>(<span class="st">"% of Pre-Pandemic"</span>, <span class="at">label =</span> <span class="st">"% of Pre-Pandemic"</span>, <span class="at">color =</span> mta_red, </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">strokeWidth =</span> <span class="dv">3</span>, <span class="at">axis =</span> <span class="st">'y2'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dyOptions</span>(</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">stackedGraph =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">fillAlpha =</span> <span class="fl">0.4</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">drawPoints =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> <span class="dv">5</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dyAxis</span>(<span class="st">"y"</span>, <span class="at">label =</span> <span class="st">"Average Daily Ridership"</span>, </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">valueFormatter =</span> <span class="st">'function(v){return v.toLocaleString();}'</span>,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">axisLabelFormatter =</span> <span class="st">'function(v){return v/1000000 + "M";}'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dyAxis</span>(<span class="st">"y2"</span>, <span class="at">label =</span> <span class="st">"% of Pre-Pandemic Level"</span>, </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">valueRange =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">105</span>),</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">independentTicks =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">axisLabelFormatter =</span> <span class="st">'function(v){return v + "%";}'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dyHighlight</span>(<span class="at">highlightCircleSize =</span> <span class="dv">5</span>, </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">highlightSeriesBackgroundAlpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">hideOnMouseOut =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dyRangeSelector</span>(<span class="at">height =</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dyCrosshair</span>(<span class="at">direction =</span> <span class="st">"vertical"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dyLegend</span>(<span class="at">width =</span> <span class="dv">400</span>)  <span class="co"># Removed reference to custom.css file</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="dygraphs html-widget html-fill-item" id="htmlwidget-a5fbe74ec72e08af1460" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-a5fbe74ec72e08af1460">{"x":{"attrs":{"axes":{"x":{"pixelsPerLabel":60,"drawAxis":true},"y":{"drawAxis":true,"axisLabelFormatter":"function(v){return v/1000000 + \"M\";}","valueFormatter":"function(v){return v.toLocaleString();}"},"y2":{"valueRange":[0,105],"axisLabelFormatter":"function(v){return v + \"%\";}","independentTicks":true}},"series":{"Daily Ridership":{"axis":"y","fillGraph":true,"strokeWidth":2.5},"% of Pre-Pandemic":{"axis":"y2","strokeWidth":3}},"title":"NYC Subway Ridership Recovery (2019-2023)","labels":["year","Daily Ridership","% of Pre-Pandemic"],"retainDateWindow":false,"colors":["#0039A6","#EE352E"],"stackedGraph":false,"fillGraph":false,"fillAlpha":0.4,"stepPlot":false,"drawPoints":true,"pointSize":5,"drawGapEdgePoints":false,"connectSeparatedPoints":false,"strokeWidth":1,"strokeBorderColor":"white","colorValue":0.5,"colorSaturation":1,"includeZero":false,"drawAxesAtZero":false,"logscale":false,"axisTickSize":3,"axisLineColor":"black","axisLineWidth":0.3,"axisLabelColor":"black","axisLabelFontSize":14,"axisLabelWidth":60,"drawGrid":true,"gridLineWidth":0.3,"rightGap":5,"digitsAfterDecimal":2,"labelsKMB":false,"labelsKMG2":false,"labelsUTC":false,"maxNumberWidth":6,"animatedZooms":false,"mobileDisableYTouch":true,"disableZoom":false,"ylabel":"Average Daily Ridership","y2label":"% of Pre-Pandemic Level","highlightCircleSize":5,"highlightSeriesBackgroundAlpha":0.5,"highlightSeriesOpts":[],"showRangeSelector":true,"rangeSelectorHeight":30,"rangeSelectorPlotFillColor":" #A7B1C4","rangeSelectorPlotStrokeColor":"#808FAB","interactionModel":"Dygraph.Interaction.defaultModel","legend":"auto","labelsDivWidth":400,"labelsShowZeroValues":true,"labelsSeparateLines":false,"hideOverlayOnMouseOut":true},"scale":"yearly","annotations":[],"shadings":[],"events":[],"format":"date","data":[["2020-07-01T00:00:00.000Z","2021-07-01T00:00:00.000Z","2022-07-01T00:00:00.000Z","2023-07-01T00:00:00.000Z"],[1209467,2081672,2773989,3151280],[26.3,46.4,61.3,70]],"fixedtz":false,"tzone":"UTC","plugins":{"Crosshair":{"direction":"vertical"}}},"evals":["attrs.axes.y.axisLabelFormatter","attrs.axes.y.valueFormatter","attrs.axes.y2.axisLabelFormatter","attrs.interactionModel"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="analysis-2-weekday-vs.-weekend-ridership-recovery" class="level2">
<h2 class="anchored" data-anchor-id="analysis-2-weekday-vs.-weekend-ridership-recovery"><strong>Analysis 2: Weekday vs.&nbsp;Weekend Ridership Recovery</strong></h2>
<p><strong>Approach</strong>: We segmented the data by weekday/weekend to identify differential recovery patterns, which helps isolate the impact of remote work (which primarily affects weekday commuting).</p>
<p><strong>Results</strong>: The analysis reveals a significant gap between weekday and weekend recovery rates. By 2023, weekend ridership had recovered to 77.3% of pre-pandemic levels, while weekday ridership reached only 67.1%. This 10.2 percentage point difference strongly suggests that remote work has had a substantial impact on travel patterns. The consistently higher weekend recovery across all years (2020-2023) indicates that leisure and social travel has returned more robustly than commuter travel. From 2020 to 2023, weekend recovery improved by 49.7 percentage points (from 27.6% to 77.3%), while weekday recovery improved by only 41.3 percentage points (from 25.8% to 67.1%). This widening gap provides compelling evidence that remote work has created a persistent structural change in subway utilization.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. WEEKDAY VS WEEKEND ANALYSIS: How do weekday and weekend ridership recovery patterns differ?</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra) <span class="co"># For styled tables</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># MTA colors for theming</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>mta_blue <span class="ot">&lt;-</span> <span class="st">"#0039A6"</span>    <span class="co"># MTA subway blue</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>mta_orange <span class="ot">&lt;-</span> <span class="st">"#FF6319"</span>  <span class="co"># MTA B, D, F, M lines</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create weekday vs weekend analysis</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>weekday_weekend_analysis <span class="ot">&lt;-</span> daily_ridership <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, is_weekend) <span class="sc">%&gt;%</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Avg Daily Ridership</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Subways: Total Estimated Ridership</span><span class="st">`</span>),</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">% of Pre-Pandemic Level</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Subways: % of Comparable Pre-Pandemic Day</span><span class="st">`</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>  </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span>  <span class="co"># Filter to years through 2023</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Format for better readability</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>weekday_weekend_analysis<span class="sc">$</span><span class="st">`</span><span class="at">Avg Daily Ridership</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(weekday_weekend_analysis<span class="sc">$</span><span class="st">`</span><span class="at">Avg Daily Ridership</span><span class="st">`</span>, <span class="dv">0</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>weekday_weekend_analysis<span class="sc">$</span><span class="st">`</span><span class="at">% of Pre-Pandemic Level</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(weekday_weekend_analysis<span class="sc">$</span><span class="st">`</span><span class="at">% of Pre-Pandemic Level</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>weekday_weekend_analysis<span class="sc">$</span>is_weekend <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(weekday_weekend_analysis<span class="sc">$</span>is_weekend, <span class="st">"Weekend"</span>, <span class="st">"Weekday"</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Display table with MTA theme</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  weekday_weekend_analysis,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">format  =</span> <span class="st">"html"</span>,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Weekday vs Weekend Subway Ridership Recovery"</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width        =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">position          =</span> <span class="st">"center"</span>      <span class="co"># centers both table and caption</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> mta_blue, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">background =</span> <span class="st">"#f8f8f8"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Weekday vs Weekend Subway Ridership Recovery</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">year</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">is_weekend</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">Avg Daily Ridership</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">% of Pre-Pandemic Level</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2020</td>
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">Weekday</td>
<td style="text-align: right;">1385011</td>
<td style="text-align: right;">25.8</td>
</tr>
<tr class="even">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2020</td>
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">Weekend</td>
<td style="text-align: right;">767578</td>
<td style="text-align: right;">27.6</td>
</tr>
<tr class="odd">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2021</td>
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">Weekday</td>
<td style="text-align: right;">2338187</td>
<td style="text-align: right;">44.2</td>
</tr>
<tr class="even">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2021</td>
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">Weekend</td>
<td style="text-align: right;">1437919</td>
<td style="text-align: right;">52.1</td>
</tr>
<tr class="odd">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2022</td>
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">Weekday</td>
<td style="text-align: right;">3152352</td>
<td style="text-align: right;">59.0</td>
</tr>
<tr class="even">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2022</td>
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">Weekend</td>
<td style="text-align: right;">1837090</td>
<td style="text-align: right;">66.9</td>
</tr>
<tr class="odd">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2023</td>
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">Weekday</td>
<td style="text-align: right;">3571055</td>
<td style="text-align: right;">67.1</td>
</tr>
<tr class="even">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2023</td>
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">Weekend</td>
<td style="text-align: right;">2111837</td>
<td style="text-align: right;">77.3</td>
</tr>
</tbody>
</table>


</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization for weekday vs weekend recovery</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Build the bar-data as before</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>wd_we <span class="ot">&lt;-</span> daily_ridership <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">is_weekend =</span> <span class="fu">ifelse</span>(is_weekend, <span class="st">"Weekend"</span>, <span class="st">"Weekday"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, is_weekend) <span class="sc">%&gt;%</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">pct_pre =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Subways: % of Comparable Pre-Pandemic Day</span><span class="st">`</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, is_weekend) <span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">id    =</span> <span class="fu">row_number</span>(),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">angle =</span> <span class="dv">90</span> <span class="sc">-</span> <span class="dv">360</span> <span class="sc">*</span> (id <span class="sc">-</span> <span class="fl">0.5</span>) <span class="sc">/</span> <span class="fu">n</span>(),</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="fu">ifelse</span>(angle <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">90</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">angle =</span> <span class="fu">ifelse</span>(angle <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">90</span>, angle <span class="sc">+</span> <span class="dv">180</span>, angle),</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(pct_pre), <span class="st">"%"</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>max_pct <span class="ot">&lt;-</span> <span class="fu">max</span>(wd_we<span class="sc">$</span>pct_pre)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Extract one label per year (weekend row) and bump it outside the 100% ring</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>year_labels <span class="ot">&lt;-</span> wd_we <span class="sc">%&gt;%</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(is_weekend <span class="sc">==</span> <span class="st">"Weekend"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(year, id, angle, hjust) <span class="sc">%&gt;%</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> max_pct <span class="sc">+</span> <span class="dv">20</span>    <span class="co"># ← push it well beyond the outer ring</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Plot</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>mta_blue   <span class="ot">&lt;-</span> <span class="st">"#0039A6"</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>mta_orange <span class="ot">&lt;-</span> <span class="st">"#FF6319"</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(wd_we, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(id), <span class="at">y =</span> pct_pre, <span class="at">fill =</span> is_weekend)) <span class="sc">+</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># gridlines</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">100</span>),</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># bars</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">width =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pct labels just outside each bar</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label,</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>                <span class="at">angle =</span> angle,</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>                <span class="at">hjust =</span> hjust,</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> pct_pre <span class="sc">+</span> <span class="dv">5</span>),</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># year labels completely outside 100% circle</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> year_labels,</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(id),</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> y,</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> year,</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>                <span class="at">angle =</span> angle,</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>                <span class="at">hjust =</span> hjust),</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">4</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>, <span class="at">color =</span> mta_blue) <span class="sc">+</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make extra room radially</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, max_pct <span class="sc">+</span> <span class="dv">25</span>),</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then turn on polar coords</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coloring &amp; theme</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">"Day Type"</span>,</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Weekday"</span> <span class="ot">=</span> mta_blue, <span class="st">"Weekend"</span> <span class="ot">=</span> mta_orange)</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title    =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title      =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">18</span>,</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">color =</span> mta_blue, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle   =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption    =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">title    =</span> <span class="st">"MTA Subway Ridership Recovery (2019 – 2023)"</span>,</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Percentage of pre-pandemic daily ridership by weekday vs weekend"</span>,</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption  =</span> <span class="st">"Source: MTA Ridership Data</span><span class="sc">\n</span><span class="st">Gridlines at 25%, 50%, 75%, 100%"</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Final-Project_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="analysis-3-revenue-impact-estimation" class="level2">
<h2 class="anchored" data-anchor-id="analysis-3-revenue-impact-estimation"><strong>Analysis 3: Revenue Impact Estimation</strong></h2>
<p><strong>Approach</strong>: We calculated revenue impact by reconstructing pre-pandemic ridership levels using the percentage metrics, then applying the appropriate fare rates: $2.75 before August 20, 2023, and $2.90 after. This allowed us to estimate the revenue gap between actual and potential fare collection.</p>
<p><strong>Results</strong>: The MTA has experienced significant fare revenue losses since the pandemic began. In 2020, the revenue loss amounted to approximately $2.91 billion. While this loss has decreased over time as ridership gradually returned, the MTA still faced a substantial revenue shortfall of $1.49 billion in 2023. From 2020 to 2023, the cumulative revenue loss totaled approximately $8.8 billion. The daily average revenue loss decreased from $9.53 million in 2020 to $4.10 million in 2023, showing improvement but still representing a substantial ongoing financial impact. Even as other pandemic effects have subsided, the persistent revenue gap suggests long-term structural changes in travel patterns, with remote work being a major contributing factor.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. REVENUE IMPACT: Calculate estimated fare revenue loss for subway only</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)  <span class="co"># For better formatting</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># For date handling</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># MTA colors for theming</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>mta_blue <span class="ot">&lt;-</span> <span class="st">"#0039A6"</span>    <span class="co"># MTA subway blue</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>mta_orange <span class="ot">&lt;-</span> <span class="st">"#FF6319"</span>  <span class="co"># MTA B, D, F, M lines</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>mta_green <span class="ot">&lt;-</span> <span class="st">"#00933C"</span>   <span class="co"># MTA 4, 5, 6 lines</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>mta_red <span class="ot">&lt;-</span> <span class="st">"#EE352E"</span>     <span class="co"># MTA 1, 2, 3 lines</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create helper function to determine fare for each date</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>get_fare <span class="ot">&lt;-</span> <span class="cf">function</span>(date) {</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"2023-08-20"</span>)) {</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">2.90</span>)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fl">2.75</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply fare logic to each row</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>daily_ridership<span class="sc">$</span>fare <span class="ot">&lt;-</span> <span class="fu">sapply</span>(daily_ridership<span class="sc">$</span>Date, get_fare)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Reconstruct pre-pandemic ridership using the percentage column</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>daily_ridership<span class="sc">$</span>pre_pandemic_subway_ridership <span class="ot">&lt;-</span> </span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  daily_ridership<span class="sc">$</span><span class="st">`</span><span class="at">Subways: Total Estimated Ridership</span><span class="st">`</span> <span class="sc">/</span> </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  daily_ridership<span class="sc">$</span><span class="st">`</span><span class="at">Subways: % of Comparable Pre-Pandemic Day</span><span class="st">`</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate actual and counterfactual revenue for subway only</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>daily_ridership<span class="sc">$</span>actual_revenue <span class="ot">&lt;-</span> daily_ridership<span class="sc">$</span><span class="st">`</span><span class="at">Subways: Total Estimated Ridership</span><span class="st">`</span> <span class="sc">*</span> daily_ridership<span class="sc">$</span>fare</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>daily_ridership<span class="sc">$</span>counterfactual_revenue <span class="ot">&lt;-</span> daily_ridership<span class="sc">$</span>pre_pandemic_subway_ridership <span class="sc">*</span> daily_ridership<span class="sc">$</span>fare</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>daily_ridership<span class="sc">$</span>revenue_loss <span class="ot">&lt;-</span> daily_ridership<span class="sc">$</span>counterfactual_revenue <span class="sc">-</span> daily_ridership<span class="sc">$</span>actual_revenue</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Aggregate by year for the table</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>revenue_summary <span class="ot">&lt;-</span> daily_ridership <span class="sc">%&gt;%</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&lt;=</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span>  <span class="co"># Filter to years through 2023</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Actual Revenue (Million $)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(actual_revenue) <span class="sc">/</span> <span class="dv">1000000</span>,</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Expected Pre-Pandemic Revenue (Million $)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(counterfactual_revenue) <span class="sc">/</span> <span class="dv">1000000</span>,</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Revenue Loss (Million $)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(revenue_loss) <span class="sc">/</span> <span class="dv">1000000</span>,</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Daily Avg Loss (Million $)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(revenue_loss) <span class="sc">/</span> <span class="dv">1000000</span>,</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Recovery Rate (%)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(actual_revenue) <span class="sc">/</span> <span class="fu">sum</span>(counterfactual_revenue) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Format for better readability</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>revenue_summary<span class="sc">$</span><span class="st">`</span><span class="at">Actual Revenue (Million $)</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(revenue_summary<span class="sc">$</span><span class="st">`</span><span class="at">Actual Revenue (Million $)</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>revenue_summary<span class="sc">$</span><span class="st">`</span><span class="at">Expected Pre-Pandemic Revenue (Million $)</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(revenue_summary<span class="sc">$</span><span class="st">`</span><span class="at">Expected Pre-Pandemic Revenue (Million $)</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>revenue_summary<span class="sc">$</span><span class="st">`</span><span class="at">Revenue Loss (Million $)</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(revenue_summary<span class="sc">$</span><span class="st">`</span><span class="at">Revenue Loss (Million $)</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>revenue_summary<span class="sc">$</span><span class="st">`</span><span class="at">Daily Avg Loss (Million $)</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(revenue_summary<span class="sc">$</span><span class="st">`</span><span class="at">Daily Avg Loss (Million $)</span><span class="st">`</span>, <span class="dv">2</span>)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>revenue_summary<span class="sc">$</span><span class="st">`</span><span class="at">Recovery Rate (%)</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">round</span>(revenue_summary<span class="sc">$</span><span class="st">`</span><span class="at">Recovery Rate (%)</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Display table with MTA theme</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>  revenue_summary,</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">format  =</span> <span class="st">"html"</span>,</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Estimated Yearly Subway Fare Revenue (in millions)"</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width        =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">position          =</span> <span class="st">"center"</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> mta_blue, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">background =</span> <span class="st">"#f8f8f8"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Estimated Yearly Subway Fare Revenue (in millions)</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">year</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">Actual Revenue (Million $)</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">Expected Pre-Pandemic Revenue (Million $)</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">Revenue Loss (Million $)</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">Daily Avg Loss (Million $)</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">Recovery Rate (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2020</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">1017.8</td>
<td style="text-align: right;">3932.6</td>
<td style="text-align: right;">2914.8</td>
<td style="text-align: right;">9.53</td>
<td style="text-align: right;">25.9</td>
</tr>
<tr class="even">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2021</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2089.5</td>
<td style="text-align: right;">4628.0</td>
<td style="text-align: right;">2538.5</td>
<td style="text-align: right;">6.95</td>
<td style="text-align: right;">45.1</td>
</tr>
<tr class="odd">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2022</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2784.4</td>
<td style="text-align: right;">4636.7</td>
<td style="text-align: right;">1852.3</td>
<td style="text-align: right;">5.07</td>
<td style="text-align: right;">60.1</td>
</tr>
<tr class="even">
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">2023</td>
<td style="text-align: right; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">3227.7</td>
<td style="text-align: right;">4722.6</td>
<td style="text-align: right;">1494.9</td>
<td style="text-align: right;">4.10</td>
<td style="text-align: right;">68.3</td>
</tr>
</tbody>
</table>


</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create quarterly aggregation for more compact visualization</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>quarterly_revenue <span class="ot">&lt;-</span> daily_ridership <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2019</span>, year <span class="sc">&lt;=</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">quarter =</span> <span class="fu">ceiling</span>(<span class="fu">month</span>(Date) <span class="sc">/</span> <span class="dv">3</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">quarter_year =</span> <span class="fu">paste0</span>(year, <span class="st">" Q"</span>, quarter)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, quarter, quarter_year) <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">actual_revenue =</span> <span class="fu">sum</span>(actual_revenue) <span class="sc">/</span> <span class="dv">1000000</span>,     <span class="co"># Convert to millions</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected_revenue =</span> <span class="fu">sum</span>(counterfactual_revenue) <span class="sc">/</span> <span class="dv">1000000</span>,  <span class="co"># Convert to millions</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">revenue_loss =</span> <span class="fu">sum</span>(revenue_loss) <span class="sc">/</span> <span class="dv">1000000</span>,         <span class="co"># Convert to millions</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">recovery_rate =</span> actual_revenue <span class="sc">/</span> expected_revenue <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Format values</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">actual_revenue =</span> <span class="fu">round</span>(actual_revenue, <span class="dv">1</span>),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected_revenue =</span> <span class="fu">round</span>(expected_revenue, <span class="dv">1</span>),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">revenue_loss =</span> <span class="fu">round</span>(revenue_loss, <span class="dv">1</span>),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">recovery_rate =</span> <span class="fu">round</span>(recovery_rate, <span class="dv">1</span>),</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create conditional formatting based on recovery rate</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">recovery_color =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>      recovery_rate <span class="sc">&gt;=</span> <span class="dv">80</span> <span class="sc">~</span> <span class="st">"Very High"</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>      recovery_rate <span class="sc">&gt;=</span> <span class="dv">60</span> <span class="sc">~</span> <span class="st">"High"</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>      recovery_rate <span class="sc">&gt;=</span> <span class="dv">40</span> <span class="sc">~</span> <span class="st">"Medium"</span>,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      recovery_rate <span class="sc">&gt;=</span> <span class="dv">20</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Very Low"</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For ordering in the plot</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">order_id =</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(quarter_year, <span class="at">levels =</span> <span class="fu">unique</span>(quarter_year[<span class="fu">order</span>(year, quarter)])))</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the data with hover text formatting</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> quarterly_revenue <span class="sc">%&gt;%</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">negative_expected =</span> <span class="sc">-</span>expected_revenue,  <span class="co"># Negate for negative axis</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">hover_actual =</span> <span class="fu">paste0</span>(</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Period: "</span>, quarter_year,</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;br&gt;Actual Revenue: $"</span>, actual_revenue, <span class="st">"M"</span>,</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;br&gt;Recovery Rate: "</span>, recovery_rate, <span class="st">"%"</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">hover_expected =</span> <span class="fu">paste0</span>(</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Period: "</span>, quarter_year,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;br&gt;Expected Revenue: $"</span>, expected_revenue, <span class="st">"M"</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">hover_loss =</span> <span class="fu">paste0</span>(</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Period: "</span>, quarter_year,</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;br&gt;Revenue Loss: $"</span>, revenue_loss, <span class="st">"M"</span>,</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;br&gt;Recovery Rate: "</span>, recovery_rate, <span class="st">"%"</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create short labels for x-axis to save space</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">short_label =</span> <span class="fu">paste0</span>(<span class="fu">substr</span>(year, <span class="dv">3</span>, <span class="dv">4</span>), <span class="st">"Q"</span>, quarter)</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the interactive plot with significantly adjusted layout</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">height =</span> <span class="dv">450</span>, <span class="at">width =</span> <span class="dv">600</span>) <span class="sc">%&gt;%</span>  <span class="co"># Further reduced width</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add actual revenue (positive axis)</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_bars</span>(</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> plot_data,  <span class="co"># Use all data points</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>order_id, </span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span>actual_revenue,</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">color =</span> mta_blue),</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">'Actual'</span>,  <span class="co"># Shortened name</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">hovertemplate =</span> <span class="sc">~</span>hover_actual</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add expected revenue (negative axis)</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_bars</span>(</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> plot_data,</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>order_id, </span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span>negative_expected,</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">color =</span> mta_red),</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">'Expected'</span>,  <span class="co"># Shortened name</span></span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">hovertemplate =</span> <span class="sc">~</span>hover_expected</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add revenue loss as line</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> plot_data,</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>order_id, </span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span>revenue_loss,</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">'scatter'</span>, </span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">'lines+markers'</span>,</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> mta_orange, <span class="at">width =</span> <span class="dv">2</span>),</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">marker =</span> <span class="fu">list</span>(</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="sc">~</span><span class="fu">case_when</span>(</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>        recovery_color <span class="sc">==</span> <span class="st">"Very High"</span> <span class="sc">~</span> <span class="st">"#006400"</span>,</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>        recovery_color <span class="sc">==</span> <span class="st">"High"</span> <span class="sc">~</span> mta_green,</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>        recovery_color <span class="sc">==</span> <span class="st">"Medium"</span> <span class="sc">~</span> mta_orange,</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>        recovery_color <span class="sc">==</span> <span class="st">"Low"</span> <span class="sc">~</span> <span class="st">"#FF4500"</span>,</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>        recovery_color <span class="sc">==</span> <span class="st">"Very Low"</span> <span class="sc">~</span> mta_red</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">5</span>,  <span class="co"># Even smaller markers</span></span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">line =</span> <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"#000000"</span>)</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">'Loss'</span>,  <span class="co"># Shortened name</span></span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">hovertemplate =</span> <span class="sc">~</span>hover_loss</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Layout with extremely compact configuration</span></span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">list</span>(</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>      <span class="at">text =</span> <span class="st">"MTA Revenue Impact (2019-2023)"</span>,</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">color =</span> mta_blue, <span class="at">family =</span> <span class="st">"Arial"</span>, <span class="at">weight =</span> <span class="st">"bold"</span>)</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(</span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">""</span>,</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickvals =</span> plot_data<span class="sc">$</span>order_id,</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>      <span class="at">ticktext =</span> plot_data<span class="sc">$</span>short_label,  <span class="co"># Use shortened quarter labels</span></span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickangle =</span> <span class="dv">90</span>,  <span class="co"># Vertical labels to save space</span></span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickfont =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">8</span>),  <span class="co"># Smaller font</span></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>      <span class="at">fixedrange =</span> <span class="cn">TRUE</span></span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(</span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Revenue ($M)"</span>,  <span class="co"># Shortened title</span></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>      <span class="at">zeroline =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>      <span class="at">zerolinewidth =</span> <span class="dv">2</span>,</span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>      <span class="at">zerolinecolor =</span> <span class="st">"#000000"</span>,</span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickformat =</span> <span class="st">"$,.0f"</span>,</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>      <span class="at">gridcolor =</span> <span class="st">"#E0E0E0"</span>,</span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>      <span class="at">titlefont =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>      <span class="at">fixedrange =</span> <span class="cn">TRUE</span></span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>    <span class="at">barmode =</span> <span class="st">'overlay'</span>,</span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">list</span>(</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>      <span class="at">orientation =</span> <span class="st">"h"</span>,</span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">0.5</span>,</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.12</span>,</span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a>      <span class="at">xanchor =</span> <span class="st">"center"</span>,</span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a>      <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">9</span>)</span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>    <span class="at">margin =</span> <span class="fu">list</span>(<span class="at">t =</span> <span class="dv">40</span>, <span class="at">b =</span> <span class="dv">65</span>, <span class="at">l =</span> <span class="dv">45</span>, <span class="at">r =</span> <span class="dv">20</span>),  <span class="co"># Further reduced margins</span></span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>    <span class="at">annotations =</span> <span class="fu">list</span>(</span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(</span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fl">0.5</span>,</span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="fl">1.05</span>,</span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>        <span class="at">xref =</span> <span class="st">"paper"</span>,</span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a>        <span class="at">yref =</span> <span class="st">"paper"</span>,</span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="st">"Revenue: Actual (↑) vs. Expected (↓) with Loss (→)"</span>,</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>        <span class="at">showarrow =</span> <span class="cn">FALSE</span>,</span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>        <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">9</span>)</span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>    <span class="at">autosize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">dragmode =</span> <span class="cn">FALSE</span>,</span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>    <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">9</span>)</span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(</span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>    <span class="at">displayModeBar =</span> <span class="cn">FALSE</span>,</span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>    <span class="at">responsive =</span> <span class="cn">FALSE</span></span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the interactive plot</span></span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-46f01daf9cacac696c48" style="width:100%;height:487px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-46f01daf9cacac696c48">{"x":{"visdat":{"527d7d945a20":["function () ","plotlyVisDat"],"527d16a92b49":["function () ","data"],"527d3c58d13e":["function () ","data"],"527d6b115c65":["function () ","data"]},"cur_data":"527d6b115c65","attrs":{"527d16a92b49":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"bar","marker":{"color":"#0039A6"},"name":"Actual","hovertemplate":{},"inherit":true},"527d3c58d13e":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"bar","marker":{"color":"#EE352E"},"name":"Expected","hovertemplate":{},"inherit":true},"527d6b115c65":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines+markers","line":{"color":"#FF6319","width":2},"marker":{"color":{},"size":5,"line":{"width":1,"color":"#000000"}},"name":"Loss","hovertemplate":{},"inherit":true}},"layout":{"width":600,"height":450,"margin":{"b":65,"l":45,"t":40,"r":20},"title":{"text":"MTA Revenue Impact (2019-2023)","font":{"size":14,"color":"#0039A6","family":"Arial","weight":"bold"}},"xaxis":{"domain":[0,1],"automargin":true,"title":"","tickvals":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"ticktext":["20Q1","20Q2","20Q3","20Q4","21Q1","21Q2","21Q3","21Q4","22Q1","22Q2","22Q3","22Q4","23Q1","23Q2","23Q3","23Q4"],"tickangle":90,"tickfont":{"size":8},"fixedrange":true},"yaxis":{"domain":[0,1],"automargin":true,"title":"Revenue ($M)","zeroline":true,"zerolinewidth":2,"zerolinecolor":"#000000","tickformat":"$,.0f","gridcolor":"#E0E0E0","titlefont":{"size":10},"fixedrange":true},"barmode":"overlay","legend":{"orientation":"h","x":0.5,"y":-0.12,"xanchor":"center","font":{"size":9}},"annotations":[{"x":0.5,"y":1.05,"xref":"paper","yref":"paper","text":"Revenue: Actual (↑) vs. Expected (↓) with Loss (→)","showarrow":false,"font":{"size":9}}],"autosize":false,"dragmode":false,"font":{"size":9},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displayModeBar":false,"responsive":false},"data":[{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"y":[202.5,140.09999999999999,303.89999999999998,371.39999999999998,360.19999999999999,487.10000000000002,569.60000000000002,672.5,608.29999999999995,712.10000000000002,699.79999999999995,764.10000000000002,754.39999999999998,814.29999999999995,790,869],"type":"bar","marker":{"color":"#0039A6","line":{"color":"rgba(31,119,180,1)"}},"name":"Actual","hovertemplate":["Period: 2020 Q1<br>Actual Revenue: $202.5M<br>Recovery Rate: 50.4%","Period: 2020 Q2<br>Actual Revenue: $140.1M<br>Recovery Rate: 11.8%","Period: 2020 Q3<br>Actual Revenue: $303.9M<br>Recovery Rate: 26.3%","Period: 2020 Q4<br>Actual Revenue: $371.4M<br>Recovery Rate: 31.4%","Period: 2021 Q1<br>Actual Revenue: $360.2M<br>Recovery Rate: 32.6%","Period: 2021 Q2<br>Actual Revenue: $487.1M<br>Recovery Rate: 40.9%","Period: 2021 Q3<br>Actual Revenue: $569.6M<br>Recovery Rate: 49.3%","Period: 2021 Q4<br>Actual Revenue: $672.5M<br>Recovery Rate: 57.2%","Period: 2022 Q1<br>Actual Revenue: $608.3M<br>Recovery Rate: 54.8%","Period: 2022 Q2<br>Actual Revenue: $712.1M<br>Recovery Rate: 59.7%","Period: 2022 Q3<br>Actual Revenue: $699.8M<br>Recovery Rate: 60.6%","Period: 2022 Q4<br>Actual Revenue: $764.1M<br>Recovery Rate: 64.8%","Period: 2023 Q1<br>Actual Revenue: $754.4M<br>Recovery Rate: 68%","Period: 2023 Q2<br>Actual Revenue: $814.3M<br>Recovery Rate: 68.2%","Period: 2023 Q3<br>Actual Revenue: $790M<br>Recovery Rate: 67%","Period: 2023 Q4<br>Actual Revenue: $869M<br>Recovery Rate: 70%"],"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"y":[-401.80000000000001,-1190.7,-1156.8,-1183.3,-1103.7,-1192.0999999999999,-1155.8,-1176.4000000000001,-1110.5,-1192.9000000000001,-1154.4000000000001,-1179,-1108.7,-1194.0999999999999,-1178.4000000000001,-1241.4000000000001],"type":"bar","marker":{"color":"#EE352E","line":{"color":"rgba(255,127,14,1)"}},"name":"Expected","hovertemplate":["Period: 2020 Q1<br>Expected Revenue: $401.8M","Period: 2020 Q2<br>Expected Revenue: $1190.7M","Period: 2020 Q3<br>Expected Revenue: $1156.8M","Period: 2020 Q4<br>Expected Revenue: $1183.3M","Period: 2021 Q1<br>Expected Revenue: $1103.7M","Period: 2021 Q2<br>Expected Revenue: $1192.1M","Period: 2021 Q3<br>Expected Revenue: $1155.8M","Period: 2021 Q4<br>Expected Revenue: $1176.4M","Period: 2022 Q1<br>Expected Revenue: $1110.5M","Period: 2022 Q2<br>Expected Revenue: $1192.9M","Period: 2022 Q3<br>Expected Revenue: $1154.4M","Period: 2022 Q4<br>Expected Revenue: $1179M","Period: 2023 Q1<br>Expected Revenue: $1108.7M","Period: 2023 Q2<br>Expected Revenue: $1194.1M","Period: 2023 Q3<br>Expected Revenue: $1178.4M","Period: 2023 Q4<br>Expected Revenue: $1241.4M"],"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"y":[199.30000000000001,1050.5999999999999,853,811.89999999999998,743.5,705,586.20000000000005,503.89999999999998,502.10000000000002,480.69999999999999,454.5,414.89999999999998,354.30000000000001,379.80000000000001,388.5,372.30000000000001],"type":"scatter","mode":"lines+markers","line":{"color":"#FF6319","width":2},"marker":{"color":["#FF6319","#EE352E","#FF4500","#FF4500","#FF4500","#FF6319","#FF6319","#FF6319","#FF6319","#FF6319","#00933C","#00933C","#00933C","#00933C","#00933C","#00933C"],"size":5,"line":{"color":"#000000","width":1}},"name":"Loss","hovertemplate":["Period: 2020 Q1<br>Revenue Loss: $199.3M<br>Recovery Rate: 50.4%","Period: 2020 Q2<br>Revenue Loss: $1050.6M<br>Recovery Rate: 11.8%","Period: 2020 Q3<br>Revenue Loss: $853M<br>Recovery Rate: 26.3%","Period: 2020 Q4<br>Revenue Loss: $811.9M<br>Recovery Rate: 31.4%","Period: 2021 Q1<br>Revenue Loss: $743.5M<br>Recovery Rate: 32.6%","Period: 2021 Q2<br>Revenue Loss: $705M<br>Recovery Rate: 40.9%","Period: 2021 Q3<br>Revenue Loss: $586.2M<br>Recovery Rate: 49.3%","Period: 2021 Q4<br>Revenue Loss: $503.9M<br>Recovery Rate: 57.2%","Period: 2022 Q1<br>Revenue Loss: $502.1M<br>Recovery Rate: 54.8%","Period: 2022 Q2<br>Revenue Loss: $480.7M<br>Recovery Rate: 59.7%","Period: 2022 Q3<br>Revenue Loss: $454.5M<br>Recovery Rate: 60.6%","Period: 2022 Q4<br>Revenue Loss: $414.9M<br>Recovery Rate: 64.8%","Period: 2023 Q1<br>Revenue Loss: $354.3M<br>Recovery Rate: 68%","Period: 2023 Q2<br>Revenue Loss: $379.8M<br>Recovery Rate: 68.2%","Period: 2023 Q3<br>Revenue Loss: $388.5M<br>Recovery Rate: 67%","Period: 2023 Q4<br>Revenue Loss: $372.3M<br>Recovery Rate: 70%"],"error_y":{"color":"rgba(44,160,44,1)"},"error_x":{"color":"rgba(44,160,44,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="analysis-4-time-slot-analysis-remote-work-indicator" class="level2">
<h2 class="anchored" data-anchor-id="analysis-4-time-slot-analysis-remote-work-indicator"><strong>Analysis 4: Time Slot Analysis (Remote Work Indicator)</strong></h2>
<p><strong>Approach</strong>: We analyzed ridership patterns across different time slots on weekdays to identify changes in traditional commuting patterns. Changes in the ratios between rush hour and midday ridership serve as key indicators of remote work impact.</p>
<p><strong>Results</strong>: The time slot analysis reveals changes in weekday travel patterns that strongly indicate remote work effects. While all time slots show increased ridership from 2020 to 2023, the growth patterns and ratios between time slots have shifted notably. The Morning Rush/Midday ratio increased from 1.06 in 2020 to 1.19 by 2023, and the Evening Rush/Midday ratio increased from 1.29 to 1.47. However, these ratios are still lower than pre-pandemic norms, where morning rush typically exceeded midday ridership by factors of 1.5-2.0.</p>
<p>Notably, evening rush hours have recovered more strongly than morning rush hours, suggesting asymmetric commuting patterns consistent with hybrid work arrangements, where workers may come to the office later and still leave during traditional evening rush hours. The similar growth trajectories across all time slots, rather than stronger recovery in traditional commuting hours, further supports the conclusion that remote work has fundamentally altered the temporal distribution of subway travel.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. REMOTE WORK INDICATORS: Analyze time slot patterns</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Define MTA colors</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>mta_blue <span class="ot">&lt;-</span> <span class="st">"#0039A6"</span>  <span class="co"># MTA Blue</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>mta_yellow <span class="ot">&lt;-</span> <span class="st">"#FCCC0A"</span>  <span class="co"># MTA Yellow</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate monthly average by time slot for weekdays only</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>weekday_time_slots <span class="ot">&lt;-</span> <span class="fu">subset</span>(time_slot_analysis, is_weekday <span class="sc">==</span> <span class="st">"Weekday"</span>)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>weekday_time_slots<span class="sc">$</span>year <span class="ot">&lt;-</span> <span class="fu">format</span>(weekday_time_slots<span class="sc">$</span>date, <span class="st">"%Y"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>weekday_time_slots<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">format</span>(weekday_time_slots<span class="sc">$</span>date, <span class="st">"%m"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>weekday_time_slots<span class="sc">$</span>month_name <span class="ot">&lt;-</span> month.abb[<span class="fu">as.numeric</span>(weekday_time_slots<span class="sc">$</span>month)]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>weekday_time_slots<span class="sc">$</span>year_month <span class="ot">&lt;-</span> <span class="fu">format</span>(weekday_time_slots<span class="sc">$</span>date, <span class="st">"%Y-%m"</span>)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Monthly time slot analysis</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>time_slot_monthly <span class="ot">&lt;-</span> weekday_time_slots <span class="sc">%&gt;%</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as.numeric</span>(year) <span class="sc">&lt;=</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span>  <span class="co"># Filter to years through 2023</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month, month_name, year_month, time_slot) <span class="sc">%&gt;%</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_ridership =</span> <span class="fu">mean</span>(total_ridership), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a wider format for the table with monthly data</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>time_slot_wide_monthly <span class="ot">&lt;-</span> time_slot_monthly <span class="sc">%&gt;%</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(year, month, month_name, year_month), </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> time_slot, </span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> avg_ridership)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ratios (key indicators of remote work impact)</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>time_slot_wide_monthly<span class="sc">$</span><span class="st">`</span><span class="at">Morning Rush / Midday Ratio</span><span class="st">`</span> <span class="ot">&lt;-</span> </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  time_slot_wide_monthly<span class="sc">$</span><span class="st">`</span><span class="at">Morning Rush (6AM-10AM)</span><span class="st">`</span> <span class="sc">/</span> time_slot_wide_monthly<span class="sc">$</span><span class="st">`</span><span class="at">Midday (10AM-3PM)</span><span class="st">`</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>time_slot_wide_monthly<span class="sc">$</span><span class="st">`</span><span class="at">Evening Rush / Midday Ratio</span><span class="st">`</span> <span class="ot">&lt;-</span> </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  time_slot_wide_monthly<span class="sc">$</span><span class="st">`</span><span class="at">Evening Rush (3PM-7PM)</span><span class="st">`</span> <span class="sc">/</span> time_slot_wide_monthly<span class="sc">$</span><span class="st">`</span><span class="at">Midday (10AM-3PM)</span><span class="st">`</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Round for display</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>time_slot_wide_monthly <span class="ot">&lt;-</span> time_slot_wide_monthly <span class="sc">%&gt;%</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">Morning Rush (6AM-10AM)</span><span class="st">`</span>, <span class="st">`</span><span class="at">Midday (10AM-3PM)</span><span class="st">`</span>, </span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>                  <span class="st">`</span><span class="at">Evening Rush (3PM-7PM)</span><span class="st">`</span>, <span class="st">`</span><span class="at">Off-Hours (7PM-6AM)</span><span class="st">`</span>), </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">0</span>)),</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">Morning Rush / Midday Ratio</span><span class="st">`</span>, <span class="st">`</span><span class="at">Evening Rush / Midday Ratio</span><span class="st">`</span>), </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>                <span class="sc">~</span><span class="fu">round</span>(., <span class="dv">2</span>)))</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a yearly summary table for display</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>yearly_summary <span class="ot">&lt;-</span> time_slot_wide_monthly <span class="sc">%&gt;%</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Morning Rush (6AM-10AM)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="st">`</span><span class="at">Morning Rush (6AM-10AM)</span><span class="st">`</span>), <span class="dv">0</span>),</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Midday (10AM-3PM)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="st">`</span><span class="at">Midday (10AM-3PM)</span><span class="st">`</span>), <span class="dv">0</span>),</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Evening Rush (3PM-7PM)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="st">`</span><span class="at">Evening Rush (3PM-7PM)</span><span class="st">`</span>), <span class="dv">0</span>),</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Off-Hours (7PM-6AM)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="st">`</span><span class="at">Off-Hours (7PM-6AM)</span><span class="st">`</span>), <span class="dv">0</span>),</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Morning Rush / Midday Ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="st">`</span><span class="at">Morning Rush / Midday Ratio</span><span class="st">`</span>), <span class="dv">2</span>),</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Evening Rush / Midday Ratio</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="st">`</span><span class="at">Evening Rush / Midday Ratio</span><span class="st">`</span>), <span class="dv">2</span>),</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a collapsible HTML table with years and months</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>create_collapsible_table <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First, create the main yearly table</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>  yearly_table <span class="ot">&lt;-</span> <span class="fu">kable</span>(yearly_summary, </span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>                        <span class="at">format =</span> <span class="st">"html"</span>, </span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>                        <span class="at">caption =</span> <span class="st">"Weekday Time Slot Analysis (Remote Work Indicator) - Yearly Summary"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>                  <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="st">"center"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> mta_blue, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column_spec</span>(<span class="dv">1</span>, <span class="at">background =</span> <span class="st">"#f8f8f8"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now add collapsible sections for each year with monthly data</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (yr <span class="cf">in</span> <span class="fu">unique</span>(time_slot_wide_monthly<span class="sc">$</span>year)) {</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>    monthly_data <span class="ot">&lt;-</span> time_slot_wide_monthly <span class="sc">%&gt;%</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">==</span> yr) <span class="sc">%&gt;%</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(month_name, <span class="st">`</span><span class="at">Morning Rush (6AM-10AM)</span><span class="st">`</span>, <span class="st">`</span><span class="at">Midday (10AM-3PM)</span><span class="st">`</span>, </span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>             <span class="st">`</span><span class="at">Evening Rush (3PM-7PM)</span><span class="st">`</span>, <span class="st">`</span><span class="at">Off-Hours (7PM-6AM)</span><span class="st">`</span>, </span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>             <span class="st">`</span><span class="at">Morning Rush / Midday Ratio</span><span class="st">`</span>, <span class="st">`</span><span class="at">Evening Rush / Midday Ratio</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">match</span>(month_name, month.abb))</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>    monthly_table <span class="ot">&lt;-</span> <span class="fu">kable</span>(monthly_data, <span class="at">format =</span> <span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"condensed"</span>),</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>                    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>                    <span class="at">font_size =</span> <span class="dv">12</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>      <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> <span class="st">"#ddd"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a hidden div with the monthly data that can be toggled</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>    yearly_table <span class="ot">&lt;-</span> yearly_table <span class="sc">%&gt;%</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_footnote</span>(<span class="fu">paste0</span>(</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;div id='year"</span>, yr, <span class="st">"' style='display:none;'&gt;"</span>,</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;h4&gt;Monthly Data for "</span>, yr, <span class="st">"&lt;/h4&gt;"</span>,</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>        monthly_table,</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;/div&gt;"</span>,</span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;button onclick=</span><span class="sc">\"</span><span class="st">$('#year"</span>, yr, <span class="st">"').toggle();</span><span class="sc">\"</span><span class="st">&gt;Toggle "</span>, yr, <span class="st">" Monthly Data&lt;/button&gt;"</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>      ), <span class="at">escape =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(yearly_table)</span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the HTML-based collapsible table</span></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>collapsible_table <span class="ot">&lt;-</span> <span class="fu">create_collapsible_table</span>()</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>collapsible_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover" style="width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Weekday Time Slot Analysis (Remote Work Indicator) - Yearly Summary</caption>
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;color: white !important;background-color: rgba(0, 57, 166, 255) !important;"> year </th>
   <th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(0, 57, 166, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(0, 57, 166, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(0, 57, 166, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(0, 57, 166, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(0, 57, 166, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;color: white !important;background-color: rgba(0, 57, 166, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;font-weight: bold;background-color: rgba(248, 248, 248, 255) !important;"> 2020 </td>
   <td style="text-align:right;"> 373650 </td>
   <td style="text-align:right;"> 356312 </td>
   <td style="text-align:right;"> 458219 </td>
   <td style="text-align:right;"> 244492 </td>
   <td style="text-align:right;"> 1.06 </td>
   <td style="text-align:right;"> 1.29 </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;background-color: rgba(248, 248, 248, 255) !important;"> 2021 </td>
   <td style="text-align:right;"> 661256 </td>
   <td style="text-align:right;"> 610351 </td>
   <td style="text-align:right;"> 829210 </td>
   <td style="text-align:right;"> 460808 </td>
   <td style="text-align:right;"> 1.08 </td>
   <td style="text-align:right;"> 1.35 </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;background-color: rgba(248, 248, 248, 255) !important;"> 2022 </td>
   <td style="text-align:right;"> 922958 </td>
   <td style="text-align:right;"> 778520 </td>
   <td style="text-align:right;"> 1131112 </td>
   <td style="text-align:right;"> 627955 </td>
   <td style="text-align:right;"> 1.19 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;font-weight: bold;background-color: rgba(248, 248, 248, 255) !important;"> 2023 </td>
   <td style="text-align:right;"> 966353 </td>
   <td style="text-align:right;"> 817543 </td>
   <td style="text-align:right;"> 1200296 </td>
   <td style="text-align:right;"> 656449 </td>
   <td style="text-align:right;"> 1.19 </td>
   <td style="text-align:right;"> 1.48 </td>
  </tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2023" style="display:none;"><h4 class="anchored">Monthly Data for 2023</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jan </td>
   <td style="text-align:right;"> 923677 </td>
   <td style="text-align:right;"> 727943 </td>
   <td style="text-align:right;"> 1179229 </td>
   <td style="text-align:right;"> 565331 </td>
   <td style="text-align:right;"> 1.27 </td>
   <td style="text-align:right;"> 1.62 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Feb </td>
   <td style="text-align:right;"> 737694 </td>
   <td style="text-align:right;"> 590751 </td>
   <td style="text-align:right;"> 896996 </td>
   <td style="text-align:right;"> 493680 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mar </td>
   <td style="text-align:right;"> 1097414 </td>
   <td style="text-align:right;"> 872691 </td>
   <td style="text-align:right;"> 1326265 </td>
   <td style="text-align:right;"> 704031 </td>
   <td style="text-align:right;"> 1.26 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apr </td>
   <td style="text-align:right;"> 1111103 </td>
   <td style="text-align:right;"> 910356 </td>
   <td style="text-align:right;"> 1335479 </td>
   <td style="text-align:right;"> 746364 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.47 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> May </td>
   <td style="text-align:right;"> 1013134 </td>
   <td style="text-align:right;"> 816300 </td>
   <td style="text-align:right;"> 1213720 </td>
   <td style="text-align:right;"> 673766 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jun </td>
   <td style="text-align:right;"> 781364 </td>
   <td style="text-align:right;"> 694573 </td>
   <td style="text-align:right;"> 991462 </td>
   <td style="text-align:right;"> 580962 </td>
   <td style="text-align:right;"> 1.12 </td>
   <td style="text-align:right;"> 1.43 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 782225 </td>
   <td style="text-align:right;"> 641266 </td>
   <td style="text-align:right;"> 985177 </td>
   <td style="text-align:right;"> 568357 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.54 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 1020220 </td>
   <td style="text-align:right;"> 905799 </td>
   <td style="text-align:right;"> 1320332 </td>
   <td style="text-align:right;"> 777304 </td>
   <td style="text-align:right;"> 1.13 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 1018193 </td>
   <td style="text-align:right;"> 823917 </td>
   <td style="text-align:right;"> 1229626 </td>
   <td style="text-align:right;"> 679890 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 1073258 </td>
   <td style="text-align:right;"> 921818 </td>
   <td style="text-align:right;"> 1313195 </td>
   <td style="text-align:right;"> 680990 </td>
   <td style="text-align:right;"> 1.16 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 1162997 </td>
   <td style="text-align:right;"> 1065975 </td>
   <td style="text-align:right;"> 1437503 </td>
   <td style="text-align:right;"> 744966 </td>
   <td style="text-align:right;"> 1.09 </td>
   <td style="text-align:right;"> 1.35 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 874962 </td>
   <td style="text-align:right;"> 839127 </td>
   <td style="text-align:right;"> 1174564 </td>
   <td style="text-align:right;"> 661751 </td>
   <td style="text-align:right;"> 1.04 </td>
   <td style="text-align:right;"> 1.40 </td>
  </tr>
</tbody>
</table></div><button onclick="$('#year2023').toggle();">Toggle 2023 Monthly Data</button></td>
</tr>
</tfoot>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2022" style="display:none;"><h4 class="anchored">Monthly Data for 2022</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jan </td>
   <td style="text-align:right;"> 856641 </td>
   <td style="text-align:right;"> 720827 </td>
   <td style="text-align:right;"> 1020625 </td>
   <td style="text-align:right;"> 517638 </td>
   <td style="text-align:right;"> 1.19 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Feb </td>
   <td style="text-align:right;"> 874139 </td>
   <td style="text-align:right;"> 702104 </td>
   <td style="text-align:right;"> 1026892 </td>
   <td style="text-align:right;"> 521058 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mar </td>
   <td style="text-align:right;"> 880043 </td>
   <td style="text-align:right;"> 684268 </td>
   <td style="text-align:right;"> 1023703 </td>
   <td style="text-align:right;"> 531523 </td>
   <td style="text-align:right;"> 1.29 </td>
   <td style="text-align:right;"> 1.50 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apr </td>
   <td style="text-align:right;"> 876689 </td>
   <td style="text-align:right;"> 705032 </td>
   <td style="text-align:right;"> 1019487 </td>
   <td style="text-align:right;"> 558885 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.45 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> May </td>
   <td style="text-align:right;"> 1079687 </td>
   <td style="text-align:right;"> 875267 </td>
   <td style="text-align:right;"> 1281097 </td>
   <td style="text-align:right;"> 717180 </td>
   <td style="text-align:right;"> 1.23 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jun </td>
   <td style="text-align:right;"> 974161 </td>
   <td style="text-align:right;"> 796801 </td>
   <td style="text-align:right;"> 1205210 </td>
   <td style="text-align:right;"> 679260 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.51 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 793837 </td>
   <td style="text-align:right;"> 729192 </td>
   <td style="text-align:right;"> 1033825 </td>
   <td style="text-align:right;"> 647112 </td>
   <td style="text-align:right;"> 1.09 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 755366 </td>
   <td style="text-align:right;"> 665568 </td>
   <td style="text-align:right;"> 1018248 </td>
   <td style="text-align:right;"> 599106 </td>
   <td style="text-align:right;"> 1.13 </td>
   <td style="text-align:right;"> 1.53 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 1229085 </td>
   <td style="text-align:right;"> 1051654 </td>
   <td style="text-align:right;"> 1527651 </td>
   <td style="text-align:right;"> 872243 </td>
   <td style="text-align:right;"> 1.17 </td>
   <td style="text-align:right;"> 1.45 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 907609 </td>
   <td style="text-align:right;"> 728197 </td>
   <td style="text-align:right;"> 1060944 </td>
   <td style="text-align:right;"> 589645 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 1004970 </td>
   <td style="text-align:right;"> 832365 </td>
   <td style="text-align:right;"> 1182117 </td>
   <td style="text-align:right;"> 645870 </td>
   <td style="text-align:right;"> 1.21 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 843264 </td>
   <td style="text-align:right;"> 850959 </td>
   <td style="text-align:right;"> 1173546 </td>
   <td style="text-align:right;"> 655942 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 1.38 </td>
  </tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2023" style="display:none;"><h4 class="anchored">Monthly Data for 2023</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jan </td>
   <td style="text-align:right;"> 923677 </td>
   <td style="text-align:right;"> 727943 </td>
   <td style="text-align:right;"> 1179229 </td>
   <td style="text-align:right;"> 565331 </td>
   <td style="text-align:right;"> 1.27 </td>
   <td style="text-align:right;"> 1.62 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Feb </td>
   <td style="text-align:right;"> 737694 </td>
   <td style="text-align:right;"> 590751 </td>
   <td style="text-align:right;"> 896996 </td>
   <td style="text-align:right;"> 493680 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mar </td>
   <td style="text-align:right;"> 1097414 </td>
   <td style="text-align:right;"> 872691 </td>
   <td style="text-align:right;"> 1326265 </td>
   <td style="text-align:right;"> 704031 </td>
   <td style="text-align:right;"> 1.26 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apr </td>
   <td style="text-align:right;"> 1111103 </td>
   <td style="text-align:right;"> 910356 </td>
   <td style="text-align:right;"> 1335479 </td>
   <td style="text-align:right;"> 746364 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.47 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> May </td>
   <td style="text-align:right;"> 1013134 </td>
   <td style="text-align:right;"> 816300 </td>
   <td style="text-align:right;"> 1213720 </td>
   <td style="text-align:right;"> 673766 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jun </td>
   <td style="text-align:right;"> 781364 </td>
   <td style="text-align:right;"> 694573 </td>
   <td style="text-align:right;"> 991462 </td>
   <td style="text-align:right;"> 580962 </td>
   <td style="text-align:right;"> 1.12 </td>
   <td style="text-align:right;"> 1.43 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 782225 </td>
   <td style="text-align:right;"> 641266 </td>
   <td style="text-align:right;"> 985177 </td>
   <td style="text-align:right;"> 568357 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.54 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 1020220 </td>
   <td style="text-align:right;"> 905799 </td>
   <td style="text-align:right;"> 1320332 </td>
   <td style="text-align:right;"> 777304 </td>
   <td style="text-align:right;"> 1.13 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 1018193 </td>
   <td style="text-align:right;"> 823917 </td>
   <td style="text-align:right;"> 1229626 </td>
   <td style="text-align:right;"> 679890 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 1073258 </td>
   <td style="text-align:right;"> 921818 </td>
   <td style="text-align:right;"> 1313195 </td>
   <td style="text-align:right;"> 680990 </td>
   <td style="text-align:right;"> 1.16 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 1162997 </td>
   <td style="text-align:right;"> 1065975 </td>
   <td style="text-align:right;"> 1437503 </td>
   <td style="text-align:right;"> 744966 </td>
   <td style="text-align:right;"> 1.09 </td>
   <td style="text-align:right;"> 1.35 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 874962 </td>
   <td style="text-align:right;"> 839127 </td>
   <td style="text-align:right;"> 1174564 </td>
   <td style="text-align:right;"> 661751 </td>
   <td style="text-align:right;"> 1.04 </td>
   <td style="text-align:right;"> 1.40 </td>
  </tr>
</tbody>
</table></div><button onclick="$('#year2023').toggle();">Toggle 2023 Monthly Data</button></td>
</tr>
</tfoot>
</table></div><button onclick="$('#year2022').toggle();">Toggle 2022 Monthly Data</button></td>
</tr>
</tfoot>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2021" style="display:none;"><h4 class="anchored">Monthly Data for 2021</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jan </td>
   <td style="text-align:right;"> 549376 </td>
   <td style="text-align:right;"> 515693 </td>
   <td style="text-align:right;"> 635642 </td>
   <td style="text-align:right;"> 316983 </td>
   <td style="text-align:right;"> 1.07 </td>
   <td style="text-align:right;"> 1.23 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Feb </td>
   <td style="text-align:right;"> 526404 </td>
   <td style="text-align:right;"> 495252 </td>
   <td style="text-align:right;"> 615002 </td>
   <td style="text-align:right;"> 322971 </td>
   <td style="text-align:right;"> 1.06 </td>
   <td style="text-align:right;"> 1.24 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mar </td>
   <td style="text-align:right;"> 571099 </td>
   <td style="text-align:right;"> 526354 </td>
   <td style="text-align:right;"> 697726 </td>
   <td style="text-align:right;"> 366704 </td>
   <td style="text-align:right;"> 1.09 </td>
   <td style="text-align:right;"> 1.33 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apr </td>
   <td style="text-align:right;"> 552092 </td>
   <td style="text-align:right;"> 531089 </td>
   <td style="text-align:right;"> 681874 </td>
   <td style="text-align:right;"> 375348 </td>
   <td style="text-align:right;"> 1.04 </td>
   <td style="text-align:right;"> 1.28 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> May </td>
   <td style="text-align:right;"> 505784 </td>
   <td style="text-align:right;"> 507448 </td>
   <td style="text-align:right;"> 662708 </td>
   <td style="text-align:right;"> 387898 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1.31 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jun </td>
   <td style="text-align:right;"> 639771 </td>
   <td style="text-align:right;"> 629648 </td>
   <td style="text-align:right;"> 845582 </td>
   <td style="text-align:right;"> 521075 </td>
   <td style="text-align:right;"> 1.02 </td>
   <td style="text-align:right;"> 1.34 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 658227 </td>
   <td style="text-align:right;"> 659613 </td>
   <td style="text-align:right;"> 896858 </td>
   <td style="text-align:right;"> 525848 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1.36 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 673194 </td>
   <td style="text-align:right;"> 637958 </td>
   <td style="text-align:right;"> 878990 </td>
   <td style="text-align:right;"> 546142 </td>
   <td style="text-align:right;"> 1.06 </td>
   <td style="text-align:right;"> 1.38 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 881670 </td>
   <td style="text-align:right;"> 794865 </td>
   <td style="text-align:right;"> 1146188 </td>
   <td style="text-align:right;"> 631787 </td>
   <td style="text-align:right;"> 1.11 </td>
   <td style="text-align:right;"> 1.44 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 825848 </td>
   <td style="text-align:right;"> 657239 </td>
   <td style="text-align:right;"> 958199 </td>
   <td style="text-align:right;"> 517190 </td>
   <td style="text-align:right;"> 1.26 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 836965 </td>
   <td style="text-align:right;"> 726381 </td>
   <td style="text-align:right;"> 1018265 </td>
   <td style="text-align:right;"> 540072 </td>
   <td style="text-align:right;"> 1.15 </td>
   <td style="text-align:right;"> 1.40 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 714637 </td>
   <td style="text-align:right;"> 642671 </td>
   <td style="text-align:right;"> 913489 </td>
   <td style="text-align:right;"> 477683 </td>
   <td style="text-align:right;"> 1.11 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2023" style="display:none;"><h4 class="anchored">Monthly Data for 2023</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jan </td>
   <td style="text-align:right;"> 923677 </td>
   <td style="text-align:right;"> 727943 </td>
   <td style="text-align:right;"> 1179229 </td>
   <td style="text-align:right;"> 565331 </td>
   <td style="text-align:right;"> 1.27 </td>
   <td style="text-align:right;"> 1.62 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Feb </td>
   <td style="text-align:right;"> 737694 </td>
   <td style="text-align:right;"> 590751 </td>
   <td style="text-align:right;"> 896996 </td>
   <td style="text-align:right;"> 493680 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mar </td>
   <td style="text-align:right;"> 1097414 </td>
   <td style="text-align:right;"> 872691 </td>
   <td style="text-align:right;"> 1326265 </td>
   <td style="text-align:right;"> 704031 </td>
   <td style="text-align:right;"> 1.26 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apr </td>
   <td style="text-align:right;"> 1111103 </td>
   <td style="text-align:right;"> 910356 </td>
   <td style="text-align:right;"> 1335479 </td>
   <td style="text-align:right;"> 746364 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.47 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> May </td>
   <td style="text-align:right;"> 1013134 </td>
   <td style="text-align:right;"> 816300 </td>
   <td style="text-align:right;"> 1213720 </td>
   <td style="text-align:right;"> 673766 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jun </td>
   <td style="text-align:right;"> 781364 </td>
   <td style="text-align:right;"> 694573 </td>
   <td style="text-align:right;"> 991462 </td>
   <td style="text-align:right;"> 580962 </td>
   <td style="text-align:right;"> 1.12 </td>
   <td style="text-align:right;"> 1.43 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 782225 </td>
   <td style="text-align:right;"> 641266 </td>
   <td style="text-align:right;"> 985177 </td>
   <td style="text-align:right;"> 568357 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.54 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 1020220 </td>
   <td style="text-align:right;"> 905799 </td>
   <td style="text-align:right;"> 1320332 </td>
   <td style="text-align:right;"> 777304 </td>
   <td style="text-align:right;"> 1.13 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 1018193 </td>
   <td style="text-align:right;"> 823917 </td>
   <td style="text-align:right;"> 1229626 </td>
   <td style="text-align:right;"> 679890 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 1073258 </td>
   <td style="text-align:right;"> 921818 </td>
   <td style="text-align:right;"> 1313195 </td>
   <td style="text-align:right;"> 680990 </td>
   <td style="text-align:right;"> 1.16 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 1162997 </td>
   <td style="text-align:right;"> 1065975 </td>
   <td style="text-align:right;"> 1437503 </td>
   <td style="text-align:right;"> 744966 </td>
   <td style="text-align:right;"> 1.09 </td>
   <td style="text-align:right;"> 1.35 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 874962 </td>
   <td style="text-align:right;"> 839127 </td>
   <td style="text-align:right;"> 1174564 </td>
   <td style="text-align:right;"> 661751 </td>
   <td style="text-align:right;"> 1.04 </td>
   <td style="text-align:right;"> 1.40 </td>
  </tr>
</tbody>
</table></div><button onclick="$('#year2023').toggle();">Toggle 2023 Monthly Data</button></td>
</tr>
</tfoot>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2022" style="display:none;"><h4 class="anchored">Monthly Data for 2022</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jan </td>
   <td style="text-align:right;"> 856641 </td>
   <td style="text-align:right;"> 720827 </td>
   <td style="text-align:right;"> 1020625 </td>
   <td style="text-align:right;"> 517638 </td>
   <td style="text-align:right;"> 1.19 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Feb </td>
   <td style="text-align:right;"> 874139 </td>
   <td style="text-align:right;"> 702104 </td>
   <td style="text-align:right;"> 1026892 </td>
   <td style="text-align:right;"> 521058 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mar </td>
   <td style="text-align:right;"> 880043 </td>
   <td style="text-align:right;"> 684268 </td>
   <td style="text-align:right;"> 1023703 </td>
   <td style="text-align:right;"> 531523 </td>
   <td style="text-align:right;"> 1.29 </td>
   <td style="text-align:right;"> 1.50 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apr </td>
   <td style="text-align:right;"> 876689 </td>
   <td style="text-align:right;"> 705032 </td>
   <td style="text-align:right;"> 1019487 </td>
   <td style="text-align:right;"> 558885 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.45 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> May </td>
   <td style="text-align:right;"> 1079687 </td>
   <td style="text-align:right;"> 875267 </td>
   <td style="text-align:right;"> 1281097 </td>
   <td style="text-align:right;"> 717180 </td>
   <td style="text-align:right;"> 1.23 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jun </td>
   <td style="text-align:right;"> 974161 </td>
   <td style="text-align:right;"> 796801 </td>
   <td style="text-align:right;"> 1205210 </td>
   <td style="text-align:right;"> 679260 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.51 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 793837 </td>
   <td style="text-align:right;"> 729192 </td>
   <td style="text-align:right;"> 1033825 </td>
   <td style="text-align:right;"> 647112 </td>
   <td style="text-align:right;"> 1.09 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 755366 </td>
   <td style="text-align:right;"> 665568 </td>
   <td style="text-align:right;"> 1018248 </td>
   <td style="text-align:right;"> 599106 </td>
   <td style="text-align:right;"> 1.13 </td>
   <td style="text-align:right;"> 1.53 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 1229085 </td>
   <td style="text-align:right;"> 1051654 </td>
   <td style="text-align:right;"> 1527651 </td>
   <td style="text-align:right;"> 872243 </td>
   <td style="text-align:right;"> 1.17 </td>
   <td style="text-align:right;"> 1.45 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 907609 </td>
   <td style="text-align:right;"> 728197 </td>
   <td style="text-align:right;"> 1060944 </td>
   <td style="text-align:right;"> 589645 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 1004970 </td>
   <td style="text-align:right;"> 832365 </td>
   <td style="text-align:right;"> 1182117 </td>
   <td style="text-align:right;"> 645870 </td>
   <td style="text-align:right;"> 1.21 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 843264 </td>
   <td style="text-align:right;"> 850959 </td>
   <td style="text-align:right;"> 1173546 </td>
   <td style="text-align:right;"> 655942 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 1.38 </td>
  </tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2023" style="display:none;"><h4 class="anchored">Monthly Data for 2023</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jan </td>
   <td style="text-align:right;"> 923677 </td>
   <td style="text-align:right;"> 727943 </td>
   <td style="text-align:right;"> 1179229 </td>
   <td style="text-align:right;"> 565331 </td>
   <td style="text-align:right;"> 1.27 </td>
   <td style="text-align:right;"> 1.62 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Feb </td>
   <td style="text-align:right;"> 737694 </td>
   <td style="text-align:right;"> 590751 </td>
   <td style="text-align:right;"> 896996 </td>
   <td style="text-align:right;"> 493680 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mar </td>
   <td style="text-align:right;"> 1097414 </td>
   <td style="text-align:right;"> 872691 </td>
   <td style="text-align:right;"> 1326265 </td>
   <td style="text-align:right;"> 704031 </td>
   <td style="text-align:right;"> 1.26 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apr </td>
   <td style="text-align:right;"> 1111103 </td>
   <td style="text-align:right;"> 910356 </td>
   <td style="text-align:right;"> 1335479 </td>
   <td style="text-align:right;"> 746364 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.47 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> May </td>
   <td style="text-align:right;"> 1013134 </td>
   <td style="text-align:right;"> 816300 </td>
   <td style="text-align:right;"> 1213720 </td>
   <td style="text-align:right;"> 673766 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jun </td>
   <td style="text-align:right;"> 781364 </td>
   <td style="text-align:right;"> 694573 </td>
   <td style="text-align:right;"> 991462 </td>
   <td style="text-align:right;"> 580962 </td>
   <td style="text-align:right;"> 1.12 </td>
   <td style="text-align:right;"> 1.43 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 782225 </td>
   <td style="text-align:right;"> 641266 </td>
   <td style="text-align:right;"> 985177 </td>
   <td style="text-align:right;"> 568357 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.54 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 1020220 </td>
   <td style="text-align:right;"> 905799 </td>
   <td style="text-align:right;"> 1320332 </td>
   <td style="text-align:right;"> 777304 </td>
   <td style="text-align:right;"> 1.13 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 1018193 </td>
   <td style="text-align:right;"> 823917 </td>
   <td style="text-align:right;"> 1229626 </td>
   <td style="text-align:right;"> 679890 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 1073258 </td>
   <td style="text-align:right;"> 921818 </td>
   <td style="text-align:right;"> 1313195 </td>
   <td style="text-align:right;"> 680990 </td>
   <td style="text-align:right;"> 1.16 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 1162997 </td>
   <td style="text-align:right;"> 1065975 </td>
   <td style="text-align:right;"> 1437503 </td>
   <td style="text-align:right;"> 744966 </td>
   <td style="text-align:right;"> 1.09 </td>
   <td style="text-align:right;"> 1.35 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 874962 </td>
   <td style="text-align:right;"> 839127 </td>
   <td style="text-align:right;"> 1174564 </td>
   <td style="text-align:right;"> 661751 </td>
   <td style="text-align:right;"> 1.04 </td>
   <td style="text-align:right;"> 1.40 </td>
  </tr>
</tbody>
</table></div><button onclick="$('#year2023').toggle();">Toggle 2023 Monthly Data</button></td>
</tr>
</tfoot>
</table></div><button onclick="$('#year2022').toggle();">Toggle 2022 Monthly Data</button></td>
</tr>
</tfoot>
</table></div><button onclick="$('#year2021').toggle();">Toggle 2021 Monthly Data</button></td>
</tr>
</tfoot>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2020" style="display:none;"><h4 class="anchored">Monthly Data for 2020</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 259809 </td>
   <td style="text-align:right;"> 211503 </td>
   <td style="text-align:right;"> 281474 </td>
   <td style="text-align:right;"> 162345 </td>
   <td style="text-align:right;"> 1.23 </td>
   <td style="text-align:right;"> 1.33 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 285349 </td>
   <td style="text-align:right;"> 282354 </td>
   <td style="text-align:right;"> 340915 </td>
   <td style="text-align:right;"> 192627 </td>
   <td style="text-align:right;"> 1.01 </td>
   <td style="text-align:right;"> 1.21 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 428540 </td>
   <td style="text-align:right;"> 423334 </td>
   <td style="text-align:right;"> 530186 </td>
   <td style="text-align:right;"> 298014 </td>
   <td style="text-align:right;"> 1.01 </td>
   <td style="text-align:right;"> 1.25 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 415175 </td>
   <td style="text-align:right;"> 372466 </td>
   <td style="text-align:right;"> 489715 </td>
   <td style="text-align:right;"> 258081 </td>
   <td style="text-align:right;"> 1.11 </td>
   <td style="text-align:right;"> 1.31 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 426403 </td>
   <td style="text-align:right;"> 421074 </td>
   <td style="text-align:right;"> 567856 </td>
   <td style="text-align:right;"> 280401 </td>
   <td style="text-align:right;"> 1.01 </td>
   <td style="text-align:right;"> 1.35 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 426626 </td>
   <td style="text-align:right;"> 427140 </td>
   <td style="text-align:right;"> 539168 </td>
   <td style="text-align:right;"> 275486 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1.26 </td>
  </tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2023" style="display:none;"><h4 class="anchored">Monthly Data for 2023</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jan </td>
   <td style="text-align:right;"> 923677 </td>
   <td style="text-align:right;"> 727943 </td>
   <td style="text-align:right;"> 1179229 </td>
   <td style="text-align:right;"> 565331 </td>
   <td style="text-align:right;"> 1.27 </td>
   <td style="text-align:right;"> 1.62 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Feb </td>
   <td style="text-align:right;"> 737694 </td>
   <td style="text-align:right;"> 590751 </td>
   <td style="text-align:right;"> 896996 </td>
   <td style="text-align:right;"> 493680 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mar </td>
   <td style="text-align:right;"> 1097414 </td>
   <td style="text-align:right;"> 872691 </td>
   <td style="text-align:right;"> 1326265 </td>
   <td style="text-align:right;"> 704031 </td>
   <td style="text-align:right;"> 1.26 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apr </td>
   <td style="text-align:right;"> 1111103 </td>
   <td style="text-align:right;"> 910356 </td>
   <td style="text-align:right;"> 1335479 </td>
   <td style="text-align:right;"> 746364 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.47 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> May </td>
   <td style="text-align:right;"> 1013134 </td>
   <td style="text-align:right;"> 816300 </td>
   <td style="text-align:right;"> 1213720 </td>
   <td style="text-align:right;"> 673766 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jun </td>
   <td style="text-align:right;"> 781364 </td>
   <td style="text-align:right;"> 694573 </td>
   <td style="text-align:right;"> 991462 </td>
   <td style="text-align:right;"> 580962 </td>
   <td style="text-align:right;"> 1.12 </td>
   <td style="text-align:right;"> 1.43 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 782225 </td>
   <td style="text-align:right;"> 641266 </td>
   <td style="text-align:right;"> 985177 </td>
   <td style="text-align:right;"> 568357 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.54 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 1020220 </td>
   <td style="text-align:right;"> 905799 </td>
   <td style="text-align:right;"> 1320332 </td>
   <td style="text-align:right;"> 777304 </td>
   <td style="text-align:right;"> 1.13 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 1018193 </td>
   <td style="text-align:right;"> 823917 </td>
   <td style="text-align:right;"> 1229626 </td>
   <td style="text-align:right;"> 679890 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 1073258 </td>
   <td style="text-align:right;"> 921818 </td>
   <td style="text-align:right;"> 1313195 </td>
   <td style="text-align:right;"> 680990 </td>
   <td style="text-align:right;"> 1.16 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 1162997 </td>
   <td style="text-align:right;"> 1065975 </td>
   <td style="text-align:right;"> 1437503 </td>
   <td style="text-align:right;"> 744966 </td>
   <td style="text-align:right;"> 1.09 </td>
   <td style="text-align:right;"> 1.35 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 874962 </td>
   <td style="text-align:right;"> 839127 </td>
   <td style="text-align:right;"> 1174564 </td>
   <td style="text-align:right;"> 661751 </td>
   <td style="text-align:right;"> 1.04 </td>
   <td style="text-align:right;"> 1.40 </td>
  </tr>
</tbody>
</table></div><button onclick="$('#year2023').toggle();">Toggle 2023 Monthly Data</button></td>
</tr>
</tfoot>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2022" style="display:none;"><h4 class="anchored">Monthly Data for 2022</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jan </td>
   <td style="text-align:right;"> 856641 </td>
   <td style="text-align:right;"> 720827 </td>
   <td style="text-align:right;"> 1020625 </td>
   <td style="text-align:right;"> 517638 </td>
   <td style="text-align:right;"> 1.19 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Feb </td>
   <td style="text-align:right;"> 874139 </td>
   <td style="text-align:right;"> 702104 </td>
   <td style="text-align:right;"> 1026892 </td>
   <td style="text-align:right;"> 521058 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mar </td>
   <td style="text-align:right;"> 880043 </td>
   <td style="text-align:right;"> 684268 </td>
   <td style="text-align:right;"> 1023703 </td>
   <td style="text-align:right;"> 531523 </td>
   <td style="text-align:right;"> 1.29 </td>
   <td style="text-align:right;"> 1.50 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apr </td>
   <td style="text-align:right;"> 876689 </td>
   <td style="text-align:right;"> 705032 </td>
   <td style="text-align:right;"> 1019487 </td>
   <td style="text-align:right;"> 558885 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.45 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> May </td>
   <td style="text-align:right;"> 1079687 </td>
   <td style="text-align:right;"> 875267 </td>
   <td style="text-align:right;"> 1281097 </td>
   <td style="text-align:right;"> 717180 </td>
   <td style="text-align:right;"> 1.23 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jun </td>
   <td style="text-align:right;"> 974161 </td>
   <td style="text-align:right;"> 796801 </td>
   <td style="text-align:right;"> 1205210 </td>
   <td style="text-align:right;"> 679260 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.51 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 793837 </td>
   <td style="text-align:right;"> 729192 </td>
   <td style="text-align:right;"> 1033825 </td>
   <td style="text-align:right;"> 647112 </td>
   <td style="text-align:right;"> 1.09 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 755366 </td>
   <td style="text-align:right;"> 665568 </td>
   <td style="text-align:right;"> 1018248 </td>
   <td style="text-align:right;"> 599106 </td>
   <td style="text-align:right;"> 1.13 </td>
   <td style="text-align:right;"> 1.53 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 1229085 </td>
   <td style="text-align:right;"> 1051654 </td>
   <td style="text-align:right;"> 1527651 </td>
   <td style="text-align:right;"> 872243 </td>
   <td style="text-align:right;"> 1.17 </td>
   <td style="text-align:right;"> 1.45 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 907609 </td>
   <td style="text-align:right;"> 728197 </td>
   <td style="text-align:right;"> 1060944 </td>
   <td style="text-align:right;"> 589645 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 1004970 </td>
   <td style="text-align:right;"> 832365 </td>
   <td style="text-align:right;"> 1182117 </td>
   <td style="text-align:right;"> 645870 </td>
   <td style="text-align:right;"> 1.21 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 843264 </td>
   <td style="text-align:right;"> 850959 </td>
   <td style="text-align:right;"> 1173546 </td>
   <td style="text-align:right;"> 655942 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 1.38 </td>
  </tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2023" style="display:none;"><h4 class="anchored">Monthly Data for 2023</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jan </td>
   <td style="text-align:right;"> 923677 </td>
   <td style="text-align:right;"> 727943 </td>
   <td style="text-align:right;"> 1179229 </td>
   <td style="text-align:right;"> 565331 </td>
   <td style="text-align:right;"> 1.27 </td>
   <td style="text-align:right;"> 1.62 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Feb </td>
   <td style="text-align:right;"> 737694 </td>
   <td style="text-align:right;"> 590751 </td>
   <td style="text-align:right;"> 896996 </td>
   <td style="text-align:right;"> 493680 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mar </td>
   <td style="text-align:right;"> 1097414 </td>
   <td style="text-align:right;"> 872691 </td>
   <td style="text-align:right;"> 1326265 </td>
   <td style="text-align:right;"> 704031 </td>
   <td style="text-align:right;"> 1.26 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apr </td>
   <td style="text-align:right;"> 1111103 </td>
   <td style="text-align:right;"> 910356 </td>
   <td style="text-align:right;"> 1335479 </td>
   <td style="text-align:right;"> 746364 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.47 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> May </td>
   <td style="text-align:right;"> 1013134 </td>
   <td style="text-align:right;"> 816300 </td>
   <td style="text-align:right;"> 1213720 </td>
   <td style="text-align:right;"> 673766 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jun </td>
   <td style="text-align:right;"> 781364 </td>
   <td style="text-align:right;"> 694573 </td>
   <td style="text-align:right;"> 991462 </td>
   <td style="text-align:right;"> 580962 </td>
   <td style="text-align:right;"> 1.12 </td>
   <td style="text-align:right;"> 1.43 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 782225 </td>
   <td style="text-align:right;"> 641266 </td>
   <td style="text-align:right;"> 985177 </td>
   <td style="text-align:right;"> 568357 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.54 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 1020220 </td>
   <td style="text-align:right;"> 905799 </td>
   <td style="text-align:right;"> 1320332 </td>
   <td style="text-align:right;"> 777304 </td>
   <td style="text-align:right;"> 1.13 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 1018193 </td>
   <td style="text-align:right;"> 823917 </td>
   <td style="text-align:right;"> 1229626 </td>
   <td style="text-align:right;"> 679890 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 1073258 </td>
   <td style="text-align:right;"> 921818 </td>
   <td style="text-align:right;"> 1313195 </td>
   <td style="text-align:right;"> 680990 </td>
   <td style="text-align:right;"> 1.16 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 1162997 </td>
   <td style="text-align:right;"> 1065975 </td>
   <td style="text-align:right;"> 1437503 </td>
   <td style="text-align:right;"> 744966 </td>
   <td style="text-align:right;"> 1.09 </td>
   <td style="text-align:right;"> 1.35 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 874962 </td>
   <td style="text-align:right;"> 839127 </td>
   <td style="text-align:right;"> 1174564 </td>
   <td style="text-align:right;"> 661751 </td>
   <td style="text-align:right;"> 1.04 </td>
   <td style="text-align:right;"> 1.40 </td>
  </tr>
</tbody>
</table></div><button onclick="$('#year2023').toggle();">Toggle 2023 Monthly Data</button></td>
</tr>
</tfoot>
</table></div><button onclick="$('#year2022').toggle();">Toggle 2022 Monthly Data</button></td>
</tr>
</tfoot>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2021" style="display:none;"><h4 class="anchored">Monthly Data for 2021</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jan </td>
   <td style="text-align:right;"> 549376 </td>
   <td style="text-align:right;"> 515693 </td>
   <td style="text-align:right;"> 635642 </td>
   <td style="text-align:right;"> 316983 </td>
   <td style="text-align:right;"> 1.07 </td>
   <td style="text-align:right;"> 1.23 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Feb </td>
   <td style="text-align:right;"> 526404 </td>
   <td style="text-align:right;"> 495252 </td>
   <td style="text-align:right;"> 615002 </td>
   <td style="text-align:right;"> 322971 </td>
   <td style="text-align:right;"> 1.06 </td>
   <td style="text-align:right;"> 1.24 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mar </td>
   <td style="text-align:right;"> 571099 </td>
   <td style="text-align:right;"> 526354 </td>
   <td style="text-align:right;"> 697726 </td>
   <td style="text-align:right;"> 366704 </td>
   <td style="text-align:right;"> 1.09 </td>
   <td style="text-align:right;"> 1.33 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apr </td>
   <td style="text-align:right;"> 552092 </td>
   <td style="text-align:right;"> 531089 </td>
   <td style="text-align:right;"> 681874 </td>
   <td style="text-align:right;"> 375348 </td>
   <td style="text-align:right;"> 1.04 </td>
   <td style="text-align:right;"> 1.28 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> May </td>
   <td style="text-align:right;"> 505784 </td>
   <td style="text-align:right;"> 507448 </td>
   <td style="text-align:right;"> 662708 </td>
   <td style="text-align:right;"> 387898 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1.31 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jun </td>
   <td style="text-align:right;"> 639771 </td>
   <td style="text-align:right;"> 629648 </td>
   <td style="text-align:right;"> 845582 </td>
   <td style="text-align:right;"> 521075 </td>
   <td style="text-align:right;"> 1.02 </td>
   <td style="text-align:right;"> 1.34 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 658227 </td>
   <td style="text-align:right;"> 659613 </td>
   <td style="text-align:right;"> 896858 </td>
   <td style="text-align:right;"> 525848 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 1.36 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 673194 </td>
   <td style="text-align:right;"> 637958 </td>
   <td style="text-align:right;"> 878990 </td>
   <td style="text-align:right;"> 546142 </td>
   <td style="text-align:right;"> 1.06 </td>
   <td style="text-align:right;"> 1.38 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 881670 </td>
   <td style="text-align:right;"> 794865 </td>
   <td style="text-align:right;"> 1146188 </td>
   <td style="text-align:right;"> 631787 </td>
   <td style="text-align:right;"> 1.11 </td>
   <td style="text-align:right;"> 1.44 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 825848 </td>
   <td style="text-align:right;"> 657239 </td>
   <td style="text-align:right;"> 958199 </td>
   <td style="text-align:right;"> 517190 </td>
   <td style="text-align:right;"> 1.26 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 836965 </td>
   <td style="text-align:right;"> 726381 </td>
   <td style="text-align:right;"> 1018265 </td>
   <td style="text-align:right;"> 540072 </td>
   <td style="text-align:right;"> 1.15 </td>
   <td style="text-align:right;"> 1.40 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 714637 </td>
   <td style="text-align:right;"> 642671 </td>
   <td style="text-align:right;"> 913489 </td>
   <td style="text-align:right;"> 477683 </td>
   <td style="text-align:right;"> 1.11 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2023" style="display:none;"><h4 class="anchored">Monthly Data for 2023</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jan </td>
   <td style="text-align:right;"> 923677 </td>
   <td style="text-align:right;"> 727943 </td>
   <td style="text-align:right;"> 1179229 </td>
   <td style="text-align:right;"> 565331 </td>
   <td style="text-align:right;"> 1.27 </td>
   <td style="text-align:right;"> 1.62 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Feb </td>
   <td style="text-align:right;"> 737694 </td>
   <td style="text-align:right;"> 590751 </td>
   <td style="text-align:right;"> 896996 </td>
   <td style="text-align:right;"> 493680 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mar </td>
   <td style="text-align:right;"> 1097414 </td>
   <td style="text-align:right;"> 872691 </td>
   <td style="text-align:right;"> 1326265 </td>
   <td style="text-align:right;"> 704031 </td>
   <td style="text-align:right;"> 1.26 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apr </td>
   <td style="text-align:right;"> 1111103 </td>
   <td style="text-align:right;"> 910356 </td>
   <td style="text-align:right;"> 1335479 </td>
   <td style="text-align:right;"> 746364 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.47 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> May </td>
   <td style="text-align:right;"> 1013134 </td>
   <td style="text-align:right;"> 816300 </td>
   <td style="text-align:right;"> 1213720 </td>
   <td style="text-align:right;"> 673766 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jun </td>
   <td style="text-align:right;"> 781364 </td>
   <td style="text-align:right;"> 694573 </td>
   <td style="text-align:right;"> 991462 </td>
   <td style="text-align:right;"> 580962 </td>
   <td style="text-align:right;"> 1.12 </td>
   <td style="text-align:right;"> 1.43 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 782225 </td>
   <td style="text-align:right;"> 641266 </td>
   <td style="text-align:right;"> 985177 </td>
   <td style="text-align:right;"> 568357 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.54 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 1020220 </td>
   <td style="text-align:right;"> 905799 </td>
   <td style="text-align:right;"> 1320332 </td>
   <td style="text-align:right;"> 777304 </td>
   <td style="text-align:right;"> 1.13 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 1018193 </td>
   <td style="text-align:right;"> 823917 </td>
   <td style="text-align:right;"> 1229626 </td>
   <td style="text-align:right;"> 679890 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 1073258 </td>
   <td style="text-align:right;"> 921818 </td>
   <td style="text-align:right;"> 1313195 </td>
   <td style="text-align:right;"> 680990 </td>
   <td style="text-align:right;"> 1.16 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 1162997 </td>
   <td style="text-align:right;"> 1065975 </td>
   <td style="text-align:right;"> 1437503 </td>
   <td style="text-align:right;"> 744966 </td>
   <td style="text-align:right;"> 1.09 </td>
   <td style="text-align:right;"> 1.35 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 874962 </td>
   <td style="text-align:right;"> 839127 </td>
   <td style="text-align:right;"> 1174564 </td>
   <td style="text-align:right;"> 661751 </td>
   <td style="text-align:right;"> 1.04 </td>
   <td style="text-align:right;"> 1.40 </td>
  </tr>
</tbody>
</table></div><button onclick="$('#year2023').toggle();">Toggle 2023 Monthly Data</button></td>
</tr>
</tfoot>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2022" style="display:none;"><h4 class="anchored">Monthly Data for 2022</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jan </td>
   <td style="text-align:right;"> 856641 </td>
   <td style="text-align:right;"> 720827 </td>
   <td style="text-align:right;"> 1020625 </td>
   <td style="text-align:right;"> 517638 </td>
   <td style="text-align:right;"> 1.19 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Feb </td>
   <td style="text-align:right;"> 874139 </td>
   <td style="text-align:right;"> 702104 </td>
   <td style="text-align:right;"> 1026892 </td>
   <td style="text-align:right;"> 521058 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mar </td>
   <td style="text-align:right;"> 880043 </td>
   <td style="text-align:right;"> 684268 </td>
   <td style="text-align:right;"> 1023703 </td>
   <td style="text-align:right;"> 531523 </td>
   <td style="text-align:right;"> 1.29 </td>
   <td style="text-align:right;"> 1.50 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apr </td>
   <td style="text-align:right;"> 876689 </td>
   <td style="text-align:right;"> 705032 </td>
   <td style="text-align:right;"> 1019487 </td>
   <td style="text-align:right;"> 558885 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.45 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> May </td>
   <td style="text-align:right;"> 1079687 </td>
   <td style="text-align:right;"> 875267 </td>
   <td style="text-align:right;"> 1281097 </td>
   <td style="text-align:right;"> 717180 </td>
   <td style="text-align:right;"> 1.23 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jun </td>
   <td style="text-align:right;"> 974161 </td>
   <td style="text-align:right;"> 796801 </td>
   <td style="text-align:right;"> 1205210 </td>
   <td style="text-align:right;"> 679260 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.51 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 793837 </td>
   <td style="text-align:right;"> 729192 </td>
   <td style="text-align:right;"> 1033825 </td>
   <td style="text-align:right;"> 647112 </td>
   <td style="text-align:right;"> 1.09 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 755366 </td>
   <td style="text-align:right;"> 665568 </td>
   <td style="text-align:right;"> 1018248 </td>
   <td style="text-align:right;"> 599106 </td>
   <td style="text-align:right;"> 1.13 </td>
   <td style="text-align:right;"> 1.53 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 1229085 </td>
   <td style="text-align:right;"> 1051654 </td>
   <td style="text-align:right;"> 1527651 </td>
   <td style="text-align:right;"> 872243 </td>
   <td style="text-align:right;"> 1.17 </td>
   <td style="text-align:right;"> 1.45 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 907609 </td>
   <td style="text-align:right;"> 728197 </td>
   <td style="text-align:right;"> 1060944 </td>
   <td style="text-align:right;"> 589645 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 1004970 </td>
   <td style="text-align:right;"> 832365 </td>
   <td style="text-align:right;"> 1182117 </td>
   <td style="text-align:right;"> 645870 </td>
   <td style="text-align:right;"> 1.21 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 843264 </td>
   <td style="text-align:right;"> 850959 </td>
   <td style="text-align:right;"> 1173546 </td>
   <td style="text-align:right;"> 655942 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 1.38 </td>
  </tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; border:0;" colspan="100%"><sup>a</sup> <div id="year2023" style="display:none;"><h4 class="anchored">Monthly Data for 2023</h4><table class="table table-striped table-condensed" style="font-size: 12px; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> month_name </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush (6AM-10AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Midday (10AM-3PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush (3PM-7PM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Off-Hours (7PM-6AM) </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Morning Rush / Midday Ratio </th>
   <th style="text-align:right;font-weight: bold;background-color: rgba(221, 221, 221, 255) !important;"> Evening Rush / Midday Ratio </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Jan </td>
   <td style="text-align:right;"> 923677 </td>
   <td style="text-align:right;"> 727943 </td>
   <td style="text-align:right;"> 1179229 </td>
   <td style="text-align:right;"> 565331 </td>
   <td style="text-align:right;"> 1.27 </td>
   <td style="text-align:right;"> 1.62 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Feb </td>
   <td style="text-align:right;"> 737694 </td>
   <td style="text-align:right;"> 590751 </td>
   <td style="text-align:right;"> 896996 </td>
   <td style="text-align:right;"> 493680 </td>
   <td style="text-align:right;"> 1.25 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Mar </td>
   <td style="text-align:right;"> 1097414 </td>
   <td style="text-align:right;"> 872691 </td>
   <td style="text-align:right;"> 1326265 </td>
   <td style="text-align:right;"> 704031 </td>
   <td style="text-align:right;"> 1.26 </td>
   <td style="text-align:right;"> 1.52 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Apr </td>
   <td style="text-align:right;"> 1111103 </td>
   <td style="text-align:right;"> 910356 </td>
   <td style="text-align:right;"> 1335479 </td>
   <td style="text-align:right;"> 746364 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.47 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> May </td>
   <td style="text-align:right;"> 1013134 </td>
   <td style="text-align:right;"> 816300 </td>
   <td style="text-align:right;"> 1213720 </td>
   <td style="text-align:right;"> 673766 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jun </td>
   <td style="text-align:right;"> 781364 </td>
   <td style="text-align:right;"> 694573 </td>
   <td style="text-align:right;"> 991462 </td>
   <td style="text-align:right;"> 580962 </td>
   <td style="text-align:right;"> 1.12 </td>
   <td style="text-align:right;"> 1.43 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Jul </td>
   <td style="text-align:right;"> 782225 </td>
   <td style="text-align:right;"> 641266 </td>
   <td style="text-align:right;"> 985177 </td>
   <td style="text-align:right;"> 568357 </td>
   <td style="text-align:right;"> 1.22 </td>
   <td style="text-align:right;"> 1.54 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Aug </td>
   <td style="text-align:right;"> 1020220 </td>
   <td style="text-align:right;"> 905799 </td>
   <td style="text-align:right;"> 1320332 </td>
   <td style="text-align:right;"> 777304 </td>
   <td style="text-align:right;"> 1.13 </td>
   <td style="text-align:right;"> 1.46 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Sep </td>
   <td style="text-align:right;"> 1018193 </td>
   <td style="text-align:right;"> 823917 </td>
   <td style="text-align:right;"> 1229626 </td>
   <td style="text-align:right;"> 679890 </td>
   <td style="text-align:right;"> 1.24 </td>
   <td style="text-align:right;"> 1.49 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Oct </td>
   <td style="text-align:right;"> 1073258 </td>
   <td style="text-align:right;"> 921818 </td>
   <td style="text-align:right;"> 1313195 </td>
   <td style="text-align:right;"> 680990 </td>
   <td style="text-align:right;"> 1.16 </td>
   <td style="text-align:right;"> 1.42 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Nov </td>
   <td style="text-align:right;"> 1162997 </td>
   <td style="text-align:right;"> 1065975 </td>
   <td style="text-align:right;"> 1437503 </td>
   <td style="text-align:right;"> 744966 </td>
   <td style="text-align:right;"> 1.09 </td>
   <td style="text-align:right;"> 1.35 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Dec </td>
   <td style="text-align:right;"> 874962 </td>
   <td style="text-align:right;"> 839127 </td>
   <td style="text-align:right;"> 1174564 </td>
   <td style="text-align:right;"> 661751 </td>
   <td style="text-align:right;"> 1.04 </td>
   <td style="text-align:right;"> 1.40 </td>
  </tr>
</tbody>
</table></div><button onclick="$('#year2023').toggle();">Toggle 2023 Monthly Data</button></td>
</tr>
</tfoot>
</table></div><button onclick="$('#year2022').toggle();">Toggle 2022 Monthly Data</button></td>
</tr>
</tfoot>
</table></div><button onclick="$('#year2021').toggle();">Toggle 2021 Monthly Data</button></td>
</tr>
</tfoot>
</table></div><button onclick="$('#year2020').toggle();">Toggle 2020 Monthly Data</button></td>
</tr>
</tfoot>
</table>

</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create time_slot_yearly from weekday_time_slots</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>time_slot_yearly <span class="ot">&lt;-</span> weekday_time_slots <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as.numeric</span>(year) <span class="sc">&gt;=</span> <span class="dv">2020</span> <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(year) <span class="sc">&lt;=</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, time_slot) <span class="sc">%&gt;%</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_ridership =</span> <span class="fu">mean</span>(total_ridership)) <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create pivot table for easier comparison using tidyr</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>time_slot_wide <span class="ot">&lt;-</span> time_slot_yearly <span class="sc">%&gt;%</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> time_slot, <span class="at">values_from =</span> avg_ridership)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for the specific time slots we want to visualize</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>time_slot_long <span class="ot">&lt;-</span> time_slot_yearly <span class="sc">%&gt;%</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(time_slot <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Morning Rush (6AM-10AM)"</span>, <span class="st">"Midday (10AM-3PM)"</span>, <span class="st">"Evening Rush (3PM-7PM)"</span>))</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate peak-to-offpeak ratios by year</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>peak_offpeak_ratio <span class="ot">&lt;-</span> time_slot_long <span class="sc">%&gt;%</span> </span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> time_slot, <span class="at">values_from =</span> avg_ridership) <span class="sc">%&gt;%</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">morning_to_midday =</span> <span class="st">`</span><span class="at">Morning Rush (6AM-10AM)</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">Midday (10AM-3PM)</span><span class="st">`</span>,</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">evening_to_midday =</span> <span class="st">`</span><span class="at">Evening Rush (3PM-7PM)</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">Midday (10AM-3PM)</span><span class="st">`</span>,</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_peak_ratio =</span> (morning_to_midday <span class="sc">+</span> evening_to_midday) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Create color palette</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Morning Rush (6AM-10AM)"</span> <span class="ot">=</span> <span class="st">"darkgreen"</span>, </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Midday (10AM-3PM)"</span> <span class="ot">=</span> <span class="st">"darkorange"</span>, </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Evening Rush (3PM-7PM)"</span> <span class="ot">=</span> <span class="st">"firebrick"</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Create interactive plot with plotly - ADJUSTED DIMENSIONS</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>plot_interactive <span class="ot">&lt;-</span> <span class="fu">plot_ly</span>(<span class="at">height =</span> <span class="dv">550</span>, <span class="at">width =</span> <span class="dv">650</span>) <span class="sc">%&gt;%</span>  <span class="co"># Reduced width to fit better</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Main ridership lines</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> time_slot_long, </span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="sc">~</span>year, <span class="at">y =</span> <span class="sc">~</span>avg_ridership<span class="sc">/</span><span class="dv">1000</span>, </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="sc">~</span>time_slot, </span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">'scatter'</span>, <span class="at">mode =</span> <span class="st">'lines+markers'</span>,</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">line =</span> <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">3</span>),</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">colors =</span> colors,</span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">hoverinfo =</span> <span class="st">'text'</span>,</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>            <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste</span>(<span class="st">"&lt;b&gt;"</span>, time_slot, <span class="st">"&lt;/b&gt;&lt;br&gt;"</span>,</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Year: "</span>, year, <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Ridership: "</span>, <span class="fu">format</span>(<span class="fu">round</span>(avg_ridership<span class="sc">/</span><span class="dv">1000</span>, <span class="dv">1</span>), <span class="at">big.mark =</span> <span class="st">","</span>), <span class="st">"k"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add shaded area for work-from-home period</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_ribbons</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2023</span>), </span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>              <span class="at">ymin =</span> <span class="dv">0</span>, </span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>              <span class="at">ymax =</span> <span class="fu">max</span>(time_slot_long<span class="sc">$</span>avg_ridership<span class="sc">/</span><span class="dv">1000</span>) <span class="sc">*</span> <span class="fl">1.1</span>,</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>              <span class="at">fillcolor =</span> <span class="st">'rgba(200, 200, 200, 0.2)'</span>,</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>              <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">'transparent'</span>),</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>              <span class="at">name =</span> <span class="st">"WFH Period"</span>,</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>              <span class="at">hoverinfo =</span> <span class="st">"none"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add secondary y-axis for peak-to-offpeak ratio</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_trace</span>(<span class="at">data =</span> peak_offpeak_ratio,</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="sc">~</span>year, <span class="at">y =</span> <span class="sc">~</span>avg_peak_ratio, </span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">'scatter'</span>, <span class="at">mode =</span> <span class="st">'lines+markers'</span>,</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>            <span class="at">line =</span> <span class="fu">list</span>(<span class="at">dash =</span> <span class="st">'dot'</span>, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>),</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>            <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">symbol =</span> <span class="st">'diamond'</span>, <span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> <span class="st">'darkgrey'</span>),</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>            <span class="at">name =</span> <span class="st">"Peak/Off-Peak Ratio"</span>,</span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>            <span class="at">yaxis =</span> <span class="st">"y2"</span>,</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>            <span class="at">hoverinfo =</span> <span class="st">'text'</span>,</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>            <span class="at">text =</span> <span class="sc">~</span><span class="fu">paste</span>(<span class="st">"Peak/Off-Peak Ratio:"</span>, <span class="fu">round</span>(avg_peak_ratio, <span class="dv">2</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Layout with dual y-axes and other enhancements - ADJUSTED MARGINS</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">""</span>,  <span class="co"># Removed title to save space</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Year"</span>, </span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">showgrid =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">range =</span> <span class="fu">c</span>(<span class="fl">2019.5</span>, <span class="fl">2023.5</span>),</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">tickvals =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>),</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">fixedrange =</span> <span class="cn">TRUE</span>  <span class="co"># Fix X-axis range to prevent zooming</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Average Ridership (Thousands)"</span>, </span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>      <span class="at">showgrid =</span> <span class="cn">TRUE</span>, </span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">gridcolor =</span> <span class="st">'rgba(200,200,200,0.2)'</span>,</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">fixedrange =</span> <span class="cn">TRUE</span>,  <span class="co"># Fix Y-axis range to prevent zooming</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">automargin =</span> <span class="cn">TRUE</span>   <span class="co"># Ensure y-axis title fits</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis2 =</span> <span class="fu">list</span>(</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Peak/Off-Peak Ratio"</span>,</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">overlaying =</span> <span class="st">"y"</span>,</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">side =</span> <span class="st">"right"</span>,</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">showgrid =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.4</span>),  </span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">fixedrange =</span> <span class="cn">TRUE</span>,  <span class="co"># Fix Y2-axis range to prevent zooming</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">automargin =</span> <span class="cn">TRUE</span>   <span class="co"># Ensure y-axis title fits</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>    <span class="co"># REDUCED MARGINS to fit in frame</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">margin =</span> <span class="fu">list</span>(<span class="at">l =</span> <span class="dv">60</span>, <span class="at">r =</span> <span class="dv">60</span>, <span class="at">t =</span> <span class="dv">50</span>, <span class="at">b =</span> <span class="dv">60</span>),</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">hovermode =</span> <span class="st">"closest"</span>,</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend =</span> <span class="fu">list</span>(</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">list</span>(<span class="at">text =</span> <span class="st">"&lt;b&gt;Metrics&lt;/b&gt;"</span>),</span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>      <span class="at">orientation =</span> <span class="st">"h"</span>,  <span class="co"># Horizontal legend</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fl">1.05</span>,  <span class="co"># Position at the top</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fl">0.5</span>,   <span class="co"># Center</span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">xanchor =</span> <span class="st">"center"</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>    <span class="at">annotations =</span> <span class="fu">list</span>(</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(<span class="at">x =</span> <span class="fl">2020.2</span>, <span class="at">y =</span> <span class="fu">max</span>(time_slot_long<span class="sc">$</span>avg_ridership<span class="sc">/</span><span class="dv">1000</span>) <span class="sc">*</span> <span class="fl">0.8</span>,</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>           <span class="at">text =</span> <span class="st">"Remote Work&lt;br&gt;Transition"</span>,</span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>           <span class="at">showarrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrowhead =</span> <span class="dv">2</span>,</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrowcolor =</span> <span class="st">"#636363"</span>,</span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>           <span class="at">arrowsize =</span> <span class="dv">1</span>,</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>           <span class="at">ax =</span> <span class="dv">25</span>,</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>           <span class="at">ay =</span> <span class="sc">-</span><span class="dv">40</span>)</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add buttons in a more compact layout</span></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">updatemenus =</span> <span class="fu">list</span>(</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>      <span class="fu">list</span>(</span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"buttons"</span>,</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>        <span class="at">direction =</span> <span class="st">"right"</span>,</span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="fl">0.5</span>,  <span class="co"># Center-aligned</span></span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.15</span>,  <span class="co"># Moved up closer to the graph</span></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>        <span class="at">xanchor =</span> <span class="st">"center"</span>,</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>        <span class="at">buttons =</span> <span class="fu">list</span>(</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>          <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"update"</span>,</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>               <span class="at">args =</span> <span class="fu">list</span>(</span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">list</span>(<span class="at">visible =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">TRUE</span>, <span class="fu">length</span>(time_slot_long<span class="sc">$</span>time_slot)), <span class="cn">TRUE</span>, <span class="cn">TRUE</span>)),</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>)</span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>               ),</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>               <span class="at">label =</span> <span class="st">"All Data"</span>),</span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>          <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"update"</span>,</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>               <span class="at">args =</span> <span class="fu">list</span>(</span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">list</span>(<span class="at">visible =</span> <span class="fu">c</span>(time_slot_long<span class="sc">$</span>time_slot <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Morning Rush (6AM-10AM)"</span>, <span class="st">"Midday (10AM-3PM)"</span>), <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)),</span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>)</span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>               ),</span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>               <span class="at">label =</span> <span class="st">"Morning vs Midday"</span>),</span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>          <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"update"</span>,</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a>               <span class="at">args =</span> <span class="fu">list</span>(</span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">list</span>(<span class="at">visible =</span> <span class="fu">c</span>(time_slot_long<span class="sc">$</span>time_slot <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Evening Rush (3PM-7PM)"</span>, <span class="st">"Midday (10AM-3PM)"</span>), <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)),</span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>)</span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a>               ),</span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a>               <span class="at">label =</span> <span class="st">"Evening vs Midday"</span>),</span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>          <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"update"</span>,</span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a>               <span class="at">args =</span> <span class="fu">list</span>(</span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">list</span>(<span class="at">visible =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="cn">FALSE</span>, <span class="fu">length</span>(time_slot_long<span class="sc">$</span>time_slot)), <span class="cn">TRUE</span>, <span class="cn">TRUE</span>)),</span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>)</span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a>               ),</span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>               <span class="at">label =</span> <span class="st">"Ratio Only"</span>)</span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make sure plot is self-contained</span></span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">autosize =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a>    <span class="at">dragmode =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add space-saving font settings</span></span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>    <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Configure to remove all toolbar options</span></span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(</span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>    <span class="at">displayModeBar =</span> <span class="cn">FALSE</span>,  <span class="co"># Hide the mode bar completely</span></span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">responsive =</span> <span class="cn">FALSE</span>       <span class="co"># Prevent responsive resizing</span></span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a><span class="co"># Add percentage change annotations - with smaller font</span></span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a>years <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2020"</span>, <span class="st">"2021"</span>, <span class="st">"2022"</span>, <span class="st">"2023"</span>)</span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (slot <span class="cf">in</span> <span class="fu">unique</span>(time_slot_long<span class="sc">$</span>time_slot)) {</span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only add the annotation for 2023 (last year)</span></span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>  latest_data <span class="ot">&lt;-</span> time_slot_long <span class="sc">%&gt;%</span> </span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">==</span> <span class="st">"2023"</span> <span class="sc">&amp;</span> time_slot <span class="sc">==</span> slot) <span class="sc">%&gt;%</span> </span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(avg_ridership)</span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the 2019 value for comparison</span></span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a>  baseline_value <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">exists</span>(<span class="st">"pre_pandemic_value"</span>), </span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a>                          pre_pandemic_value[pre_pandemic_value<span class="sc">$</span>time_slot <span class="sc">==</span> slot, ]<span class="sc">$</span>avg_ridership, </span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a>                          time_slot_long <span class="sc">%&gt;%</span> </span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">filter</span>(year <span class="sc">==</span> <span class="st">"2020"</span> <span class="sc">&amp;</span> time_slot <span class="sc">==</span> slot) <span class="sc">%&gt;%</span> </span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">pull</span>(avg_ridership))</span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a>  percent_change <span class="ot">&lt;-</span> ((latest_data<span class="sc">$</span>avg_ridership <span class="sc">/</span> baseline_value) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only add annotation for the latest year - with smaller, more compact text</span></span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(latest_data) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a>    plot_interactive <span class="ot">&lt;-</span> plot_interactive <span class="sc">%&gt;%</span></span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_annotations</span>(</span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="dv">2023</span>,</span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> latest_data<span class="sc">$</span>avg_ridership<span class="sc">/</span><span class="dv">1000</span>,</span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(percent_change, <span class="dv">0</span>), <span class="st">"%"</span>),  <span class="co"># Shortened text</span></span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a>        <span class="at">showarrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a>        <span class="at">arrowhead =</span> <span class="dv">0</span>,</span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a>        <span class="at">ax =</span> <span class="dv">25</span>,  <span class="co"># Reduced arrow length</span></span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a>        <span class="at">ay =</span> <span class="dv">0</span>,</span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a>        <span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">9</span>)  <span class="co"># Smaller font</span></span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the interactive plot</span></span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a>plot_interactive</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="htmlwidget-9063335868701e4b61c6" style="width:100%;height:550px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-9063335868701e4b61c6">{"x":{"visdat":{"527d43ced85":["function () ","plotlyVisDat"],"527d3c0db8ef":["function () ","data"],"527d28e871b6":["function () ","data"]},"cur_data":"527d28e871b6","attrs":{"527d3c0db8ef":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"color":{},"type":"scatter","mode":"lines+markers","line":{"width":3},"marker":{"size":8},"colors":["darkgreen","darkorange","firebrick"],"hoverinfo":"text","text":{},"inherit":true},"527d3c0db8ef.1":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":[2020,2023],"ymin":0,"ymax":1324.624145490196,"type":"scatter","mode":"lines","hoveron":"points","fill":"toself","fillcolor":"rgba(200, 200, 200, 0.2)","line":{"color":"transparent"},"name":"WFH Period","hoverinfo":"none","inherit":true},"527d28e871b6":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"scatter","mode":"lines+markers","line":{"dash":"dot","width":2,"color":"darkgrey"},"marker":{"symbol":"diamond","size":10,"color":"darkgrey"},"name":"Peak/Off-Peak Ratio","yaxis":"y2","hoverinfo":"text","text":{},"inherit":true}},"layout":{"width":650,"height":550,"margin":{"b":60,"l":60,"t":50,"r":60},"title":"","xaxis":{"domain":[0,1],"automargin":true,"title":"Year","showgrid":false,"range":[2019.5,2023.5],"tickvals":[2020,2021,2022,2023],"fixedrange":true},"yaxis":{"domain":[0,1],"automargin":true,"title":"Average Ridership (Thousands)","showgrid":true,"gridcolor":"rgba(200,200,200,0.2)","fixedrange":true},"yaxis2":{"title":"Peak/Off-Peak Ratio","overlaying":"y","side":"right","showgrid":false,"range":[0,1.3999999999999999],"fixedrange":true,"automargin":true},"hovermode":"closest","legend":{"title":{"text":"<b>Metrics<\/b>"},"orientation":"h","y":1.05,"x":0.5,"xanchor":"center"},"annotations":[{"x":2020.2,"y":963.36301490196081,"text":"Remote Work<br>Transition","showarrow":true,"arrowhead":2,"arrowcolor":"#636363","arrowsize":1,"ax":25,"ay":-40},{"text":"163%","x":2023,"y":1204.2037686274509,"showarrow":true,"arrowhead":0,"ax":25,"ay":0,"font":{"size":9}},{"text":"130%","x":2023,"y":817.85598431372534,"showarrow":true,"arrowhead":0,"ax":25,"ay":0,"font":{"size":9}},{"text":"158%","x":2023,"y":969.2144296875,"showarrow":true,"arrowhead":0,"ax":25,"ay":0,"font":{"size":9}}],"updatemenus":[{"type":"buttons","direction":"right","x":0.5,"y":-0.14999999999999999,"xanchor":"center","buttons":[{"method":"update","args":[{"visible":[true,true,true,true,true,true,true,true,true,true,true,true,true,true]},{"title":""}],"label":"All Data"},{"method":"update","args":[{"visible":[false,true,true,false,true,true,false,true,true,false,true,true,false,true]},{"title":""}],"label":"Morning vs Midday"},{"method":"update","args":[{"visible":[true,true,false,true,true,false,true,true,false,true,true,false,false,true]},{"title":""}],"label":"Evening vs Midday"},{"method":"update","args":[{"visible":[false,false,false,false,false,false,false,false,false,false,false,false,true,true]},{"title":""}],"label":"Ratio Only"}]}],"autosize":false,"dragmode":false,"font":{"size":10},"showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displayModeBar":false,"responsive":false},"data":[{"x":["2020","2021","2022","2023"],"y":[458.11458593750001,829.76608139534881,1132.7264108527131,1204.2037686274509],"type":"scatter","mode":"lines+markers","line":{"color":"rgba(178,34,34,1)","width":3},"marker":{"color":"rgba(178,34,34,1)","size":8,"line":{"color":"rgba(178,34,34,1)"}},"hoverinfo":["text","text","text","text"],"text":["<b> Evening Rush (3PM-7PM) <\/b><br> Year:  2020 <br> Ridership:    458.1 k","<b> Evening Rush (3PM-7PM) <\/b><br> Year:  2021 <br> Ridership:    829.8 k","<b> Evening Rush (3PM-7PM) <\/b><br> Year:  2022 <br> Ridership:  1,132.7 k","<b> Evening Rush (3PM-7PM) <\/b><br> Year:  2023 <br> Ridership:  1,204.2 k"],"name":"Evening Rush (3PM-7PM)","textfont":{"color":"rgba(178,34,34,1)"},"error_y":{"color":"rgba(178,34,34,1)"},"error_x":{"color":"rgba(178,34,34,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2020","2021","2022","2023"],"y":[355.88426153846137,611.08775193798431,778.99297683397685,817.85598431372534],"type":"scatter","mode":"lines+markers","line":{"color":"rgba(255,140,0,1)","width":3},"marker":{"color":"rgba(255,140,0,1)","size":8,"line":{"color":"rgba(255,140,0,1)"}},"hoverinfo":["text","text","text","text"],"text":["<b> Midday (10AM-3PM) <\/b><br> Year:  2020 <br> Ridership:    355.9 k","<b> Midday (10AM-3PM) <\/b><br> Year:  2021 <br> Ridership:    611.1 k","<b> Midday (10AM-3PM) <\/b><br> Year:  2022 <br> Ridership:    779.0 k","<b> Midday (10AM-3PM) <\/b><br> Year:  2023 <br> Ridership:    817.9 k"],"name":"Midday (10AM-3PM)","textfont":{"color":"rgba(255,140,0,1)"},"error_y":{"color":"rgba(255,140,0,1)"},"error_x":{"color":"rgba(255,140,0,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2020","2021","2022","2023"],"y":[375.90350387596897,662.77737837837844,923.18023346303494,969.2144296875],"type":"scatter","mode":"lines+markers","line":{"color":"rgba(0,100,0,1)","width":3},"marker":{"color":"rgba(0,100,0,1)","size":8,"line":{"color":"rgba(0,100,0,1)"}},"hoverinfo":["text","text","text","text"],"text":["<b> Morning Rush (6AM-10AM) <\/b><br> Year:  2020 <br> Ridership:    375.9 k","<b> Morning Rush (6AM-10AM) <\/b><br> Year:  2021 <br> Ridership:    662.8 k","<b> Morning Rush (6AM-10AM) <\/b><br> Year:  2022 <br> Ridership:    923.2 k","<b> Morning Rush (6AM-10AM) <\/b><br> Year:  2023 <br> Ridership:    969.2 k"],"name":"Morning Rush (6AM-10AM)","textfont":{"color":"rgba(0,100,0,1)"},"error_y":{"color":"rgba(0,100,0,1)"},"error_x":{"color":"rgba(0,100,0,1)"},"xaxis":"x","yaxis":"y","frame":null},{"fillcolor":"rgba(200, 200, 200, 0.2)","x":[2020,2023,2023,2023,2020],"type":"scatter","mode":"lines","hoveron":"points","fill":"toself","line":{"color":"transparent"},"name":"WFH Period","hoverinfo":["none","none","none","none","none"],"y":[0,0,0,1324.624145490196,1324.624145490196],"marker":{"color":"rgba(214,39,40,1)","line":{"color":"rgba(214,39,40,1)"}},"error_y":{"color":"rgba(214,39,40,1)"},"error_x":{"color":"rgba(214,39,40,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2020","2021","2022","2023"],"y":[1.171754668509462,1.2212186016168074,1.319592541560175,1.3287291650367377],"type":"scatter","mode":"lines+markers","line":{"color":"darkgrey","dash":"dot","width":2},"marker":{"color":"darkgrey","symbol":"diamond","size":10,"line":{"color":"rgba(148,103,189,1)"}},"name":"Peak/Off-Peak Ratio","yaxis":"y2","hoverinfo":["text","text","text","text"],"text":["Peak/Off-Peak Ratio: 1.17","Peak/Off-Peak Ratio: 1.22","Peak/Off-Peak Ratio: 1.32","Peak/Off-Peak Ratio: 1.33"],"error_y":{"color":"rgba(148,103,189,1)"},"error_x":{"color":"rgba(148,103,189,1)"},"xaxis":"x","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="focus-on-the-big-question" class="level2">
<h2 class="anchored" data-anchor-id="focus-on-the-big-question"><strong>Focus on the BIG Question</strong></h2>
<p><strong>What is the estimated fare revenue loss for the MTA attributable to remote work-induced ridership decline between 2019 and 2023?</strong></p>
<section id="approach" class="level3">
<h3 class="anchored" data-anchor-id="approach"><strong>Approach</strong></h3>
<p>We quantified remote work’s specific impact by comparing weekday versus weekend recovery rates in 2023, with the gap between them representing commuting trips lost to remote work arrangements.</p>
</section>
<section id="key-findings" class="level3">
<h3 class="anchored" data-anchor-id="key-findings"><strong>Key Findings</strong></h3>
<div class="insight-box">
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare weekday vs weekend recovery in 2023</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>remote_work_impact <span class="ot">&lt;-</span> daily_ridership <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(is_weekend) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="st">`</span><span class="at">% of Pre-Pandemic Level</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Subways: % of Comparable Pre-Pandemic Day</span><span class="st">`</span>) <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the gap between weekday and weekend recovery</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>weekend_recovery <span class="ot">&lt;-</span> remote_work_impact<span class="sc">$</span><span class="st">`</span><span class="at">% of Pre-Pandemic Level</span><span class="st">`</span>[remote_work_impact<span class="sc">$</span>is_weekend <span class="sc">==</span> <span class="cn">TRUE</span>]</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>weekday_recovery <span class="ot">&lt;-</span> remote_work_impact<span class="sc">$</span><span class="st">`</span><span class="at">% of Pre-Pandemic Level</span><span class="st">`</span>[remote_work_impact<span class="sc">$</span>is_weekend <span class="sc">==</span> <span class="cn">FALSE</span>]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>recovery_gap <span class="ot">&lt;-</span> weekend_recovery <span class="sc">-</span> weekday_recovery</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the impact</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># If weekdays were recovering at same rate as weekends, what would the additional ridership be?</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>avg_weekday_ridership_2023 <span class="ot">&lt;-</span> <span class="fu">mean</span>(daily_ridership<span class="sc">$</span><span class="st">`</span><span class="at">Subways: Total Estimated Ridership</span><span class="st">`</span>[</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  daily_ridership<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2023</span> <span class="sc">&amp;</span> daily_ridership<span class="sc">$</span>is_weekend <span class="sc">==</span> <span class="cn">FALSE</span>])</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>avg_pre_pandemic_weekday <span class="ot">&lt;-</span> avg_weekday_ridership_2023 <span class="sc">/</span> (weekday_recovery<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>potential_weekday_ridership <span class="ot">&lt;-</span> avg_pre_pandemic_weekday <span class="sc">*</span> (weekend_recovery<span class="sc">/</span><span class="dv">100</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>riders_lost_to_remote_work <span class="ot">&lt;-</span> potential_weekday_ridership <span class="sc">-</span> avg_weekday_ridership_2023</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the revenue impact</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>avg_fare_2023 <span class="ot">&lt;-</span> <span class="fu">mean</span>(daily_ridership<span class="sc">$</span>fare[daily_ridership<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2023</span>])</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>daily_revenue_impact <span class="ot">&lt;-</span> riders_lost_to_remote_work <span class="sc">*</span> avg_fare_2023</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>annual_revenue_impact <span class="ot">&lt;-</span> daily_revenue_impact <span class="sc">*</span> <span class="dv">250</span>  <span class="co"># Assuming 250 weekdays per year</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create summary table</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>remote_work_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Weekday Recovery Rate (%)"</span>, <span class="st">"Weekend Recovery Rate (%)"</span>, </span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Recovery Gap (percentage points)"</span>, </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Estimated Daily Riders Lost to Remote Work"</span>,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Estimated Annual Revenue Impact from Remote Work ($M)"</span>),</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(<span class="fu">round</span>(weekday_recovery, <span class="dv">1</span>), <span class="fu">round</span>(weekend_recovery, <span class="dv">1</span>), </span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(recovery_gap, <span class="dv">1</span>), </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">format</span>(<span class="fu">round</span>(riders_lost_to_remote_work, <span class="dv">0</span>), <span class="at">big.mark=</span><span class="st">","</span>), <span class="co"># Format with commas</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">round</span>(annual_revenue_impact<span class="sc">/</span><span class="dv">1000000</span>, <span class="dv">1</span>))</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Define MTA brand colors if not already defined</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>mta_blue <span class="ot">&lt;-</span> <span class="st">"#0039A6"</span>  <span class="co"># MTA NYC Transit blue</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Display table with MTA theme</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  remote_work_summary,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"Estimated Impact Attributable to Remote Work (2023)"</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>),</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"center"</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">background =</span> mta_blue, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">background =</span> <span class="st">"#f8f8f8"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">5</span>, <span class="at">background =</span> <span class="st">"#f2f2f2"</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span>  <span class="co"># Highlight the revenue impact row</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">2</span>, <span class="at">width =</span> <span class="st">"150px"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Estimated Impact Attributable to Remote Work (2023)</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">Metric</th>
<th data-quarto-table-cell-role="th" style="text-align: left; font-weight: bold; color: white !important; background-color: rgba(0, 57, 166, 255) !important;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">Weekday Recovery Rate (%)</td>
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important; width: 150px;">67.1</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">Weekend Recovery Rate (%)</td>
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important; width: 150px;">77.3</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">Recovery Gap (percentage points)</td>
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important; width: 150px;">10.2</td>
</tr>
<tr class="even">
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important;">Estimated Daily Riders Lost to Remote Work</td>
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important; width: 150px;">541,540</td>
</tr>
<tr class="odd">
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important; font-weight: bold; background-color: rgba(242, 242, 242, 255) !important;">Estimated Annual Revenue Impact from Remote Work ($M)</td>
<td style="text-align: left; font-weight: bold; background-color: rgba(248, 248, 248, 255) !important; font-weight: bold; background-color: rgba(242, 242, 242, 255) !important; width: 150px;">379.8</td>
</tr>
</tbody>
</table>


</div>
</div>
<p><em>Recovery Gap:</em> The 10.2 percentage point difference between weekend (77.3%) and weekday (67.1%) recovery represents trips specifically lost to remote work</p>
<p><em>Daily Impact:</em> Approximately 541,540 daily subway riders lost to remote work in 2023 Revenue Loss: $379.8 million annual revenue impact (based on $2.80 average fare × 250 weekdays)</p>
<p><em>Attribution:</em> Remote work accounts for 31% of total ridership decline from pre-pandemic levels.</p>
<p>Logic behind the analysis: Total decline: 30% gap between current (70%) and pre-pandemic (100%) ridership. Remote work impact: 10.2 percentage point difference between weekend (77.3%) and weekday (67.1%) recovery.</p>
<p>Calculation: (10.2 ÷ 30) × 100 ≈ 31%</p>
<p>This isolates remote work’s specific contribution from other factors by using weekends (largely leisure travel) as a control group against weekdays (work commutes).</p>
<p><strong>Cumulative Impact: Estimated $2.5-3.0 billion in remote work-specific fare revenue loss from 2020-2023, representing a significant portion of the total $8.8 billion shortfall</strong></p>
<section id="implications" class="level3">
<h3 class="anchored" data-anchor-id="implications"><strong>Implications</strong></h3>
<p>This analysis confirms remote work has evolved from a temporary pandemic response into a structural feature of New York City’s economy. The persistent nature of this change, even three years post-pandemic, requires the MTA to adapt to a new paradigm where a significant portion of former daily commuters may never return to pre-pandemic travel patterns. The MTA must now develop long-term strategies addressing both the financial implications and service delivery models appropriate for this permanently altered ridership landscape.</p>


</section>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/<Vihan-Raghuvanshi>\.github\.io\/STA9750-2025-SPRING\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>